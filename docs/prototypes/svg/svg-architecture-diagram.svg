<svg width="900" height="500" xmlns="http://www.w3.org/2000/svg">
  <!-- Define arrow markers -->
  <defs>
    <marker id="arrowhead" markerWidth="12" markerHeight="8" 
            refX="10" refY="4" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,8 L12,4 z" fill="#374151"/>
    </marker>
    
    <!-- Gradient for boxes -->
    <linearGradient id="hostGradient" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#DBEAFE"/>
      <stop offset="100%" style="stop-color:#BFDBFE"/>
    </linearGradient>
    
    <linearGradient id="pluginGradient" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#D1FAE5"/>
      <stop offset="100%" style="stop-color:#A7F3D0"/>
    </linearGradient>
    
    <linearGradient id="conductorGradient" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#E9D5FF"/>
      <stop offset="100%" style="stop-color:#DDD6FE"/>
    </linearGradient>
  </defs>
  
  <!-- Title -->
  <text x="450" y="30" text-anchor="middle" font-family="monospace" font-size="20" font-weight="bold" fill="#1F2937">
    Three-Codebase Architecture
  </text>
  
  <!-- Column Headers -->
  <text x="150" y="70" text-anchor="middle" font-family="monospace" font-size="14" font-weight="bold" fill="#2563EB">
    [ Thin-Client Host ]
  </text>
  
  <text x="450" y="70" text-anchor="middle" font-family="monospace" font-size="14" font-weight="bold" fill="#059669">
    [ Plugins ]
  </text>
  
  <text x="750" y="70" text-anchor="middle" font-family="monospace" font-size="14" font-weight="bold" fill="#7C3AED">
    [ Musical Conductor ]
  </text>
  
  <!-- Thin-Client Host Box -->
  <rect x="50" y="90" width="200" height="120" rx="8" ry="8" 
        fill="url(#hostGradient)" stroke="#3B82F6" stroke-width="2"/>
  
  <text x="150" y="115" text-anchor="middle" font-family="monospace" font-size="12" font-weight="bold" fill="#1E40AF">
    App.tsx  PanelSlot
  </text>
  <text x="150" y="135" text-anchor="middle" font-family="monospace" font-size="12" fill="#1E40AF">
    SlotContainer
  </text>
  <text x="150" y="155" text-anchor="middle" font-family="monospace" font-size="12" fill="#1E40AF">
    initConductor()
  </text>
  
  <!-- Plugins Box -->
  <rect x="350" y="90" width="200" height="140" rx="8" ry="8" 
        fill="url(#pluginGradient)" stroke="#10B981" stroke-width="2"/>
  
  <text x="450" y="115" text-anchor="middle" font-family="monospace" font-size="12" font-weight="bold" fill="#047857">
    Library (ui)
  </text>
  <text x="450" y="135" text-anchor="middle" font-family="monospace" font-size="12" fill="#047857">
    LibraryComponent (sym)
  </text>
  <text x="450" y="155" text-anchor="middle" font-family="monospace" font-size="12" fill="#047857">
    Canvas (ui)
  </text>
  <text x="450" y="175" text-anchor="middle" font-family="monospace" font-size="12" fill="#047857">
    CanvasComponent (sym)
  </text>
  <text x="450" y="195" text-anchor="middle" font-family="monospace" font-size="12" fill="#047857">
    ControlPanel (ui+cfg)
  </text>
  
  <!-- Musical Conductor Box -->
  <rect x="650" y="90" width="200" height="120" rx="8" ry="8" 
        fill="url(#conductorGradient)" stroke="#8B5CF6" stroke-width="2"/>
  
  <text x="750" y="115" text-anchor="middle" font-family="monospace" font-size="12" font-weight="bold" fill="#5B21B6">
    SequenceEngine
  </text>
  <text x="750" y="135" text-anchor="middle" font-family="monospace" font-size="12" fill="#5B21B6">
    EventBus / Logger
  </text>
  <text x="750" y="155" text-anchor="middle" font-family="monospace" font-size="12" fill="#5B21B6">
    Correlated logs (IDs)
  </text>
  
  <!-- Flow Arrows and Labels -->
  
  <!-- Host to Plugins: "mounts via" -->
  <path d="M 250 130 L 340 130" stroke="#374151" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <text x="295" y="120" text-anchor="middle" font-family="monospace" font-size="11" fill="#374151">mounts via</text>
  <text x="295" y="145" text-anchor="middle" font-family="monospace" font-size="9" fill="#6B7280">manifest</text>
  
  <!-- Plugins to Conductor: "play()" -->
  <path d="M 550 140 L 640 140" stroke="#374151" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <text x="595" y="130" text-anchor="middle" font-family="monospace" font-size="11" fill="#374151">play()</text>
  
  <!-- Conductor to Plugins: "callbacks" -->
  <path d="M 650 170 L 560 170" stroke="#374151" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <text x="605" y="160" text-anchor="middle" font-family="monospace" font-size="11" fill="#374151">callbacks</text>
  <text x="605" y="185" text-anchor="middle" font-family="monospace" font-size="9" fill="#6B7280">notify-ui()</text>
  
  <!-- Plugins to Host: "slots" (curved arrow back) -->
  <path d="M 350 200 Q 300 240 250 200" stroke="#374151" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <text x="300" y="235" text-anchor="middle" font-family="monospace" font-size="11" fill="#374151">"slots"</text>
  
  <!-- Bottom feedback loop arrow -->
  <path d="M 150 210 Q 150 260 450 260 Q 750 260 750 210" stroke="#6B7280" stroke-width="2" fill="none" stroke-dasharray="5,5"/>
  <text x="450" y="280" text-anchor="middle" font-family="monospace" font-size="10" fill="#6B7280" font-style="italic">
    UI renders; side-effects live in symphonies
  </text>
  
  <!-- Connection indicators with small circles -->
  <circle cx="250" cy="130" r="4" fill="#3B82F6"/>
  <circle cx="340" cy="130" r="4" fill="#10B981"/>
  <circle cx="550" cy="140" r="4" fill="#10B981"/>
  <circle cx="640" cy="140" r="4" fill="#8B5CF6"/>
  <circle cx="650" cy="170" r="4" fill="#8B5CF6"/>
  <circle cx="560" cy="170" r="4" fill="#10B981"/>
  <circle cx="350" cy="200" r="4" fill="#10B981"/>
  <circle cx="250" cy="200" r="4" fill="#3B82F6"/>
  
  <!-- Legend Box -->
  <rect x="50" y="320" width="800" height="120" rx="8" ry="8" 
        fill="#F9FAFB" stroke="#D1D5DB" stroke-width="1"/>
  
  <text x="450" y="340" text-anchor="middle" font-family="monospace" font-size="12" font-weight="bold" fill="#1F2937">
    Architecture Flow Legend
  </text>
  
  <text x="70" y="365" font-family="monospace" font-size="11" fill="#1F2937">
    1. Thin-Client Host mounts plugins via manifest configuration
  </text>
  <text x="70" y="385" font-family="monospace" font-size="11" fill="#1F2937">
    2. Plugins call play() method on Musical Conductor to execute sequences
  </text>
  <text x="70" y="405" font-family="monospace" font-size="11" fill="#1F2937">
    3. Musical Conductor sends callbacks and notify-ui() responses back to plugins
  </text>
  <text x="70" y="425" font-family="monospace" font-size="11" fill="#1F2937">
    4. Plugins render UI through "slots" while side-effects are managed in symphonies
  </text>
</svg>