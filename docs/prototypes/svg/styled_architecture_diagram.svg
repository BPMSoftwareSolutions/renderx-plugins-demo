<svg width="900" height="500" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <!-- CSS for theme awareness -->
    <style>
      <![CDATA[
      /* Light theme (default) */
      .bg-primary { fill: #ffffff; }
      .bg-secondary { fill: #f8fafc; }
      .text-primary { fill: #0f172a; }
      .text-secondary { fill: #334155; }
      .text-muted { fill: #64748b; }
      .border-light { stroke: #e2e8f0; }
      .grid-light { stroke: #f1f5f9; }
      .shadow-light { flood-color: #000000; flood-opacity: 0.15; }
      
      /* Host theme colors */
      .host-bg-start { stop-color: #e0f2fe; }
      .host-bg-mid { stop-color: #bae6fd; }
      .host-bg-end { stop-color: #0ea5e9; }
      .host-text { fill: #0c4a6e; }
      .host-text-secondary { fill: #075985; }
      .host-accent { fill: #0369a1; }
      
      /* Plugin theme colors */
      .plugin-bg-start { stop-color: #ecfdf5; }
      .plugin-bg-mid { stop-color: #bbf7d0; }
      .plugin-bg-end { stop-color: #10b981; }
      .plugin-text { fill: #064e3b; }
      .plugin-text-secondary { fill: #047857; }
      .plugin-accent { fill: #059669; }
      
      /* Conductor theme colors */
      .conductor-bg-start { stop-color: #faf5ff; }
      .conductor-bg-mid { stop-color: #ddd6fe; }
      .conductor-bg-end { stop-color: #8b5cf6; }
      .conductor-text { fill: #4c1d95; }
      .conductor-text-secondary { fill: #5b21b6; }
      .conductor-accent { fill: #7c3aed; }
      
      /* Dark theme */
      @media (prefers-color-scheme: dark) {
        .bg-primary { fill: #0f172a; }
        .bg-secondary { fill: #1e293b; }
        .text-primary { fill: #f1f5f9; }
        .text-secondary { fill: #cbd5e1; }
        .text-muted { fill: #94a3b8; }
        .border-light { stroke: #334155; }
        .grid-light { stroke: #1e293b; }
        .shadow-light { flood-color: #000000; flood-opacity: 0.3; }
        
        /* Host dark theme */
        .host-bg-start { stop-color: #0c4a6e; }
        .host-bg-mid { stop-color: #0369a1; }
        .host-bg-end { stop-color: #0ea5e9; }
        .host-text { fill: #bae6fd; }
        .host-text-secondary { fill: #7dd3fc; }
        .host-accent { fill: #38bdf8; }
        
        /* Plugin dark theme */
        .plugin-bg-start { stop-color: #064e3b; }
        .plugin-bg-mid { stop-color: #047857; }
        .plugin-bg-end { stop-color: #10b981; }
        .plugin-text { fill: #bbf7d0; }
        .plugin-text-secondary { fill: #86efac; }
        .plugin-accent { fill: #34d399; }
        
        /* Conductor dark theme */
        .conductor-bg-start { stop-color: #4c1d95; }
        .conductor-bg-mid { stop-color: #5b21b6; }
        .conductor-bg-end { stop-color: #8b5cf6; }
        .conductor-text { fill: #ddd6fe; }
        .conductor-text-secondary { fill: #c4b5fd; }
        .conductor-accent { fill: #a78bfa; }
      }
      ]]>
    </style>
    
    <!-- Arrow markers with distinct colors -->
    <marker id="arrowheadForward" markerWidth="12" markerHeight="8" 
            refX="10" refY="4" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,8 L12,4 z" fill="#06b6d4"/>
    </marker>
    
    <marker id="arrowheadBack" markerWidth="12" markerHeight="8" 
            refX="10" refY="4" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,8 L12,4 z" fill="#f59e0b"/>
    </marker>
    
    <!-- Theme-aware gradients -->
    <linearGradient id="hostGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" class="host-bg-start"/>
      <stop offset="50%" class="host-bg-mid"/>
      <stop offset="100%" class="host-bg-end"/>
    </linearGradient>
    
    <linearGradient id="pluginGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" class="plugin-bg-start"/>
      <stop offset="50%" class="plugin-bg-mid"/>
      <stop offset="100%" class="plugin-bg-end"/>
    </linearGradient>
    
    <linearGradient id="conductorGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" class="conductor-bg-start"/>
      <stop offset="50%" class="conductor-bg-mid"/>
      <stop offset="100%" class="conductor-bg-end"/>
    </linearGradient>
    
    <!-- Theme-aware background gradient -->
    <linearGradient id="bgGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" class="bg-primary"/>
      <stop offset="100%" class="bg-secondary"/>
    </linearGradient>
    
    <!-- Shadow filter -->
    <filter id="dropShadow" x="-50%" y="-50%" width="200%" height="200%">
      <feDropShadow dx="2" dy="4" stdDeviation="3" class="shadow-light"/>
    </filter>
    
    <!-- Glow effect -->
    <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
      <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
      <feMerge> 
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
    
    <!-- Grid pattern -->
    <pattern id="gridPattern" width="20" height="20" patternUnits="userSpaceOnUse">
      <path d="M 20 0 L 0 0 0 20" fill="none" class="grid-light" stroke-width="0.5" opacity="0.3"/>
    </pattern>
  </defs>
  
  <!-- Theme-aware background -->
  <rect width="900" height="500" fill="url(#bgGradient)"/>
  <rect width="900" height="500" fill="url(#gridPattern)"/>
  
  <!-- Main title -->
  <text x="450" y="35" text-anchor="middle" font-family="'Segoe UI', system-ui, sans-serif" 
        font-size="24" font-weight="700" class="text-primary">
    Three-Codebase Architecture
  </text>
  <line x1="300" y1="45" x2="600" y2="45" class="border-light" stroke-width="2"/>
  
  <!-- Column Headers -->
  <g font-family="'JetBrains Mono', 'Fira Code', monospace" font-weight="600">
    <rect x="100" y="55" width="100" height="25" rx="12" class="host-bg-end" opacity="0.15"/>
    <text x="150" y="72" text-anchor="middle" font-size="12" class="host-text-secondary">
      THIN-CLIENT HOST
    </text>
    
    <rect x="400" y="55" width="100" height="25" rx="12" class="plugin-bg-end" opacity="0.15"/>
    <text x="450" y="72" text-anchor="middle" font-size="12" class="plugin-text-secondary">
      PLUGINS
    </text>
    
    <rect x="700" y="55" width="100" height="25" rx="12" class="conductor-bg-end" opacity="0.15"/>
    <text x="750" y="72" text-anchor="middle" font-size="12" class="conductor-text-secondary">
      MUSICAL CONDUCTOR
    </text>
  </g>
  
  <!-- Thin-Client Host Box -->
  <rect x="50" y="90" width="200" height="120" rx="12" ry="12" 
        fill="url(#hostGradient)" class="host-bg-end" stroke-width="2" 
        filter="url(#dropShadow)"/>
  
  <g font-family="'JetBrains Mono', 'Fira Code', monospace">
    <text x="150" y="115" text-anchor="middle" font-size="13" font-weight="700" class="host-text">
      App.tsx
    </text>
    <text x="150" y="130" text-anchor="middle" font-size="13" font-weight="700" class="host-text">
      PanelSlot
    </text>
    <text x="150" y="150" text-anchor="middle" font-size="11" class="host-text-secondary">
      SlotContainer
    </text>
    <text x="150" y="170" text-anchor="middle" font-size="11" class="host-text-secondary">
      initConductor()
    </text>
    <text x="150" y="190" text-anchor="middle" font-size="10" class="host-accent" font-style="italic">
      Entry Point
    </text>
  </g>
  
  <!-- Plugins Box -->
  <rect x="350" y="90" width="200" height="140" rx="12" ry="12" 
        fill="url(#pluginGradient)" class="plugin-bg-end" stroke-width="2" 
        filter="url(#dropShadow)"/>
  
  <g font-family="'JetBrains Mono', 'Fira Code', monospace">
    <text x="450" y="115" text-anchor="middle" font-size="13" font-weight="700" class="plugin-text">
      Library (ui)
    </text>
    <text x="450" y="135" text-anchor="middle" font-size="11" class="plugin-text-secondary">
      LibraryComponent (sym)
    </text>
    <text x="450" y="155" text-anchor="middle" font-size="13" font-weight="700" class="plugin-text">
      Canvas (ui)
    </text>
    <text x="450" y="175" text-anchor="middle" font-size="11" class="plugin-text-secondary">
      CanvasComponent (sym)
    </text>
    <text x="450" y="195" text-anchor="middle" font-size="13" font-weight="700" class="plugin-text">
      ControlPanel
    </text>
    <text x="450" y="210" text-anchor="middle" font-size="10" class="plugin-accent" font-style="italic">
      (ui + config)
    </text>
  </g>
  
  <!-- Musical Conductor Box -->
  <rect x="650" y="90" width="200" height="120" rx="12" ry="12" 
        fill="url(#conductorGradient)" class="conductor-bg-end" stroke-width="2" 
        filter="url(#dropShadow)"/>
  
  <g font-family="'JetBrains Mono', 'Fira Code', monospace">
    <text x="750" y="115" text-anchor="middle" font-size="13" font-weight="700" class="conductor-text">
      SequenceEngine
    </text>
    <text x="750" y="135" text-anchor="middle" font-size="11" class="conductor-text-secondary">
      EventBus / Logger
    </text>
    <text x="750" y="155" text-anchor="middle" font-size="11" class="conductor-text-secondary">
      Correlated logs (IDs)
    </text>
    <text x="750" y="175" text-anchor="middle" font-size="10" class="conductor-accent" font-style="italic">
      Orchestration
    </text>
  </g>
  
  <!-- Flow Arrows with distinct colors -->
  
  <!-- Host to Plugins: "mounts via" (FORWARD - cyan) -->
  <path d="M 250 130 L 340 130" stroke="#06b6d4" stroke-width="3" fill="none" 
        marker-end="url(#arrowheadForward)" filter="url(#glow)"/>
  <rect x="270" y="108" width="60" height="28" rx="14" class="bg-primary" class="border-light" opacity="0.95"/>
  <text x="300" y="118" text-anchor="middle" font-family="'Segoe UI', sans-serif" font-size="10" font-weight="600" class="text-primary">mounts via</text>
  <text x="300" y="130" text-anchor="middle" font-family="'Segoe UI', sans-serif" font-size="8" class="text-muted">manifest</text>
  
  <!-- Plugins to Conductor: "play()" (FORWARD - cyan) -->
  <path d="M 550 140 L 640 140" stroke="#06b6d4" stroke-width="3" fill="none" 
        marker-end="url(#arrowheadForward)" filter="url(#glow)"/>
  <rect x="575" y="125" width="40" height="20" rx="10" class="bg-primary" class="border-light" opacity="0.95"/>
  <text x="595" y="137" text-anchor="middle" font-family="'Segoe UI', sans-serif" font-size="10" font-weight="600" class="text-primary">play()</text>
  
  <!-- Conductor to Plugins: "callbacks" (BACK - orange) -->
  <path d="M 650 170 L 560 170" stroke="#f59e0b" stroke-width="3" fill="none" 
        marker-end="url(#arrowheadBack)" filter="url(#glow)"/>
  <rect x="580" y="148" width="50" height="28" rx="14" class="bg-primary" class="border-light" opacity="0.95"/>
  <text x="605" y="158" text-anchor="middle" font-family="'Segoe UI', sans-serif" font-size="10" font-weight="600" class="text-primary">callbacks</text>
  <text x="605" y="170" text-anchor="middle" font-family="'Segoe UI', sans-serif" font-size="8" class="text-muted">notify-ui()</text>
  
  <!-- Plugins to Host: "slots" (BACK - orange) -->
  <path d="M 350 200 Q 300 240 250 200" stroke="#f59e0b" stroke-width="3" fill="none" 
        marker-end="url(#arrowheadBack)" filter="url(#glow)"/>
  <rect x="275" y="225" width="35" height="20" rx="10" class="bg-primary" class="border-light" opacity="0.95"/>
  <text x="292" y="237" text-anchor="middle" font-family="'Segoe UI', sans-serif" font-size="10" font-weight="600" class="text-primary">slots</text>
  
  <!-- Bottom feedback loop arrow -->
  <path d="M 150 210 Q 150 265 450 265 Q 750 265 750 210" class="text-muted" stroke-width="2" 
        fill="none" stroke-dasharray="6,4" opacity="0.7"/>
  <rect x="350" y="270" width="200" height="20" rx="10" class="bg-secondary" class="border-light" opacity="0.95"/>
  <text x="450" y="282" text-anchor="middle" font-family="'Segoe UI', sans-serif" font-size="10" 
        class="text-secondary" font-style="italic">
    UI renders; side-effects live in symphonies
  </text>
  
  <!-- Connection indicators -->
  <g filter="url(#glow)">
    <circle cx="250" cy="130" r="5" class="host-bg-end" class="bg-primary" stroke-width="2"/>
    <circle cx="340" cy="130" r="5" class="plugin-bg-end" class="bg-primary" stroke-width="2"/>
    <circle cx="550" cy="140" r="5" class="plugin-bg-end" class="bg-primary" stroke-width="2"/>
    <circle cx="640" cy="140" r="5" class="conductor-bg-end" class="bg-primary" stroke-width="2"/>
    <circle cx="650" cy="170" r="5" class="conductor-bg-end" class="bg-primary" stroke-width="2"/>
    <circle cx="560" cy="170" r="5" class="plugin-bg-end" class="bg-primary" stroke-width="2"/>
    <circle cx="350" cy="200" r="5" class="plugin-bg-end" class="bg-primary" stroke-width="2"/>
    <circle cx="250" cy="200" r="5" class="host-bg-end" class="bg-primary" stroke-width="2"/>
  </g>
  
  <!-- Legend Box -->
  <rect x="50" y="320" width="800" height="130" rx="12" ry="12" 
        class="bg-primary" class="border-light" stroke-width="1" filter="url(#dropShadow)"/>
  
  <rect x="60" y="330" width="780" height="3" rx="1.5">
    <animate attributeName="fill" values="#0ea5e9;#10b981;#8b5cf6;#0ea5e9" dur="6s" repeatCount="indefinite"/>
  </rect>
  
  <text x="450" y="350" text-anchor="middle" font-family="'Segoe UI', sans-serif" 
        font-size="14" font-weight="700" class="text-primary">
    Architecture Flow Overview
  </text>
  
  <g font-family="'Segoe UI', sans-serif" font-size="11" class="text-secondary">
    <g>
      <circle cx="80" cy="370" r="4" class="host-bg-end"/>
      <text x="95" y="375">Thin-Client Host mounts plugins via manifest configuration</text>
    </g>
    <g>
      <circle cx="80" cy="390" r="4" class="plugin-bg-end"/>
      <text x="95" y="395">Plugins call play() method on Musical Conductor to execute sequences</text>
    </g>
    <g>
      <circle cx="80" cy="410" r="4" class="conductor-bg-end"/>
      <text x="95" y="415">Musical Conductor sends callbacks and notify-ui() responses back to plugins</text>
    </g>
    <g>
      <circle cx="80" cy="430" r="4" class="text-muted"/>
      <text x="95" y="435">Plugins render UI through "slots" while side-effects are managed in symphonies</text>
    </g>
  </g>
</svg>