import{getCanvasRect as M}from"./select.overlay.dom.stage-crew-T3p4uTrs.js";import{E as N}from"./EventRouter-DUQzZvsb.js";import{r as W}from"./interactionManifest-BORsh5a3.js";import"./select.overlay.css.stage-crew-CJxa9lQN.js";function f(t){const e=parseFloat(t||"");return Number.isFinite(e)?e:null}function T(t){const e=(t.getAttribute("data-resize-enabled")||"true")!=="false",a=parseFloat(t.getAttribute("data-resize-min-w")||"1"),n=parseFloat(t.getAttribute("data-resize-min-h")||"1");return{enabled:e,minW:Number.isFinite(a)?Math.max(1,a):1,minH:Number.isFinite(n)?Math.max(1,n):1}}function k(t,e){if(t._rxResizeAttached)return;t._rxResizeAttached=!0;const a=n=>{const p=n.target;if(!p||!p.classList.contains("rx-handle"))return;n.preventDefault();const g=Array.from(p.classList).find(i=>["n","s","e","w","nw","ne","sw","se"].includes(i)),h=t.dataset.targetId;if(!g||!h)return;const s=document.getElementById(h);if(!s||!T(s).enabled)return;const v=M(),c=s.getBoundingClientRect(),F=f(s.style.left),A=f(s.style.top),E=f(s.style.width),L=f(s.style.height),x=F??c.left-v.left,R=A??c.top-v.top,H=E??c.width,I=L??c.height,q=n.clientX,C=n.clientY,m=(i,d,o="move")=>{if(!e?.play)throw new Error("Conductor is required for resize operations but was not provided");const u={id:h,dir:g,startLeft:x,startTop:R,startWidth:H,startHeight:I},l=o==="move"?{...u,dx:i,dy:d,phase:"move"}:{...u,phase:o},w=o==="start"?"canvas.component.resize.start":o==="end"?"canvas.component.resize.end":"canvas.component.resize.move";try{N.publish(w,l,e)}catch{const z=W(w);e.play(z.pluginId,z.sequenceId,l)}};let r=0;const y=i=>{const d=i.clientX-q,o=i.clientY-C;m(d,o,"move");const u=typeof requestAnimationFrame=="function"?requestAnimationFrame:l=>setTimeout(()=>l(performance.now()),0);r&&cancelAnimationFrame(r),r=u(()=>m(d,o,"move"))},b=()=>{try{r&&cancelAnimationFrame(r)}catch{}r=0,m(0,0,"end"),document.removeEventListener("mousemove",y),document.removeEventListener("mouseup",b)};m(0,0,"start"),document.addEventListener("mousemove",y),document.addEventListener("mouseup",b)};t.addEventListener("mousedown",a)}export{k as attachResizeHandlers};
