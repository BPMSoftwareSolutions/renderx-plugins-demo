import{C as M}from"./chunk-CMHQFAJR-C6rTeyx0.js";var R=new M;function S(C,o){return R.extractContent(C,o)}var B=(C,o)=>{try{let l=o.payload.components||[],I=new Set((l||[]).map(n=>n.id));const f=[],y=typeof document<"u"?document.getElementById("rx-canvas"):null;if(!y){o.payload.error="Canvas container not found",o.payload.layoutData=[],o.payload.canvasMetadata={width:0,height:0};return}const v=y.getBoundingClientRect(),E=window.getComputedStyle(y);if(o.payload.canvasMetadata={width:parseInt(E.width)||v.width||0,height:parseInt(E.height)||v.height||0},!l||l.length===0){const n=document.getElementById("rx-canvas");if(n){const t=[],r=n.querySelectorAll(".rx-comp");for(const a of Array.from(r)){const e=a,i=Array.from(e.classList),u=i.find(d=>d.startsWith("rx-")&&d!=="rx-comp"),s=u?u.replace("rx-",""):e.tagName.toLowerCase(),w=window.getComputedStyle(e),m={},g=["padding","margin","border","borderRadius","background","backgroundColor","color","fontSize","fontWeight","textAlign","boxShadow","width","height"];for(const d of g){const c=w.getPropertyValue(d);c&&c!=="initial"&&c!=="normal"&&c!=="auto"&&(m[d]=c)}const p=S(e,s);t.push({id:e.id,type:s,classes:i,style:m,content:p,createdAt:Date.now()})}o.payload.components=t,l=t,I=new Set(t.map(a=>a.id))}}const b=n=>{let t=n?.parentElement||null;for(;t;){const r=t.id||null;if(t.classList?.contains("rx-container")&&r&&(o.payload.components||[]).some(e=>e.id===r))return r;t=t.parentElement}return null},x=(n,t)=>{if(!t)return 0;const r=n.parentElement;if(!r)return 0;const e=Array.from(r.children).filter(i=>i.id&&I.has(i.id));return Math.max(0,e.findIndex(i=>i.id===n.id))};for(const n of l){const t=document.getElementById(n.id);if(!t){f.push({id:n.id,x:0,y:0,width:0,height:0,missing:!0,parentId:null,siblingIndex:0});continue}const r=S(t,n.type);Object.keys(r).length>0&&(n.content={...n.content,...r});let a=0,e=0,i=0,u=0;const s=window.getComputedStyle(t),w=parseInt(s.left)||0,m=parseInt(s.top)||0,g=s.transform;if(g&&g!=="none"){const h=g.match(/translate\(([^,]+),\s*([^)]+)\)/);h?(a=parseInt(h[1])||0,e=parseInt(h[2])||0):(a=w,e=m)}else a=w,e=m;const p=t.getBoundingClientRect();if(i=parseInt(s.width)||p.width||0,u=parseInt(s.height)||p.height||0,a===0&&e===0&&s.position!=="absolute"){const h=y.getBoundingClientRect();a=p.left-h.left,e=p.top-h.top}const d=b(t),c=x(t,d);f.push({id:n.id,x:Math.round(a),y:Math.round(e),width:Math.round(i),height:Math.round(u),parentId:d,siblingIndex:c})}o.payload.layoutData=f,o.logger?.info?.(`Collected layout data for ${f.length} components`)}catch(l){o.logger?.error?.("Failed to collect layout data:",l),o.payload.error=String(l),o.payload.layoutData=[],o.payload.canvasMetadata={width:0,height:0}}};export{B as collectLayoutData};
