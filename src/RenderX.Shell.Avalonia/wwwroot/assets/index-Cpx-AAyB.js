import{E as d}from"./EventRouter-DUQzZvsb.js";function u(t,e){t?.setData("application/rx-component",JSON.stringify({component:e}))}function m(t,e){const n=t?.target||null,r=e?.template?.dimensions;let i,s;if(r&&(Number.isFinite(r.width)&&(i=r.width),Number.isFinite(r.height)&&(s=r.height)),(!i||!s)&&n?.getBoundingClientRect){const o=n.getBoundingClientRect();i=i??Math.round(o.width),s=s??Math.round(o.height)}return i=i??120,s=s??40,{width:i,height:s,targetEl:n}}function y(t,e){const n=document.createElement("div");return n.style.width=`${t}px`,n.style.height=`${e}px`,n.style.boxSizing="border-box",n.style.padding="0",n.style.margin="0",n.style.position="absolute",n.style.left="-9999px",n.style.top="-9999px",n.style.pointerEvents="none",n.style.background="transparent",n.style.filter="blur(2px)",n.style.opacity="0.9",n}function g(t,e,n,r){if(!e||typeof e!="object")return;const i=e?.tag||"div",s=String(i).toLowerCase()==="svg",o=s?document.createElementNS("http://www.w3.org/2000/svg","svg"):document.createElement(i);try{(Array.isArray(e?.classes)?e.classes:[]).forEach(a=>o.classList.add(a))}catch{}if(!s&&typeof e?.text=="string"&&(o.textContent=e.text),o.style.width=`${n}px`,o.style.height=`${r}px`,o.style.display="inline-block",s){o.setAttribute("width","100%"),o.setAttribute("height","100%"),o.setAttribute("viewBox","0 0 100 100"),o.setAttribute("preserveAspectRatio","none");const a=document.createElementNS("http://www.w3.org/2000/svg","line");a.setAttribute("class","segment"),a.setAttribute("x1","0"),a.setAttribute("y1","50"),a.setAttribute("x2","100"),a.setAttribute("y2","50"),a.setAttribute("vector-effect","non-scaling-stroke"),o.appendChild(a)}t.appendChild(o)}function h(t,e){if(!e||typeof e!="object")return;if(typeof e?.css=="string"){const r=document.createElement("style");r.textContent=e.css,t.appendChild(r)}const n=e?.cssVariables;if(n&&typeof n=="object")for(const[r,i]of Object.entries(n))try{const s=String(r).startsWith("--")?String(r):`--${r}`;t.style.setProperty(s,String(i))}catch{}}function f(t,e,n,r){let i=Math.round(n/2),s=Math.round(r/2);if(e&&typeof t?.clientX=="number"&&typeof t?.clientY=="number")try{const o=e.getBoundingClientRect();i=Math.max(0,Math.round(t.clientX-o.left)),s=Math.max(0,Math.round(t.clientY-o.top))}catch{}return{offsetX:i,offsetY:s}}function b(t,e,n,r){document.body.appendChild(e);try{t.setDragImage(e,n,r)}finally{typeof requestAnimationFrame=="function"?requestAnimationFrame(()=>e.remove()):setTimeout(()=>e.remove(),0)}}var p={onDragStart(t){const e=t?.domEvent,n=e?.dataTransfer;u(n,t?.component);try{if(n?.setDragImage){const{width:r,height:i,targetEl:s}=m(e,t?.component),o=y(r,i);g(o,t?.component?.template,r,i),h(o,t?.component?.template);const{offsetX:c,offsetY:a}=f(e,s,r,i);b(n,o,c,a)}}catch{}return{started:!0}}},v=()=>typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,l={async publishCreateRequested(t,e){const n=t?.correlationId||v()||String(Date.now());await d.publish("canvas.component.create.requested",{component:t.component,position:t.position,containerId:t.containerId,correlationId:n},e.conductor)}},w=()=>typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,D={async publishCreateRequested(t,e){const n=t?.correlationId||w()||String(Date.now());await d.publish("canvas.component.create.requested",{component:t.component,position:t.position,containerId:t.containerId,correlationId:n},e.conductor)}},I={onDragStart:p.onDragStart,publishCreateRequested:l.publishCreateRequested};async function S(t){if(!t?.mount)return;const e={pluginId:"LibraryComponentPlugin",id:"library-component-drag-symphony",name:"Library Component Drag",movements:[{id:"drag",name:"Drag",beats:[{beat:1,event:"library.component.drag.start.requested",handler:"onDragStart",kind:"pure",dynamics:"mf",timing:"immediate"}]}]},n={pluginId:"LibraryComponentPlugin",id:"library-component-drop-symphony",name:"Library Component Drop",movements:[{id:"drop",name:"Drop",beats:[{beat:1,event:"library:component:drop",handler:"publishCreateRequested",kind:"pure",dynamics:"mf",timing:"immediate"}]}]},r={pluginId:"LibraryComponentPlugin",id:"library-component-container-drop-symphony",name:"Library Component Container Drop",movements:[{id:"drop",name:"Drop",beats:[{beat:1,event:"library:container:drop",handler:"publishCreateRequested",kind:"pure",dynamics:"mf",timing:"immediate"}]}]},i=s=>{const o="_runtimeMountedSeqIds",c=t[o]||new Set;c.add(s),t[o]=c};await t.mount(e,p,e.pluginId),i(e.id),await t.mount(n,l,n.pluginId),i(n.id),await t.mount(r,D,r.pluginId),i(r.id)}export{I as handlers,S as register};
