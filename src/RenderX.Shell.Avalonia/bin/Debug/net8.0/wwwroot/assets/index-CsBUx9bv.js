import{u as _}from"./Header-A6BR6KQZ-DYj0DEFE.js";import{j as e,R as C,E as h}from"./EventRouter-DUQzZvsb.js";import{r as p}from"./interactionManifest-BORsh5a3.js";import{i as F}from"./feature-flags-IuyZAa4_.js";var R=null;async function w(a,s,o){a.preventDefault();const j=a.dataTransfer.getData("application/rx-component"),i=j?JSON.parse(j):{},v=a.currentTarget.getBoundingClientRect(),c=a.target,I=c?.getBoundingClientRect?.(),l=!!(c&&c.dataset?.role==="container"),d=l?c.id:void 0,N=l&&I?.left||v.left,E=l&&I?.top||v.top,g={x:a.clientX-N,y:a.clientY-E},x=i?.component,y=t=>{globalThis.__cpDragInProgress=!0;try{h.publish("canvas.component.drag.start",{id:t?.id,correlationId:t?.correlationId},s)}catch{}F("perf.cp.debug")&&console.log("Drag started:",t)},f=t=>{try{h.publish("canvas.component.drag.move",{event:"canvas:component:drag:move",...t},s)}catch{try{R||(R=p("canvas.component.drag.move"));const r=R;s?.play?.(r.pluginId,r.sequenceId,{event:"canvas:component:drag:move",...t})}catch{throw new Error("Unknown interaction key: canvas.component.drag.move")}}},n=t=>{globalThis.__cpDragInProgress=!1,F("perf.cp.debug")&&console.log("Drag ended:",t);try{const{id:b,position:D,correlationId:M}=t||{};h.publish("canvas.component.drag.end",{id:b,position:D,correlationId:M},s)}catch{}const r=globalThis.__cpPerf||{};let u=0;try{if(F("perf.cp.render.dedupe")){const b=Number(r.postDragRenderDelayMs);Number.isFinite(b)&&b>0&&(u=b)}}catch{}u>0&&globalThis.__cpTriggerRender&&setTimeout(()=>{try{globalThis.__cpTriggerRender()}catch{}},u)},m=t=>{const r=p("canvas.component.select");s?.play?.(r.pluginId,r.sequenceId,{...t})};try{const t=l?"library.container.drop.requested":"library.component.drop.requested";try{h.publish(t,{component:x,position:g,containerId:d,onComponentCreated:o,onDragStart:y,onDragMove:f,onDragEnd:n,onSelected:m},s)}catch{const u=p(l?"library.container.drop":"library.component.drop");s?.play?.(u.pluginId,u.sequenceId,{component:x,position:g,containerId:d,onComponentCreated:o,onDragStart:y,onDragMove:f,onDragEnd:n,onSelected:m})}}catch{const r=p(l?"library.container.drop":"library.component.drop");s?.play?.(r.pluginId,r.sequenceId,{component:x,position:g,containerId:d,onComponentCreated:o,onDragStart:y,onDragMove:f,onDragEnd:n,onSelected:m})}}function T(){const[a,s]=C.useState(100),[o,j]=C.useState("select"),[i,v]=C.useState(null),c=_(),I=()=>{s(n=>Math.min(n+25,200))},l=()=>{s(n=>Math.max(n-25,25))},d=n=>{j(n)},N=async()=>{try{const n=p("canvas.component.export");await c?.play?.(n.pluginId,n.sequenceId,{})}catch{}},E=async()=>{try{await h.publish("canvas.component.import.requested",{},c)}catch{}},g=async()=>{if(i)try{const n=p("canvas.component.export.gif");await c?.play?.(n.pluginId,n.sequenceId,{targetId:i,options:{}})}catch{}},x=async()=>{if(i)try{const n=p("canvas.component.export.mp4");await c?.play?.(n.pluginId,n.sequenceId,{targetId:i,options:{fps:30,durationMs:3e3,bitrate:2e6}})}catch{}};C.useEffect(()=>{if(!c)return;const n=t=>{v(t?.id||null)},m=h.subscribe("canvas.component.selection.changed",n);return()=>{m&&m()}},[c]);const y=!!i,f=!!i;return e.jsxs("div",{className:"canvas-header",children:[e.jsx("div",{className:"canvas-title",children:"ðŸŽ¯ Design Canvas"}),e.jsxs("div",{className:"canvas-controls",children:[e.jsx("div",{className:`canvas-control ${o==="select"?"active":""}`,"data-mode":"select",onClick:()=>d("select"),children:e.jsx("span",{children:"ðŸ”"})}),e.jsx("div",{className:`canvas-control ${o==="move"?"active":""}`,"data-mode":"move",onClick:()=>d("move"),children:e.jsx("span",{children:"âœ‹"})}),e.jsx("div",{className:`canvas-control ${o==="draw"?"active":""}`,"data-mode":"draw",onClick:()=>d("draw"),children:e.jsx("span",{children:"âœï¸"})}),e.jsx("div",{className:"canvas-divider"}),e.jsx("div",{className:"canvas-control",onClick:N,title:"Export Canvas",children:e.jsx("span",{children:"ðŸ’¾"})}),y&&e.jsx("div",{className:"canvas-control",onClick:g,title:"Export SVG to GIF",children:e.jsx("span",{children:"ðŸŽ¬"})}),f&&e.jsx("div",{className:"canvas-control",onClick:x,title:"Export SVG to MP4",children:e.jsx("span",{children:"ðŸŽ¥"})}),e.jsx("div",{className:"canvas-control",onClick:E,title:"Import .ui",children:e.jsx("span",{children:"ðŸ“‚"})}),e.jsx("div",{className:"canvas-divider"}),e.jsxs("div",{className:"zoom-controls",children:[e.jsx("button",{className:"zoom-btn",onClick:l,children:"âˆ’"}),e.jsxs("span",{className:"zoom-level",children:[a,"%"]}),e.jsx("button",{className:"zoom-btn",onClick:I,children:"+"})]}),e.jsx("div",{className:"canvas-control","data-action":"preview",children:e.jsx("span",{children:"ðŸ‘ï¸"})})]})]})}function z(){const a=_(),s=o=>{w(o,a)};return e.jsxs("div",{className:"canvas-area",children:[e.jsx(T,{}),e.jsxs("div",{className:"canvas-content",onDragOver:o=>o.preventDefault(),onDrop:s,children:[e.jsx("div",{className:"canvas-grid"}),e.jsx("div",{className:"drop-indicator"}),e.jsx("div",{id:"rx-canvas",style:{position:"absolute",inset:0}})]})]})}async function G(a){try{if(a&&a._canvasRegistered)return;a&&(a._canvasRegistered=!0)}catch{}}export{z as CanvasPage,G as register};
