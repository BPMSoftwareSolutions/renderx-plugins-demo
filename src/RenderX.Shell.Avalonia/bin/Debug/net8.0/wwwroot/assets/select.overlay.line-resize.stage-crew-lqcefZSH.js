import{getCanvasOrThrow as L}from"./select.overlay.dom.stage-crew-T3p4uTrs.js";import{E as $}from"./EventRouter-DUQzZvsb.js";import{r as C}from"./interactionManifest-BORsh5a3.js";import"./select.overlay.css.stage-crew-CJxa9lQN.js";function M(){if(typeof document>"u")return;const t="rx-line-overlay-styles";let o=document.getElementById(t);o||(o=document.createElement("style"),o.id=t,document.head.appendChild(o)),(o.textContent||"").includes(".rx-line-overlay")||o.appendChild(document.createTextNode(`
  .rx-line-overlay { position:absolute; pointer-events:none; z-index:11; }
  .rx-line-overlay .endpoint { position:absolute; width:10px; height:10px; background:#10b981; border:2px solid #fff; border-radius:50%; pointer-events:auto; box-sizing:border-box; }
  `))}function P(t){M();const o=L();let e=document.getElementById("rx-line-overlay");if(!e){e=document.createElement("div"),e.id="rx-line-overlay",e.className="rx-line-overlay";const a=document.createElement("div");a.className="endpoint a";const n=document.createElement("div");n.className="endpoint b",e.appendChild(a),e.appendChild(n),o.appendChild(e)}const s=t.getBoundingClientRect(),i=o.getBoundingClientRect();e.style.left=`${Math.round(s.left-i.left)}px`,e.style.top=`${Math.round(s.top-i.top)}px`,e.style.width=`${Math.round(s.width)}px`,e.style.height=`${Math.round(s.height)}px`;try{const a=typeof window<"u"&&t?getComputedStyle(t):{},n=(c,l)=>{const y=t.style.getPropertyValue(c),m=typeof a.getPropertyValue=="function"?a.getPropertyValue(c):"",u=parseFloat(String(y||m||l));return Number.isFinite(u)?u:parseFloat(l)},x=n("--x1","0"),d=n("--y1","0");let f=n("--x2",String(s.width)),v=n("--y2",String(d));const p=e.querySelector(".endpoint.a"),r=e.querySelector(".endpoint.b");p&&(p.style.left=`${Math.round(x-5)}px`,p.style.top=`${Math.round(d-5)}px`),r&&(r.style.left=`${Math.round(f-5)}px`,r.style.top=`${Math.round(v-5)}px`)}catch{}return e}function S(t,o){t._rxLineResizeAttached||(t._rxLineResizeAttached=!0,t.addEventListener("mousedown",e=>{const s=e.target;if(!s||!s.classList.contains("endpoint"))return;e.preventDefault();const i=s.classList.contains("a"),a=t.dataset.targetId;if(!a)return;const n=document.getElementById(a);if(!n)return;const x={x:e.clientX,y:e.clientY},d=(r,c=0,l=0)=>{const y=r==="start"?"canvas.component.resize.line.start":r==="end"?"canvas.component.resize.line.end":"canvas.component.resize.line.move",m={id:a,handle:i?"a":"b",dx:c,dy:l,phase:r},h=o?.play||window.RenderX?.conductor?.play;if(typeof h=="function")try{try{$.publish(y,m,o||window.RenderX?.conductor);return}catch{const u=C(y);h(u.pluginId,u.sequenceId,m);return}}catch{}if(r==="move"){const u=parseFloat(n.style.getPropertyValue(i?"--x1":"--x2")||"0"),w=parseFloat(n.style.getPropertyValue(i?"--y1":"--y2")||"0"),b=Math.round(u+c),E=Math.round(w+l);n.style.setProperty(i?"--x1":"--x2",`${b}`),n.style.setProperty(i?"--y1":"--y2",`${E}`);const g=t.querySelector(i?".endpoint.a":".endpoint.b");g&&(g.style.left=`${b-5}px`,g.style.top=`${E-5}px`)}};let f=0;const v=r=>{const c=r.clientX-x.x,l=r.clientY-x.y;d("move",c,l);const y=typeof requestAnimationFrame=="function"?requestAnimationFrame:m=>setTimeout(()=>m(performance.now()),0);f&&cancelAnimationFrame(f),f=y(()=>d("move",c,l))},p=()=>{d("end"),document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",p)};d("start"),document.addEventListener("mousemove",v),document.addEventListener("mouseup",p)}))}export{S as attachLineResizeHandlers,P as ensureLineOverlayFor};
