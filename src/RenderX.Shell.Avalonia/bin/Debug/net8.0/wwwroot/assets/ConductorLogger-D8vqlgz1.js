import{D as g,M as i}from"./index-eO-4ERyb.js";import"./global-CMa2Rm43.js";import"./EventRouter-DUQzZvsb.js";class _{constructor(e,t=!0){this.stacks=new Map,this.eventBus=e,this.enabled=t,this.eventBus.__conductorLogger=this,g.eventBus=this.eventBus}init(){this.enabled&&(this.eventBus.subscribe(i.SEQUENCE_STARTED,e=>this.push(e.requestId,{type:"sequence",label:`ðŸŽ¼ ${e.sequenceName}`})),this.eventBus.subscribe(i.SEQUENCE_COMPLETED,e=>this.pop(e.requestId,"sequence")),this.eventBus.subscribe(i.MOVEMENT_STARTED,e=>this.push(e.requestId,{type:"movement",label:`ðŸŽµ ${e.movementName}`})),this.eventBus.subscribe(i.MOVEMENT_COMPLETED,e=>this.pop(e.requestId,"movement")),this.eventBus.subscribe(i.BEAT_STARTED,e=>this.push(e.requestId,{type:"beat",label:`ðŸ¥ ${e.beat}: ${e.event}`})),this.eventBus.subscribe(i.BEAT_COMPLETED,e=>this.pop(e.requestId,"beat")),this.eventBus.subscribe(i.BEAT_FAILED,e=>this.pop(e.requestId,"beat")),this.eventBus.subscribe("plugin:handler:start",e=>this.push(e.requestId,{type:"handler",label:`ðŸ”§ ${e.pluginId}.${e.handlerName}`})),this.eventBus.subscribe("plugin:handler:end",e=>this.pop(e.requestId,"handler")),this.eventBus.subscribe("musical-conductor:log",e=>{const t=this.getIndent(e.requestId),o=e.pluginId?`ðŸ§© ${e.pluginId}${e.handlerName?"."+e.handlerName:""}`:"ðŸŽ¼",n=`${t}${o}`;switch(e.level){case"warn":console.warn(n,...e.message);break;case"error":console.error(n,...e.message);break;case"info":case"log":default:console.log(n,...e.message)}}),this.eventBus.subscribe("stage:cue",e=>{this.logStageCue(e)}))}push(e,t){const o=e||"__global__",n=this.stacks.get(o)||[];n.push(t),this.stacks.set(o,n);const a=this.getIndent(e);console.log(`${a}${t.label}`)}pop(e,t){const o=e||"__global__",n=this.stacks.get(o)||[];for(let a=n.length-1;a>=0;a--)if(n[a].type===t){n.splice(a,1);break}this.stacks.set(o,n)}getDepth(e){const t=e||"__global__";return(this.stacks.get(t)||[]).length}getIndent(e){const t=e||"__global__",o=(this.stacks.get(t)||[]).length;return"  ".repeat(Math.max(0,o))}logStageCue(e){if(!e||!e.operations||e.operations.length===0)return;const t=this.getIndent(),o=e.pluginId?`${e.pluginId}`:"unknown",n=e.correlationId||"no-correlation",a=e.meta?.handlerName?`.${e.meta.handlerName}`:"";console.log(`${t}ðŸŽ­ Stage Crew: ${o}${a} (${n})`),e.operations.forEach((s,c)=>{const r=`${t}  `,l=c===e.operations.length-1?"â””â”€":"â”œâ”€";switch(s.op){case"classes.add":console.log(`${r}${l} Add class "${s.value}" to ${s.selector}`);break;case"classes.remove":console.log(`${r}${l} Remove class "${s.value}" from ${s.selector}`);break;case"attr.set":console.log(`${r}${l} Set ${s.key}="${s.value}" on ${s.selector}`);break;case"style.set":console.log(`${r}${l} Set style ${s.key}="${s.value}" on ${s.selector}`);break;case"create":const h=s.classes?` classes=[${s.classes.join(", ")}]`:"",u=s.attrs?` attrs=${JSON.stringify(s.attrs)}`:"";console.log(`${r}${l} Create <${s.tag}>${h}${u} in ${s.parent}`);break;case"remove":console.log(`${r}${l} Remove ${s.selector}`);break;default:console.log(`${r}${l} Unknown operation: ${JSON.stringify(s)}`)}})}}export{_ as ConductorLogger};
