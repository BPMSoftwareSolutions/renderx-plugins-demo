import{applyOverlayRectForEl as M,getCanvasRect as Y}from"./select.overlay.dom.stage-crew-T3p4uTrs.js";import"./select.overlay.css.stage-crew-CJxa9lQN.js";function F(o,e=1){return o<e?e:o}function $(o){const e=(o.getAttribute("data-resize-enabled")||"true")!=="false",a=parseFloat(o.getAttribute("data-resize-min-w")||"1"),t=parseFloat(o.getAttribute("data-resize-min-h")||"1");return{enabled:e,minW:Number.isFinite(a)?Math.max(1,a):1,minH:Number.isFinite(t)?Math.max(1,t):1}}function g(o,e,a){const t=o.style.getPropertyValue(e);if(t){const s=parseFloat(t);if(Number.isFinite(s))return s}try{const s=getComputedStyle(o).getPropertyValue(e),r=parseFloat(s);if(Number.isFinite(r))return r}catch{}return a}function f(o,e,a){o.style.setProperty(e,String(Math.round(a)))}var A=o=>{const{id:e,onResizeStart:a}=o||{};try{const t=document.getElementById(String(e));if(t&&t.classList.contains("rx-line")){const s=t.getBoundingClientRect();t.dataset.lineBaseW=String(s.width||parseFloat(t.style.width)||0),t.dataset.lineBaseH=String(s.height||parseFloat(t.style.height)||0);const r=g(t,"--x1",0),l=g(t,"--y1",0),d=g(t,"--x2",parseFloat(t.dataset.lineBaseW||"0")||r),m=g(t,"--y2",l),x=g(t,"--cx",(r+d)/2),B=g(t,"--cy",(l+m)/2);t.dataset.lineBaseX1=String(r),t.dataset.lineBaseY1=String(l),t.dataset.lineBaseX2=String(d),t.dataset.lineBaseY2=String(m),t.dataset.lineBaseCx=String(x),t.dataset.lineBaseCy=String(B)}}catch{}if(typeof a=="function")try{a({id:e})}catch{}},P=(o,e)=>{const{id:a,dir:t,startLeft:s,startTop:r,startWidth:l,startHeight:d,dx:m,dy:x,onResize:B,phase:v}=o||{};if(!a)throw new Error("Missing id for resize");const n=typeof document<"u"?document.getElementById(String(a)):null;if(!n)throw new Error(`Canvas component with id ${a} not found`);const c=$(n);if(!c.enabled){const i={id:a,left:s,top:r,width:l,height:d};return e&&e.payload&&(e.payload.updatedLayout={x:i.left,y:i.top,width:i.width,height:i.height},e.payload.elementId=a),i}const W=Y();let p=typeof s=="number"?s:n.getBoundingClientRect().left-W.left,h=typeof r=="number"?r:n.getBoundingClientRect().top-W.top,y=typeof l=="number"?l:n.getBoundingClientRect().width,u=typeof d=="number"?d:n.getBoundingClientRect().height;if(v&&v!=="move"){const i={id:a,left:s,top:r,width:l,height:d};return e&&e.payload&&(e.payload.updatedLayout={x:i.left,y:i.top,width:i.width,height:i.height},e.payload.elementId=a),i}const b=Number(m),S=Number(x);if(!Number.isFinite(b)||!Number.isFinite(S)){const i={id:a,left:s,top:r,width:l,height:d};return e&&e.payload&&(e.payload.updatedLayout={x:i.left,y:i.top,width:i.width,height:i.height},e.payload.elementId=a),i}String(t).includes("e")&&(y=F(l+b,c.minW)),String(t).includes("s")&&(u=F(d+S,c.minH)),String(t).includes("w")&&(y=F(l-b,c.minW),p=s+b,y<=c.minW&&(p=s+(l-c.minW))),String(t).includes("n")&&(u=F(d-S,c.minH),h=r+S,u<=c.minH&&(h=r+(d-c.minH))),n.style.position="absolute",n.style.left=`${Math.round(p)}px`,n.style.top=`${Math.round(h)}px`,n.style.width=`${Math.round(y)}px`,n.style.height=`${Math.round(u)}px`;try{if(n.classList.contains("rx-line")){const i=parseFloat(n.dataset.lineBaseW||String(l)||"0")||0,H=parseFloat(n.dataset.lineBaseH||String(d)||"0")||0;if(i>0&&H>0){const C=y/i,R=u/H,N=parseFloat(n.dataset.lineBaseX1||"0")||0,w=parseFloat(n.dataset.lineBaseY1||"0")||0,E=parseFloat(n.dataset.lineBaseX2||String(i))||i,I=parseFloat(n.dataset.lineBaseY2||String(w))||w,L=parseFloat(n.dataset.lineBaseCx||String((N+E)/2)),X=parseFloat(n.dataset.lineBaseCy||String((w+I)/2));f(n,"--x1",N*C),f(n,"--y1",w*R),f(n,"--x2",E*C),f(n,"--y2",I*R),f(n,"--cx",L*C),f(n,"--cy",X*R)}}}catch{}const z=document.getElementById("rx-selection-overlay");if(z&&M(z,n),typeof B=="function")try{B({id:a,left:p,top:h,width:y,height:u})}catch{}return e&&e.payload&&(e.payload.updatedLayout={x:p,y:h,width:y,height:u},e.payload.elementId=a),{id:a,left:p,top:h,width:y,height:u}},V=o=>{const{id:e,onResizeEnd:a}=o||{};if(typeof a=="function")try{a({id:e})}catch{}try{const t=document.getElementById(String(e));t&&(delete t.dataset.lineBaseW,delete t.dataset.lineBaseH,delete t.dataset.lineBaseX1,delete t.dataset.lineBaseY1,delete t.dataset.lineBaseX2,delete t.dataset.lineBaseY2,delete t.dataset.lineBaseCx,delete t.dataset.lineBaseCy);const s=document.getElementById("rx-selection-overlay");t&&s&&M(s,t)}catch{}},T={startResize:A,updateSize:P,endResize:V};export{V as endResize,T as handlers,A as startResize,P as updateSize};
