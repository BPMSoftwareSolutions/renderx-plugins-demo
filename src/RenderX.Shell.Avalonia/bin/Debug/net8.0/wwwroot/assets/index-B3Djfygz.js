import{S as J}from"./chunk-FUFL4N7I-ClPrRS59.js";import{c as I}from"./chunk-RBWFAUMD-CqxTm3oP.js";import{R as h,j as t,E}from"./EventRouter-DUQzZvsb.js";import{u as _}from"./Header-A6BR6KQZ-DYj0DEFE.js";import{r as R}from"./interactionManifest-BORsh5a3.js";import{r as B}from"./index-CpUT_Mw0.js";function Q(e,s){switch(s.type){case"SET_SELECTED_ELEMENT":return{...e,selectedElement:s.payload,validationErrors:{},isDirty:!1};case"SET_CLASSES":return{...e,currentClasses:s.payload};case"TOGGLE_SECTION":const r=new Set(e.expandedSections);return r.has(s.payload)?r.delete(s.payload):r.add(s.payload),{...e,expandedSections:r};case"SET_VALIDATION_ERRORS":return{...e,validationErrors:s.payload};case"SET_DIRTY":return{...e,isDirty:s.payload};case"RESET_STATE":return{selectedElement:null,currentClasses:[],expandedSections:new Set(["content"]),validationErrors:{},isDirty:!1};default:return e}}var Z={selectedElement:null,currentClasses:[],expandedSections:new Set(["content"]),validationErrors:{},isDirty:!1};function ee(){const[e,s]=h.useReducer(Q,Z);return h.useEffect(()=>{const r=globalThis?.RenderX?.EventRouter,i=!!(r&&typeof r.subscribe=="function"),d=!!(E&&typeof E.subscribe=="function");try{console.log("[cp] useControlPanelState: mounting subscriptions",{hasSdkRouter:!!E,sdkHasSubscribe:d,hasGlobalRouter:!!globalThis?.RenderX?.EventRouter,globalHasSubscribe:i})}catch{}if(!i&&!d){try{console.warn("[cp] useControlPanelState: No EventRouter available; UI will not react to selection updates")}catch{}return()=>{}}const c=[],l=(p,n)=>{try{const o=p.subscribe("control.panel.selection.updated",g=>{try{console.log(`[cp] useControlPanelState:${n} selection.updated`,{id:g?.header?.id,type:g?.header?.type})}catch{}s({type:"SET_SELECTED_ELEMENT",payload:g}),s({type:"SET_CLASSES",payload:g?.classes||[]})}),u=p.subscribe("control.panel.classes.updated",g=>{try{console.log(`[cp] useControlPanelState:${n} classes.updated`,{count:Array.isArray(g?.classes)?g.classes.length:0})}catch{}g?.classes&&s({type:"SET_CLASSES",payload:g.classes})}),v=p.subscribe("canvas.component.selection.changed",g=>{try{const f=String(g?.id||"").trim();if(!f)return;const y=typeof document<"u"?document.getElementById(f):null;if(!y)return;const a=Array.from(y.classList||[]),m=a.find(N=>N.startsWith("rx-")&&N!=="rx-comp"),x=m?m.replace(/^rx-/,""):"unknown",S=y.getBoundingClientRect?.()||{x:0,y:0,width:0,height:0},k=typeof window<"u"&&window.getComputedStyle?window.getComputedStyle(y):{},b={header:{type:x,id:f},content:{content:y.textContent||""},layout:{x:S.x||0,y:S.y||0,width:S.width||0,height:S.height||0},styling:{"bg-color":k.backgroundColor||"","text-color":k.color||"","border-radius":k.borderRadius||"","font-size":k.fontSize||""},classes:a};try{console.log(`[cp] useControlPanelState:${n} fallback from selection.changed`,{id:f,type:x})}catch{}s({type:"SET_SELECTED_ELEMENT",payload:b}),s({type:"SET_CLASSES",payload:a})}catch(f){try{console.warn(`[cp] useControlPanelState:${n} fallback selection.changed handler error`,f)}catch{}}});typeof o=="function"&&c.push(o),typeof u=="function"&&c.push(u),typeof v=="function"&&c.push(v)}catch(o){try{console.warn(`[cp] useControlPanelState: failed to subscribe via ${n}:`,o)}catch{}}};return i&&l(r,"global"),d&&E!==r&&l(E,"sdk"),()=>{for(const p of c)try{p()}catch{}}},[]),{state:e,dispatch:s}}async function te(){try{if(typeof globalThis<"u"&&typeof globalThis.fetch=="function"){const s=await fetch("/plugins/control-panel/config/control-panel.schema.json");if(s.ok)return await s.json()}}catch{}return{version:"0.0.0-test",description:"Test fallback config",defaultSections:[{id:"content",title:"Content",icon:"ðŸ“",order:1,collapsible:!0,defaultExpanded:!0},{id:"layout",title:"Layout",icon:"ðŸ“",order:2,collapsible:!0,defaultExpanded:!0},{id:"styling",title:"Styling",icon:"ðŸŽ¨",order:3,collapsible:!0,defaultExpanded:!0},{id:"classes",title:"Classes",icon:"ðŸ·ï¸",order:4,collapsible:!0,defaultExpanded:!1,special:"classes"},{id:"events",title:"Events",icon:"âš¡",order:5,collapsible:!0,defaultExpanded:!1,special:"events"}],fieldTypes:{},componentTypeOverrides:{}}}function se(){const[e,s]=h.useState(null),[r,i]=h.useState(!0);return h.useEffect(()=>{let d=!0;return(async()=>{try{const l=await te(),p=new J(l);await p.loadComponentSchemas(["button","input","container","line","heading","paragraph","image","svg","html"]),d&&(s(p),i(!1))}catch{d&&i(!1)}})(),()=>{d=!1}},[]),{resolver:e,isLoading:r}}var A=!1,L=!1;function D(){const e=_(),[s,r]=h.useState(!1),i=h.useRef(null);h.useEffect(()=>{if(!e||s||L||A)return;(async()=>{A=!0;try{const u=(globalThis.__cpPerf||{}).batchedInit?"control.panel.ui.init.batched":"control.panel.ui.init",v=R(u);await e.play(v.pluginId,v.sequenceId,{componentTypes:["button","input","container","line"]}),L=!0,r(!0)}catch{L=!0,r(!0)}finally{if(A=!1,i.current)try{const o=R("control.panel.ui.render");e.play(o.pluginId,o.sequenceId,{selectedElement:i.current})}catch{}finally{i.current=null}}})()},[e,s]);const d=h.useCallback(n=>{if(!e||typeof globalThis<"u"&&globalThis.__cpDragInProgress)return;if(!s||!L||A){i.current=n;return}if(typeof globalThis<"u"&&!!globalThis.RenderX?.EventRouter)E.publish("control.panel.ui.render.requested",{selectedElement:n},e);else try{const u=R("control.panel.ui.render");e.play(u.pluginId,u.sequenceId,{selectedElement:n})}catch{}},[e,s]);h.useEffect(()=>{if(!(typeof globalThis>"u"))return globalThis.__cpTriggerRender=()=>d(null),()=>{try{globalThis.__cpTriggerRender&&delete globalThis.__cpTriggerRender}catch{}}},[d]);const c=h.useCallback((n,o,u)=>{if(!e||!s||!u)return;if(typeof globalThis<"u"&&!!globalThis.RenderX?.EventRouter)E.publish("control.panel.ui.field.change.requested",{fieldKey:n,value:o,selectedElement:u},e);else try{const g=R("control.panel.ui.field.change");e.play(g.pluginId,g.sequenceId,{fieldKey:n,value:o,selectedElement:u})}catch{}},[e,s]),l=h.useCallback((n,o)=>{if(!e||!s)return;if(typeof globalThis<"u"&&!!globalThis.RenderX?.EventRouter)E.publish("control.panel.ui.field.validate.requested",{fieldKey:n?.key||n,value:o,selectedElement:n},e);else try{const v=R("control.panel.ui.field.validate");e.play(v.pluginId,v.sequenceId,{field:n,value:o})}catch{}},[e,s]),p=h.useCallback(n=>{if(!e||!s)return;if(typeof globalThis<"u"&&!!globalThis.RenderX?.EventRouter)E.publish("control.panel.ui.section.toggle.requested",{sectionId:n},e);else try{const u=R("control.panel.ui.section.toggle");e.play(u.pluginId,u.sequenceId,{sectionId:n})}catch{}},[e,s]);return{isInitialized:s,triggerRender:d,handleFieldChange:c,handleFieldValidation:l,handleSectionToggle:p}}function ne(e,s){const r=_(),i=D(),d=h.useCallback((c,l)=>{if(e?.header?.id)try{const p=`${c}.requested`;try{E.publish(p,{id:e.header.id,...l},r),s({type:"SET_DIRTY",payload:!0});return}catch{const n=R(c);r?.play?.(n.pluginId,n.sequenceId,{id:e.header.id,...l}),s({type:"SET_DIRTY",payload:!0})}}catch{}},[r,e,s]);return{handleAttributeChange:(c,l)=>{i.isInitialized?i.handleFieldChange(c,l,e):d("canvas.component.update",{attribute:c,value:l})},handleAddClass:c=>c.trim()&&d("control.panel.classes.add",{className:c.trim()}),handleRemoveClass:c=>d("control.panel.classes.remove",{className:c}),handleCreateCssClass:(c,l)=>d("control.panel.css.create",{className:c,content:l}),handleEditCssClass:(c,l)=>d("control.panel.css.edit",{className:c,content:l}),handleDeleteCssClass:c=>d("control.panel.css.delete",{className:c}),toggleSection:c=>{i.isInitialized&&i.handleSectionToggle(c),s({type:"TOGGLE_SECTION",payload:c})}}}var V=({selectedElement:e})=>t.jsxs("div",{className:"control-panel-header",children:[t.jsx("h3",{children:"âš™ï¸ Properties Panel"}),e&&t.jsxs("div",{className:"element-info",children:[t.jsx("span",{className:"element-type",children:e.header.type}),t.jsxs("span",{className:"element-id",children:["#",e.header.id]})]})]}),ae=()=>t.jsxs("div",{className:"no-selection",children:[t.jsx("div",{className:"no-selection-icon",children:"ðŸŽ¯"}),t.jsx("h4",{children:"No Element Selected"}),t.jsx("p",{children:"Click on a component in the canvas to edit its properties and styling options."})]}),re=()=>t.jsxs("div",{className:"loading-state",children:[t.jsx("div",{className:"loading-spinner",children:"â³"}),t.jsx("p",{children:"Loading control panel..."})]}),H=({field:e,value:s,onChange:r,onValidate:i,disabled:d=!1,className:c=""})=>{const[l,p]=h.useState(s||""),[n,o]=h.useState([]);h.useEffect(()=>{p(s||"")},[s]);const u=g=>{const f=g.target.value;p(f);const y=[];e.required&&!f.trim()&&y.push(`${e.label} is required`),e.validation&&e.validation.forEach(a=>{switch(a.type){case"pattern":f&&!new RegExp(a.value).test(f)&&y.push(a.message||`${e.label} format is invalid`);break;case"min":f.length<a.value&&y.push(`${e.label} must be at least ${a.value} characters`);break;case"max":f.length>a.value&&y.push(`${e.label} must be at most ${a.value} characters`);break}}),o(y),i?.(y.length===0,y),r(f)},v=n.length>0;return t.jsxs("div",{className:`field-input text-input ${c}`,children:[t.jsx("input",{type:"text",className:`property-input ${v?"error":""}`,value:l,onChange:u,placeholder:e.placeholder,disabled:d,title:e.description}),v&&t.jsx("div",{className:"field-errors",children:n.map((g,f)=>t.jsx("span",{className:"field-error",children:g},f))})]})},oe=({field:e,value:s,onChange:r,onValidate:i,disabled:d=!1,className:c=""})=>{const[l,p]=h.useState(s?.toString()||""),[n,o]=h.useState([]);h.useEffect(()=>{p(s?.toString()||"")},[s]);const u=g=>{const f=g.target.value;p(f);const y=f===""?null:Number(f),a=[];e.required&&(f===""||y===null)&&a.push(`${e.label} is required`),f!==""&&(isNaN(y)||y===null)&&a.push(`${e.label} must be a valid number`),e.validation&&y!==null&&!isNaN(y)&&e.validation.forEach(m=>{switch(m.type){case"min":y<m.value&&a.push(`${e.label} must be at least ${m.value}`);break;case"max":y>m.value&&a.push(`${e.label} must be at most ${m.value}`);break}}),o(a),i?.(a.length===0,a),r(y)},v=n.length>0;return t.jsxs("div",{className:`field-input number-input ${c}`,children:[t.jsx("input",{type:"number",className:`property-input ${v?"error":""}`,value:l,onChange:u,placeholder:e.placeholder,disabled:d,title:e.description,step:"any"}),v&&t.jsx("div",{className:"field-errors",children:n.map((g,f)=>t.jsx("span",{className:"field-error",children:g},f))})]})},le=({field:e,value:s,onChange:r,onValidate:i,disabled:d=!1,className:c=""})=>{const[l,p]=h.useState([]),n=u=>{const v=u.target.value,g=[];e.required&&!v&&g.push(`${e.label} is required`),p(g),i?.(g.length===0,g),r(v)},o=l.length>0;return t.jsxs("div",{className:`field-input select-input ${c}`,children:[t.jsxs("select",{className:`property-input ${o?"error":""}`,value:s||"",onChange:n,disabled:d,title:e.description,children:[!e.required&&t.jsx("option",{value:"",children:e.placeholder||"Choose option..."}),e.options?.map(u=>t.jsx("option",{value:u.value.toString(),disabled:u.disabled,title:u.description,children:u.label},u.value.toString()))]}),o&&t.jsx("div",{className:"field-errors",children:l.map((u,v)=>t.jsx("span",{className:"field-error",children:u},v))})]})},ce=({field:e,value:s,onChange:r,onValidate:i,disabled:d=!1,className:c=""})=>{const l=p=>{const n=p.target.checked;i?.(!0,[]),r(n)};return t.jsx("div",{className:`field-input checkbox-input ${c}`,children:t.jsxs("label",{className:"property-label checkbox-label",children:[t.jsx("input",{type:"checkbox",checked:!!s,onChange:l,disabled:d,title:e.description}),t.jsx("span",{className:"checkbox-text",children:e.label}),e.description&&t.jsx("span",{className:"field-description",children:e.description})]})})},ie=({field:e,value:s,onChange:r,onValidate:i,disabled:d=!1,className:c=""})=>{const[l,p]=h.useState(s||"#000000"),[n,o]=h.useState([]);h.useEffect(()=>{p(s||"#000000")},[s]);const u=a=>/^#[0-9A-F]{6}$/i.test(a),v=a=>{const m=a.target.value;p(m);const x=[];e.required&&!m.trim()?x.push(`${e.label} is required`):m&&!u(m)&&x.push(`${e.label} must be a valid hex color (e.g., #FF0000)`),o(x),i?.(x.length===0,x),r(m)},g=a=>{const m=a.target.value;p(m),o([]),i?.(!0,[]),r(m)},f=n.length>0,y=u(l)?l:"#000000";return t.jsxs("div",{className:`field-input color-input ${c}`,children:[t.jsxs("div",{className:"color-input-container",children:[t.jsx("input",{type:"color",className:"color-picker",value:y,onChange:g,disabled:d,title:`Pick ${e.label}`}),t.jsx("input",{type:"text",className:`property-input color-text ${f?"error":""}`,value:l,onChange:v,placeholder:e.placeholder||"#007acc",disabled:d,title:e.description})]}),f&&t.jsx("div",{className:"field-errors",children:n.map((a,m)=>t.jsx("span",{className:"field-error",children:a},m))})]})},de=({isOpen:e,className:s="",content:r,onSave:i,onCancel:d})=>{const[c,l]=h.useState(r),[p,n]=h.useState(!1),o=h.useRef(null);h.useEffect(()=>{l(r),n(!1)},[r,e]),h.useEffect(()=>{e&&o.current&&setTimeout(()=>o.current?.focus(),100)},[e]);const u=t.jsx("div",{className:`modal-overlay ${e?"open":""}`,children:t.jsxs("div",{className:`modal ${s}`,children:[t.jsxs("div",{className:"modal-header",children:[t.jsx("h3",{children:"Full-screen Editor"}),t.jsxs("div",{className:"modal-actions",children:[t.jsx("button",{onClick:()=>d(),children:"Close"}),t.jsx("button",{className:"primary",disabled:!p,onClick:()=>i(c),title:p?"Apply changes":"No changes to apply",children:"Apply"})]})]}),t.jsx("div",{className:"modal-content",children:t.jsx("textarea",{ref:o,className:"css-editor-textarea",value:c,onChange:v=>{l(v.target.value),n(!0)},spellCheck:!1})})]})});return e?B.createPortal(u,globalThis.document?.body||null):null},ue=({field:e,value:s,onChange:r,onValidate:i,disabled:d=!1,className:c="",selectedElement:l=null})=>{const p=D(),[n,o]=h.useState(s||""),[u,v]=h.useState([]),[g,f]=h.useState(!1),[y,a]=h.useState(!1),m=h.useRef(null),x=e.rendererProps?.rows??8,S=e.rendererProps?.placeholder??"Paste SVG markupâ€¦";h.useEffect(()=>{o(s||"")},[s]);function k(j){const C=[];e.required&&!j.trim()&&C.push(`${e.label} is required`),v(C),i?.(C.length===0,C)}function b(j){const C=/^\s*<svg[\s>]/i.test(j||"");a(C)}const N=j=>{const C=j.target.value;o(C),k(C),b(C),r(C)};function P(j){try{const w=new DOMParser().parseFromString(`<root>${j}</root>`,"application/xml"),T=w.querySelector("parsererror");if(T)throw new Error(T.textContent||"XML parse error");const Y=new XMLSerializer().serializeToString(w.documentElement).replace(/^<root>|<\/root>$/g,"").replace(/>\s+</g,"><").replace(/></g,`>
<`).split(`
`);let $=0;return Y.map(M=>{/^<\//.test(M)&&($=Math.max(0,$-1));const W=`${"  ".repeat($)}${M}`;return/^<[^!?][^>]*[^/]>$/.test(M)&&($+=1),W}).join(`
`)}catch(C){return v([C?.message||"Failed to format XML"]),i?.(!1,[C?.message||"Failed to format XML"]),j}}function O(){const j=P(n);o(j),r(j)}function G(){m.current?.click()}async function K(j){const C=j.target.files?.[0];if(!C)return;const w=await C.text();o(w),b(w),r(w)}function U(j){try{const T=new DOMParser().parseFromString(j,"image/svg+xml").querySelector("svg");if(!T)throw new Error("No <svg> root found");const q=T.getAttribute("viewBox")||void 0,z=T.getAttribute("preserveAspectRatio")||void 0,F=T.innerHTML??new XMLSerializer().serializeToString(T).replace(/^<svg[^>]*>/i,"").replace(/<\/svg>$/i,"");p.isInitialized&&l?(p.handleFieldChange("svgMarkup",F,l),q&&p.handleFieldChange("viewBox",q,l),z&&p.handleFieldChange("preserveAspectRatio",z,l)):r(F),o(F),a(!1),k(F)}catch(C){v([C?.message||"Failed to extract from <svg>"]),i?.(!1,[C?.message||"Failed to extract from <svg>"])}}return t.jsxs("div",{className:`field-input code-textarea ${c}`,children:[t.jsxs("div",{className:"code-toolbar",children:[t.jsx("button",{className:"action-btn",type:"button",onClick:G,disabled:d,title:"Import SVG file",children:"Import"}),t.jsx("input",{ref:m,type:"file",accept:".svg,image/svg+xml",style:{display:"none"},onChange:K}),t.jsx("button",{className:"action-btn",type:"button",onClick:O,disabled:d,title:"Format XML",children:"Format"}),t.jsx("button",{className:"action-btn",type:"button",onClick:()=>f(!0),disabled:d,title:"Full-screen editor",children:"Fullâ€‘screen"})]}),y&&t.jsxs("div",{className:"extract-prompt",style:{marginBottom:6,fontSize:12},children:["Detected full ",t.jsx("code",{children:"<svg>"})," markup. Extract inner markup and apply attributes?",t.jsxs("div",{style:{display:"inline-flex",gap:8,marginLeft:8},children:[t.jsx("button",{type:"button",onClick:()=>U(n),children:"Apply"}),t.jsx("button",{type:"button",onClick:()=>a(!1),children:"Dismiss"})]})]}),t.jsx("textarea",{className:"property-input",rows:x,placeholder:S,value:n,onChange:N,disabled:d,spellCheck:!1,style:{fontFamily:"ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace"},title:e.description}),u.length>0&&t.jsx("div",{className:"field-errors",children:u.map((j,C)=>t.jsx("div",{className:"field-error",children:j},C))}),t.jsx(de,{isOpen:g,className:"code-editor-modal",content:n,onSave:j=>{f(!1),o(j),k(j),r(j)},onCancel:()=>f(!1)})]})};function pe(e){try{const i=new DOMParser().parseFromString(`<svg>${e}</svg>`,"image/svg+xml").querySelector("svg");if(!i)return null;const d=c=>{const l={};try{for(const p of Array.from(c.attributes||[]))l[p.name]=p.value}catch{}return{tag:c.tagName,id:c.id||void 0,attrs:l,children:Array.from(c.children).map(d)}};return d(i)}catch{return null}}function X({node:e,path:s,onSelect:r,selectedPath:i}){const[d,c]=h.useState(!0),l=h.useMemo(()=>{const n=e.attrs||{},o=["font-family","font-weight"],u=[],v=new Set;for(const a of o){const m=n[a];typeof m=="string"&&m.length&&(u.push(`${a}="${m}"`),v.add(a))}const g=15;if(u.join(" ").length<g){const a=["id","class","d","fill","stroke","font-size","x","y","width","height","points"];for(const m of a){if(v.has(m))continue;const x=n[m];if(typeof x!="string"||!x.length)continue;let S=x;if(m==="d"&&S.length>30&&(S=S.slice(0,30)+"â€¦"),u.push(`${m}="${S}"`),v.add(m),u.join(" ").length>=g)break}}const y=u.length?` ${u.join(" ")}`:"";return`<${e.tag}${y}>`},[e]),p=(e.children||[]).length>0;return t.jsxs("div",{style:{marginLeft:8,pointerEvents:"auto"},children:[t.jsxs("div",{style:{cursor:"pointer",userSelect:"none",display:"flex",alignItems:"center",gap:6,background:i===s||!s&&i===""?"var(--control-hover-bg)":void 0,borderRadius:i===s||!s&&i===""?4:void 0},title:"Click to highlight on canvas; click triangle to toggle",onMouseDown:n=>n.stopPropagation(),onClick:n=>n.stopPropagation(),children:[t.jsx("span",{role:"button",tabIndex:0,onClick:()=>c(n=>!n),onKeyDown:n=>{(n.key==="Enter"||n.key===" ")&&c(o=>!o)},style:{width:12,display:"inline-block"},children:p?d?"â–¾":"â–¸":"â€¢"}),t.jsx("span",{role:"button",tabIndex:0,onClick:()=>r(s),onKeyDown:n=>{(n.key==="Enter"||n.key===" ")&&r(s)},children:l})]}),d&&p&&t.jsx("div",{children:e.children.map((n,o)=>t.jsx(X,{node:n,path:s?`${s}/${o}`:`${o}`,onSelect:r,selectedPath:i},o))})]})}var he=({selectedElement:e})=>{const s=_(),r=e?.content?.svgMarkup||"",i=e?.header?.id,d=h.useMemo(()=>pe(r),[r]),[c,l]=h.useState("");h.useEffect(()=>{const n=E.subscribe("canvas.component.select.svg-node.changed",o=>{try{const u=String(o?.id||"");if(!u||u!==String(i||""))return;l(String(o?.path||""))}catch{}});return()=>n?.()},[i]);const p=async n=>{const o=String(n||"").replace(/^\//,"");if(l(o),!(!i||!s?.play))try{await E.publish("canvas.component.select.svg-node.requested",{id:i,path:o},s)}catch{}};return i?t.jsx("div",{className:"svg-tree-view",style:{fontFamily:"ui-sans-serif, system-ui",fontSize:12,pointerEvents:"auto"},children:d?t.jsx(X,{node:d,path:"",onSelect:p,selectedPath:c}):t.jsx("div",{style:{opacity:.7},children:"No child nodes"})}):null};function me(e){switch(e.toLowerCase()){case"rect":return"rect";case"circle":return"circle";default:return"generic"}}function fe(e){const s=[{key:"fill",label:"Fill",type:"color"},{key:"stroke",label:"Stroke",type:"color"},{key:"stroke-width",label:"Stroke Width",type:"number"},{key:"opacity",label:"Opacity",type:"number"}];switch(e){case"rect":return[...s,{key:"x",label:"X",type:"number"},{key:"y",label:"Y",type:"number"},{key:"width",label:"Width",type:"number"},{key:"height",label:"Height",type:"number"}];case"circle":return[...s,{key:"cx",label:"Center X",type:"number"},{key:"cy",label:"Center Y",type:"number"},{key:"r",label:"Radius",type:"number"}];default:return s}}var ge=e=>{const{selectedElement:s}=e,r=_(),i=s?.header?.id,[d,c]=h.useState(""),[l,p]=h.useState(null),[n,o]=h.useState({});h.useEffect(()=>{const f=E.subscribe("canvas.component.select.svg-node.changed",y=>{const a=String(y?.id||"");if(!a||a!==String(i||""))return;const m=String(y?.path||"");c(m);const x=String(y?.tag||"generic"),S=y?.attributes||{};p({tag:x}),o(S)});return()=>f?.()},[i]);const u=async(f,y)=>{if(!(!i||!d||!r?.play))try{o(a=>({...a,[f]:y||void 0})),await E.publish("canvas.component.update.svg-node.requested",{id:i,path:d,attribute:f,value:y||null},r)}catch{}};if(!i||!d||!l)return t.jsx("div",{className:"svg-node-inspector",style:{fontFamily:"ui-sans-serif, system-ui",fontSize:12,padding:8,opacity:.7},children:"Select an SVG sub-node to customize its properties"});const v=me(l.tag),g=fe(v);return t.jsxs("div",{className:"svg-node-inspector",style:{fontFamily:"ui-sans-serif, system-ui",fontSize:12,padding:8},children:[t.jsxs("div",{style:{marginBottom:8,fontWeight:600},children:["SVG Node: ",l.tag.toLowerCase()]}),g.map(({key:f,label:y,type:a})=>t.jsxs("div",{style:{marginBottom:8},children:[t.jsx("label",{style:{display:"block",marginBottom:2,fontSize:11},children:y}),a==="color"?t.jsxs("div",{style:{display:"flex",gap:4},children:[t.jsx("input",{type:"color",value:n[f]||"#000000",onChange:m=>u(f,m.target.value),style:{width:32,height:24}}),t.jsx("input",{type:"text",value:n[f]||"",onChange:m=>u(f,m.target.value),placeholder:"e.g., #ff0000",style:{flex:1,padding:"2px 4px",fontSize:11,border:"1px solid #ccc",borderRadius:2}})]}):t.jsx("input",{type:a==="number"?"number":"text",value:n[f]||"",onChange:m=>u(f,m.target.value),placeholder:a==="number"?"0":"",step:a==="number"&&f==="opacity"?"0.1":"1",min:a==="number"&&f==="opacity"?"0":void 0,max:a==="number"&&f==="opacity"?"1":void 0,style:{width:"100%",padding:"2px 4px",fontSize:11,border:"1px solid #ccc",borderRadius:2}})]},f))]})},ye={TextInput:H,NumberInput:oe,SelectInput:le,CheckboxInput:ce,ColorInput:ie,CodeTextarea:ue,SvgTreeView:he,SvgNodeInspector:ge};function ve(e){const r={text:"TextInput",number:"NumberInput",select:"SelectInput",checkbox:"CheckboxInput",color:"ColorInput",code:"CodeTextarea",svgTree:"SvgTreeView",svgNodeInspector:"SvgNodeInspector"}[e]||"TextInput";return ye[r]||H}function be(e,s){return s.split(".").reduce((r,i)=>r?.[i],e)}var xe=({field:e,selectedElement:s,onChange:r,onValidate:i})=>{const d=ve(e.type),c=be(s,e.path)||e.defaultValue,l=D(),p=(n,o)=>{l.isInitialized&&l.handleFieldValidation(e,c),i(e.key,n,o)};return t.jsxs("div",{className:"property-item",children:[e.type!=="checkbox"&&t.jsxs("label",{className:"property-label",children:[e.label,e.required&&t.jsx("span",{className:"required-indicator",children:"*"})]}),t.jsx(d,{field:e,value:c,onChange:n=>r(e.key,n),onValidate:p,selectedElement:s}),e.description&&e.type!=="checkbox"&&t.jsx("div",{className:"field-description",children:e.description})]})},Ce=({section:e,fields:s,selectedElement:r,isExpanded:i,onToggle:d,onChange:c,onValidate:l})=>{const p=s.filter(n=>n.section===e.id);return p.length===0?null:t.jsxs("div",{className:"property-section",children:[t.jsxs("div",{className:`property-section-title ${e.collapsible?"collapsible":""}`,onClick:e.collapsible?d:void 0,children:[t.jsx("span",{children:e.title}),e.collapsible&&t.jsx("span",{className:`collapse-icon ${i?"expanded":""}`,children:"â–¼"})]}),i&&t.jsx("div",{className:"property-grid",children:p.map(n=>t.jsx(xe,{field:n,selectedElement:r,onChange:c,onValidate:l},n.key))})]})},Se=({isOpen:e,className:s,cssContent:r,onSave:i,onCancel:d})=>{const[c,l]=h.useState(r),[p,n]=h.useState(!1),o=h.useRef(null);h.useEffect(()=>{l(r),n(!1)},[r,e]),h.useEffect(()=>{e&&o.current&&setTimeout(()=>o.current?.focus(),100)},[e]);const u=a=>{const m=a.target.value;l(m),n(m!==r)},v=()=>{i(c),n(!1)},g=()=>{p&&!globalThis.confirm?.("You have unsaved changes. Are you sure you want to cancel?")||(l(r),n(!1),d())},f=a=>{if(a.ctrlKey&&a.key==="s"&&(a.preventDefault(),v()),a.key==="Escape"&&(a.preventDefault(),g()),a.key==="Tab"){a.preventDefault();const m=a.target,x=m.selectionStart,S=m.selectionEnd,k=c.substring(0,x)+"  "+c.substring(S);l(k),n(!0),setTimeout(()=>{m.selectionStart=m.selectionEnd=x+2},0)}},y=()=>c.split(`
`).map((m,x)=>t.jsx("div",{className:"line-number",children:x+1},x+1));return e?B.createPortal(t.jsx("div",{className:"css-editor-modal-overlay",onClick:g,children:t.jsxs("div",{className:"css-editor-modal",onClick:a=>a.stopPropagation(),children:[t.jsxs("div",{className:"css-editor-header",children:[t.jsxs("div",{className:"css-editor-title",children:[t.jsx("span",{className:"css-editor-icon",children:"âœï¸"}),"Edit CSS Class"]}),t.jsx("button",{className:"css-editor-close",onClick:g,title:"Close (Esc)",children:"Ã—"})]}),t.jsx("div",{className:"css-editor-class-name",children:t.jsxs("span",{className:"css-class-selector",children:[".",s]})}),t.jsx("div",{className:"css-editor-content",children:t.jsxs("div",{className:"css-editor-container",children:[t.jsx("div",{className:"line-numbers",children:y()}),t.jsx("textarea",{ref:o,className:"css-editor-textarea",value:c,onChange:u,onKeyDown:f,placeholder:"/* Add your CSS properties here */",spellCheck:!1,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off"})]})}),t.jsxs("div",{className:"css-editor-footer",children:[t.jsxs("div",{className:"css-editor-info",children:[t.jsx("span",{className:"css-editor-hint",children:"ðŸ’¡ Use Ctrl+S to save, Esc to cancel"}),p&&t.jsx("span",{className:"css-editor-changes",children:"â€¢ Unsaved changes"})]}),t.jsxs("div",{className:"css-editor-actions",children:[t.jsx("button",{className:"css-editor-btn css-editor-btn-cancel",onClick:g,children:"Cancel"}),t.jsx("button",{className:"css-editor-btn css-editor-btn-save",onClick:v,disabled:!p,children:"Save Changes"})]})]})]})}),globalThis.document?.body||null):null},je=({classes:e,onAdd:s,onRemove:r,onEdit:i,onCreate:d,onDeleteClass:c})=>{const l=h.useRef(null),[p,n]=h.useState(!1),[o,u]=h.useState(""),[v,g]=h.useState(""),[f,y]=h.useState([]);h.useEffect(()=>{const b=()=>{y(I.getClassNames())};b();const N=E.subscribe("control.panel.css.registry.updated",b);return()=>{N()}},[]);const a=()=>{l.current?.value&&(s(l.current.value),l.current.value="")},m=b=>{const N=I.getClass(b);if(N)u(b),g(N.content),n(!0);else{const P=`.${b} {
  /* Add your CSS properties here */
  display: block;
  position: relative;
}`;u(b),g(P),n(!0)}},x=()=>{const b=l.current?.value?.trim();if(!b)return;if(I.hasClass(b)){alert(`CSS class "${b}" already exists. Use the edit button to modify it.`);return}const N=`.${b} {
  /* Add your CSS properties here */
  display: block;
  position: relative;
}`;u(b),g(N),n(!0),l.current&&(l.current.value="")},S=b=>{I.hasClass(o)?(I.updateClass(o,b),i?.(o,b)):(I.createClass(o,b),d?.(o,b),e.includes(o)||s(o)),n(!1),u(""),g("")},k=()=>{n(!1),u(""),g("")};return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"property-section",children:[t.jsx("div",{className:"property-section-title",children:"ðŸŽ¨ CSS Classes"}),t.jsxs("div",{className:"property-grid",children:[t.jsxs("div",{className:"property-item",children:[t.jsx("label",{className:"property-label",children:"Current Classes"}),t.jsx("div",{className:"css-classes-container",children:e.map((b,N)=>t.jsxs("div",{className:"css-class-item",children:[t.jsx("span",{className:"css-class-name",children:b}),t.jsxs("div",{className:"css-class-actions",children:[t.jsx("button",{className:"css-action-btn",onClick:()=>m(b),title:"Edit class",children:"âœï¸"}),t.jsx("button",{className:"css-action-btn remove",onClick:()=>r(b),title:"Remove from component",children:"âŒ"})]})]},N))})]}),t.jsxs("div",{className:"property-item",children:[t.jsx("label",{className:"property-label",children:"Add New Class"}),t.jsxs("div",{className:"add-class-controls",children:[t.jsx("input",{ref:l,className:"property-input",type:"text",placeholder:"Enter class name...",onKeyDown:b=>{b.key==="Enter"&&(b.preventDefault(),a())}}),t.jsx("button",{className:"add-class-btn",onClick:a,children:"Add"}),t.jsx("button",{className:"add-class-btn create-btn",onClick:x,title:"Create new CSS class",children:"Create"})]})]})]})]}),t.jsx(Se,{isOpen:p,className:o,cssContent:v,onSave:S,onCancel:k})]})};function Ee(){const{state:e,dispatch:s}=ee(),{resolver:r,isLoading:i}=se(),d=D(),{handleAttributeChange:c,handleAddClass:l,handleRemoveClass:p,handleCreateCssClass:n,handleEditCssClass:o,handleDeleteCssClass:u,toggleSection:v}=ne(e.selectedElement,s);h.useEffect(()=>{d.isInitialized&&d.triggerRender(e.selectedElement)},[d,e.selectedElement]);const{fields:g,sections:f}=h.useMemo(()=>{if(!r||!e.selectedElement)return{fields:[],sections:[]};const a=r.generatePropertyFields(e.selectedElement),m=r.generateSections(e.selectedElement.header.type);return{fields:a,sections:m}},[r,e.selectedElement]),y=(a,m,x)=>{const S={...e.validationErrors};m?delete S[a]:S[a]=x,s({type:"SET_VALIDATION_ERRORS",payload:S})};return i?t.jsxs("div",{className:"control-panel",children:[t.jsx(V,{selectedElement:null}),t.jsx("div",{className:"control-panel-content",children:t.jsx(re,{})})]}):t.jsxs("div",{className:"control-panel",children:[t.jsx(V,{selectedElement:e.selectedElement}),t.jsx("div",{className:"control-panel-content",children:e.selectedElement?t.jsxs("div",{className:"property-sections",children:[f.map(a=>t.jsx(Ce,{section:a,fields:g,selectedElement:e.selectedElement,isExpanded:e.expandedSections.has(a.id),onToggle:()=>v(a.id),onChange:c,onValidate:y},a.id)),t.jsx(je,{classes:e.currentClasses,onAdd:l,onRemove:p,onEdit:o,onCreate:n,onDeleteClass:u})]}):t.jsx(ae,{})})]})}async function Ne(e){}const $e=Object.freeze(Object.defineProperty({__proto__:null,ControlPanel:Ee,register:Ne},Symbol.toStringTag,{value:"Module"}));export{$e as C};
