import{c as ye,b as X,d as be,l as Pe,e as Se,f as Le,h as Ce,j as q,a as z,r as Me,k as Y,m as Ie}from"./global-CMa2Rm43.js";import{j as e,a as h,E as Te}from"./EventRouter-DUQzZvsb.js";const $e=()=>{const[m,d]=h.useState(null),[n,r]=h.useState(null),[c,g]=h.useState(new Set),[u,x]=h.useState(!1),[p,w]=h.useState([]),[j,Z]=h.useState(null),[T,ee]=h.useState(null),[se,ae]=h.useState(null),[$,te]=h.useState([]),[f,ne]=h.useState(null),[v,S]=h.useState({totalPlugins:0,loadedPlugins:0,failedPlugins:0,loadingTime:0}),[b,ie]=h.useState("plugins"),[l,le]=h.useState(""),[R,re]=h.useState(new Set),[k,A]=h.useState({}),[ce,_]=h.useState(0),i=h.useCallback((s,a,t)=>{const o={timestamp:new Date().toLocaleTimeString(),level:s,message:a,data:t};w(y=>[...y.slice(-99),o])},[]),U=h.useCallback(s=>{try{return{mountedPluginIds:s?.getMountedPluginIds?.()||[],discoveredPlugins:s?._discoveredPlugins||[],runtimeMountedSeqIds:Array.from(s?._runtimeMountedSeqIds||[]),sequenceCatalogDirs:s?._sequenceCatalogDirsFromManifest||[]}}catch(a){return i("warn","Failed to introspect conductor",a),{mountedPluginIds:[],discoveredPlugins:[],runtimeMountedSeqIds:[],sequenceCatalogDirs:[]}}},[i]),F=h.useCallback(async()=>{try{const s=await fetch("/interaction-manifest.json");if(s.ok){const t=(await s.json())?.routes||{},o=Object.entries(t).map(([N,C])=>({route:N,pluginId:C.pluginId,sequenceId:C.sequenceId}));return{...X(),routes:o}}}catch(s){i("error","Failed to load interaction manifest",s)}return X()},[i]),I=h.useCallback(async()=>{try{const[s,a,t,o]=await Promise.all([F(),Promise.resolve(Se()),be(),Pe().catch(()=>[])]);Z(s),ee(a),ae(t),te(o),m&&ne(U(m))}catch(s){i("error","Failed to update stats",s)}},[m,U,i,F]);h.useEffect(()=>{(async()=>{const a=Date.now();try{i("info","Initializing sophisticated plugin loader..."),i("info","Initializing conductor...");const t=await Ce();d(t),i("info","Conductor initialized successfully"),i("info","Loading manifests..."),await Promise.all([q(),z()]),i("info","Manifests loaded successfully"),i("info","Loading plugin manifest...");const o=await fetch("/plugins/plugin-manifest.json");if(o.ok){const N=await o.json();r(N),S(C=>({...C,totalPlugins:N.plugins?.length||0})),i("info",`Loaded ${N.plugins?.length||0} plugins from manifest`),i("info","Registering plugin runtimes..."),await Me(t),i("info","Plugin runtimes registered successfully")}else i("warn","Failed to load plugin manifest");await I();const y=Date.now()-a;i("info",`Initialization completed in ${y}ms`)}catch(t){i("error","Initialization failed",t)}})()},[i,I]);const oe=async()=>{if(!m||!n)return;x(!0);const s=Date.now();i("info","Loading all plugins...");try{await Y(m),g(new Set(n.plugins.map(t=>t.id))),i("info","Refreshing interaction and topics manifests..."),await Promise.all([q(),z()]),_(t=>t+1),i("info","Manifests refreshed");const a=Date.now()-s;S(t=>({...t,loadedPlugins:n.plugins.length,loadingTime:a})),i("info",`Loaded all ${n.plugins.length} plugins in ${a}ms`),await I()}catch(a){i("error","Failed to load all plugins",a),S(t=>({...t,failedPlugins:t.failedPlugins+1}))}finally{x(!1)}},de=async s=>{if(!m)return;x(!0);const a=Date.now();i("info",`Loading plugin: ${s}`);try{await Y(m,[s]),g(o=>new Set([...o,s])),i("info",`Refreshing manifests after loading ${s}...`),await Promise.all([q(),z()]),_(o=>o+1);const t=Date.now()-a;S(o=>({...o,loadedPlugins:o.loadedPlugins+1,loadingTime:o.loadingTime+t})),i("info",`Loaded plugin ${s} in ${t}ms`),await I()}catch(t){i("error",`Failed to load plugin ${s}`,t),S(o=>({...o,failedPlugins:o.failedPlugins+1}))}finally{x(!1)}},me=()=>{g(new Set),S(s=>({...s,loadedPlugins:0,failedPlugins:0})),i("info","Unloaded all plugins (UI state reset)")},he=async s=>{if(!m)return;const a=Date.now();try{i("info",`Testing interaction: ${s}`);const t=Ie(s);i("info",`Resolved to: ${t.pluginId} / ${t.sequenceId}`);const o=await m.play(t.pluginId,t.sequenceId,{test:!0,timestamp:Date.now()}),y=Date.now()-a;A(N=>({...N,[`interaction_${s}`]:y})),i("info",`Interaction test completed for ${s} in ${y}ms`,o)}catch(t){const o=Date.now()-a;A(y=>({...y,[`interaction_${s}_error`]:o})),i("error",`Interaction test failed for ${s} after ${o}ms`,t)}},ue=async s=>{if(m)try{i("info",`Testing topic: ${s}`),await Te.publish(s,{test:!0,timestamp:Date.now(),source:"plugin-loader-test"},m),i("info",`Topic test completed for ${s}`)}catch(a){i("error",`Topic test failed for ${s}`,a)}},pe=()=>{const s={timestamp:new Date().toISOString(),stats:{loading:v,interaction:j,topics:T,plugins:se,conductor:f},logs:p,manifest:n},a=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),t=URL.createObjectURL(a),o=document.createElement("a");o.href=t,o.download=`plugin-loader-report-${Date.now()}.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(t),i("info","Exported detailed report")},ge=()=>{w([]),i("info","Logs cleared")},xe=s=>{re(a=>{const t=new Set(a);return t.has(s)?t.delete(s):t.add(s),t})},B=h.useMemo(()=>!n||!l?n?.plugins||[]:n.plugins.filter(s=>s.id.toLowerCase().includes(l.toLowerCase())||s.ui?.slot?.toLowerCase().includes(l.toLowerCase())||s.ui?.module?.toLowerCase().includes(l.toLowerCase())),[n,l]),V=h.useMemo(()=>{const s=Le();return console.log("ðŸ” Topics loaded:",Object.keys(s).length,"topics"),console.log("ðŸ” Theme topics:",Object.keys(s).filter(a=>a.includes("theme"))),s},[ce]),W=h.useMemo(()=>{const s=Object.entries(V);return l?s.filter(([a])=>a.toLowerCase().includes(l.toLowerCase())):s},[V,l]),L=v.totalPlugins||0,E=v.loadedPlugins||0,D=v.failedPlugins||0,je=j?.routeCount||0,ve=T?.topicCount||0,H=v.loadingTime||0,Ne=(s,a=0,t=100)=>Math.max(a,Math.min(t,s)),fe=((s,a)=>a>0?Math.round(s/a*100):0)(E,L),J=L>0?Math.round((L-D)/L*100):0,we=Ne(Math.round(H/3e3*100)),O=({percentage:s,color:a="blue"})=>{const N=50*Math.PI,C=N-s/100*N;return e.jsxs("svg",{height:56,width:56,className:`ring ring-${a}`,children:[e.jsx("circle",{className:"ring-track",stroke:"var(--border-color)",fill:"transparent",strokeWidth:6,r:25,cx:28,cy:28}),e.jsx("circle",{className:"ring-progress",stroke:"currentColor",fill:"transparent",strokeWidth:6,strokeLinecap:"round",strokeDasharray:`${N} ${N}`,style:{strokeDashoffset:C},r:25,cx:28,cy:28}),e.jsxs("text",{x:"50%",y:"50%",dominantBaseline:"middle",textAnchor:"middle",className:"ring-label",children:[s,"%"]})]})};return e.jsxs("div",{className:"inspector-container",children:[e.jsxs("div",{className:"inspector-header",children:[e.jsx("h1",{className:"inspector-title",children:"RenderX Plugin Loading Test"}),e.jsx("p",{className:"inspector-subtitle",children:"Sophisticated Inspector - Vite-driven Plugin Loading with Detailed Introspection"})]}),e.jsxs("div",{className:"inspector-content",children:[e.jsxs("div",{className:"toolbar",children:[e.jsxs("div",{className:"toolbar-section",children:[e.jsx("h3",{className:"toolbar-title",children:"Plugin Loading Controls"}),e.jsx("div",{className:"toolbar-divider"}),e.jsxs("button",{className:"btn btn-primary btn-icon",onClick:oe,disabled:u||!m||!n,children:[u?e.jsx("span",{className:"loading-spinner"}):e.jsx("span",{className:"icon",children:"âš¡"}),"Load All Plugins"]}),e.jsxs("button",{className:"btn btn-danger btn-icon btn-sm",onClick:me,disabled:u,children:[e.jsx("span",{className:"icon",children:"ðŸ—‘ï¸"}),"Unload All"]})]}),e.jsxs("div",{className:"toolbar-section",children:[e.jsxs("button",{className:"btn btn-secondary btn-icon btn-sm",onClick:I,disabled:u,children:[e.jsx("span",{className:"icon",children:"ðŸ”„"}),"Refresh Stats"]}),e.jsxs("button",{className:"btn btn-warning btn-icon btn-sm",onClick:pe,children:[e.jsx("span",{className:"icon",children:"ðŸ“Š"}),"Export Report"]}),e.jsxs("button",{className:"btn btn-secondary btn-icon btn-sm",onClick:ge,children:[e.jsx("span",{className:"icon",children:"ðŸ§¹"}),"Clear Logs"]})]})]}),e.jsxs("div",{className:"control-panel",children:[e.jsx("h2",{children:"Plugin Statistics"}),e.jsx("div",{className:"stats-enhanced",children:e.jsxs("div",{className:"stats-dashboard",children:[e.jsxs("div",{className:"metric-grid-top",children:[e.jsxs("div",{className:"metric-card",children:[e.jsx("h3",{className:"metric-title",children:"Loading Progress"}),e.jsx("div",{className:"progress-ring",children:e.jsx(O,{percentage:fe,color:"blue"})}),e.jsxs("div",{className:"metric-value",children:[E," / ",L]}),e.jsx("div",{className:"metric-subtitle",children:"Successfully Loaded"})]}),e.jsxs("div",{className:"metric-card",children:[e.jsx("h3",{className:"metric-title",children:"Success Rate"}),e.jsx("div",{className:"progress-ring",children:e.jsx(O,{percentage:J,color:"green"})}),e.jsxs("div",{className:"metric-value",children:[J,"%"]}),e.jsxs("div",{className:"metric-subtitle",children:[D," failed"]})]}),e.jsxs("div",{className:"metric-card",children:[e.jsx("h3",{className:"metric-title",children:"Load Performance"}),e.jsx("div",{className:"progress-ring",children:e.jsx(O,{percentage:we,color:"orange"})}),e.jsxs("div",{className:"metric-value",children:[H,"ms"]}),e.jsx("div",{className:"metric-subtitle",children:"Target  3000ms"})]})]}),e.jsxs("div",{className:"metric-grid-bottom",children:[e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-label",children:"Total Plugins"}),e.jsx("div",{className:"metric-strong",children:L})]}),e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-label",children:"Loaded"}),e.jsx("div",{className:"metric-strong",children:E})]}),e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-label",children:"Failed"}),e.jsx("div",{className:"metric-strong",children:D})]}),e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-label",children:"Routes"}),e.jsx("div",{className:"metric-strong",children:je})]}),e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-label",children:"Topics"}),e.jsx("div",{className:"metric-strong",children:ve})]})]})]})})]}),e.jsx("div",{className:"control-panel",children:e.jsx("div",{className:"button-group",children:["plugins","topics","routes","components","conductor","performance"].map(s=>e.jsx("button",{className:`btn ${b===s?"btn-primary":"btn-secondary"}`,onClick:()=>ie(s),children:s.charAt(0).toUpperCase()+s.slice(1)},s))})}),e.jsx("input",{type:"text",className:"search-box",placeholder:`Search ${b}...`,value:l,onChange:s=>le(s.target.value)}),e.jsxs("div",{className:"grid",children:[b==="plugins"&&e.jsxs("div",{className:"panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsx("h3",{className:"panel-title",children:"Available Plugins"}),e.jsx("span",{className:"panel-badge",children:B.length})]}),e.jsx("div",{className:"panel-content",children:B.map(s=>e.jsxs("div",{className:"plugin-item",children:[e.jsxs("div",{className:"plugin-header",children:[e.jsx("h4",{className:"plugin-name",children:s.id}),e.jsxs("div",{className:"plugin-actions",children:[e.jsx("span",{className:`plugin-status ${c.has(s.id)?"status-loaded":"status-unloaded"}`,children:c.has(s.id)?"Loaded":"Unloaded"}),e.jsx("button",{className:"btn btn-primary",onClick:()=>de(s.id),disabled:u||c.has(s.id),style:{marginLeft:"0.5rem",padding:"0.25rem 0.5rem",fontSize:"0.75rem"},children:c.has(s.id)?"Loaded":"Load"})]})]}),e.jsxs("div",{className:"plugin-details",children:[s.ui&&e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"UI:"}),e.jsx("span",{className:"code",children:s.ui.slot})," â†’",e.jsxs("span",{className:"code",children:[s.ui.module,"#",s.ui.export]})]}),s.runtime&&e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Runtime:"}),e.jsxs("span",{className:"code",children:[s.runtime.module,"#",s.runtime.export]})]}),!s.ui&&!s.runtime&&e.jsx("div",{className:"detail-row",style:{color:"var(--text-muted)"},children:"No UI or runtime configuration"})]})]},s.id))})]}),b==="topics"&&e.jsxs("div",{className:"panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsx("h3",{className:"panel-title",children:"Topics"}),e.jsx("span",{className:"panel-badge",children:W.length})]}),e.jsx("div",{className:"panel-content",children:W.map(([s,a])=>e.jsxs("div",{className:"topic-item",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{className:`topic-name expandable ${R.has(s)?"expanded":""}`,onClick:()=>xe(s),style:{flex:1},children:s}),e.jsx("button",{className:"btn btn-primary",onClick:()=>ue(s),disabled:u||!m,style:{padding:"0.25rem 0.5rem",fontSize:"0.75rem"},children:"Test"})]}),e.jsxs("div",{className:"topic-routes",children:[a.routes.length," route(s) â€¢ ",a.visibility||"public"]}),e.jsxs("div",{className:`expandable-content ${R.has(s)?"expanded":""}`,children:[e.jsxs("div",{style:{marginBottom:"0.5rem"},children:[e.jsx("strong",{children:"Routes:"}),a.routes.map((t,o)=>e.jsxs("div",{style:{marginLeft:"1rem",fontSize:"0.8125rem"},children:["â†’ ",e.jsx("span",{className:"code",children:t.pluginId})," / ",e.jsx("span",{className:"code",children:t.sequenceId})]},o))]}),a.notes&&e.jsxs("div",{style:{marginBottom:"0.5rem"},children:[e.jsx("strong",{children:"Notes:"})," ",a.notes]}),a.perf&&e.jsxs("div",{style:{marginBottom:"0.5rem"},children:[e.jsx("strong",{children:"Performance:"}),a.perf.throttleMs&&` throttle: ${a.perf.throttleMs}ms`,a.perf.debounceMs&&` debounce: ${a.perf.debounceMs}ms`,a.perf.dedupeWindowMs&&` dedupe: ${a.perf.dedupeWindowMs}ms`]}),a.payloadSchema&&e.jsxs("div",{children:[e.jsx("strong",{children:"Payload Schema:"}),e.jsx("pre",{style:{fontSize:"0.75rem",background:"var(--bg-tertiary)",padding:"0.5rem",borderRadius:"4px",overflow:"auto",maxHeight:"200px"},children:JSON.stringify(a.payloadSchema,null,2)})]})]})]},s))})]}),b==="routes"&&e.jsxs("div",{className:"panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsx("h3",{className:"panel-title",children:"Interaction Routes"}),e.jsx("span",{className:"panel-badge",children:j?.routeCount||0})]}),e.jsx("div",{className:"panel-content",children:j?.routes?.filter(s=>!l||s.route.toLowerCase().includes(l.toLowerCase())).map((s,a)=>e.jsx("div",{className:"route-item",children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{className:"route-name",children:s.route}),e.jsxs("div",{className:"route-target",children:["â†’ ",e.jsx("span",{className:"code",children:s.pluginId})," / ",e.jsx("span",{className:"code",children:s.sequenceId})]})]}),e.jsx("button",{className:"btn btn-primary",onClick:()=>he(s.route),disabled:u||!m,style:{padding:"0.25rem 0.5rem",fontSize:"0.75rem"},children:"Test"})]})},a))})]}),b==="components"&&e.jsxs("div",{className:"panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsx("h3",{className:"panel-title",children:"Components"}),e.jsx("span",{className:"panel-badge",children:$.length})]}),e.jsx("div",{className:"panel-content",children:$.filter(s=>!l||s.id?.toLowerCase().includes(l.toLowerCase())||s.metadata?.name?.toLowerCase().includes(l.toLowerCase())).map(s=>e.jsxs("div",{className:"plugin-item",children:[e.jsx("div",{className:"plugin-header",children:e.jsx("h4",{className:"plugin-name",children:s.id})}),e.jsxs("div",{className:"plugin-details",children:[s.metadata?.name&&e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Name:"})," ",s.metadata.name]}),s.metadata?.description&&e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Description:"})," ",s.metadata.description]}),s.metadata?.type&&e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Type:"})," ",e.jsx("span",{className:"code",children:s.metadata.type})]})]})]},s.id))})]}),b==="conductor"&&f&&e.jsxs("div",{className:"panel",children:[e.jsx("div",{className:"panel-header",children:e.jsx("h3",{className:"panel-title",children:"Conductor Introspection"})}),e.jsxs("div",{className:"panel-content",children:[(()=>{const s=f.mountedPluginIds.filter(a=>!l||a.toLowerCase().includes(l.toLowerCase()));return e.jsxs("div",{className:"plugin-item",children:[e.jsxs("h4",{className:"plugin-name",children:["Mounted Plugin IDs",l&&` (${s.length}/${f.mountedPluginIds.length})`]}),e.jsx("div",{className:"plugin-details",children:s.length>0?s.map(a=>e.jsx("div",{className:"detail-row",children:e.jsx("span",{className:"code",children:a})},a)):l?e.jsxs("div",{className:"detail-row",style:{color:"var(--text-muted)"},children:['No mounted plugins match "',l,'"']}):e.jsx("div",{className:"detail-row",style:{color:"var(--text-muted)"},children:"No plugins mounted"})})]})})(),(()=>{const s=f.runtimeMountedSeqIds.filter(a=>!l||a.toLowerCase().includes(l.toLowerCase()));return e.jsxs("div",{className:"plugin-item",children:[e.jsxs("h4",{className:"plugin-name",children:["Runtime Mounted Sequence IDs",l&&` (${s.length}/${f.runtimeMountedSeqIds.length})`]}),e.jsx("div",{className:"plugin-details",children:s.length>0?s.map(a=>e.jsx("div",{className:"detail-row",children:e.jsx("span",{className:"code",children:a})},a)):l?e.jsxs("div",{className:"detail-row",style:{color:"var(--text-muted)"},children:['No sequences match "',l,'"']}):e.jsx("div",{className:"detail-row",style:{color:"var(--text-muted)"},children:"No sequences mounted"})})]})})(),(()=>{const s=f.sequenceCatalogDirs.filter(a=>!l||a.toLowerCase().includes(l.toLowerCase()));return e.jsxs("div",{className:"plugin-item",children:[e.jsxs("h4",{className:"plugin-name",children:["Sequence Catalog Directories",l&&` (${s.length}/${f.sequenceCatalogDirs.length})`]}),e.jsx("div",{className:"plugin-details",children:s.length>0?s.map(a=>e.jsx("div",{className:"detail-row",children:e.jsx("span",{className:"code",children:a})},a)):l?e.jsxs("div",{className:"detail-row",style:{color:"var(--text-muted)"},children:['No directories match "',l,'"']}):e.jsx("div",{className:"detail-row",style:{color:"var(--text-muted)"},children:"No catalog directories"})})]})})(),f.discoveredPlugins.length>0&&(()=>{const s=f.discoveredPlugins.filter(a=>l?JSON.stringify(a).toLowerCase().includes(l.toLowerCase()):!0);return e.jsxs("div",{className:"plugin-item",children:[e.jsxs("h4",{className:"plugin-name",children:["Discovered Plugins",l&&` (${s.length}/${f.discoveredPlugins.length})`]}),e.jsx("div",{className:"plugin-details",children:s.length>0?e.jsx("pre",{style:{fontSize:"0.75rem",background:"var(--bg-tertiary)",padding:"0.5rem",borderRadius:"4px",overflow:"auto",maxHeight:"200px"},children:JSON.stringify(s,null,2)}):e.jsxs("div",{className:"detail-row",style:{color:"var(--text-muted)"},children:['No discovered plugins match "',l,'"']})})]})})()]})]}),b==="performance"&&e.jsxs("div",{className:"panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsx("h3",{className:"panel-title",children:"Performance Metrics"}),e.jsx("span",{className:"panel-badge",children:Object.keys(k).length})]}),e.jsxs("div",{className:"panel-content",children:[e.jsxs("div",{className:"plugin-item",children:[e.jsx("h4",{className:"plugin-name",children:"Loading Performance"}),e.jsxs("div",{className:"plugin-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Total Load Time:"})," ",v.loadingTime,"ms"]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Average per Plugin:"})," ",v.loadedPlugins>0?Math.round(v.loadingTime/v.loadedPlugins):0,"ms"]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Success Rate:"})," ",v.totalPlugins>0?Math.round(v.loadedPlugins/v.totalPlugins*100):0,"%"]})]})]}),Object.keys(k).length>0&&e.jsxs("div",{className:"plugin-item",children:[e.jsx("h4",{className:"plugin-name",children:"Test Execution Times"}),e.jsx("div",{className:"plugin-details",children:Object.entries(k).sort(([,s],[,a])=>a-s).map(([s,a])=>e.jsxs("div",{className:"detail-row",children:[e.jsxs("span",{className:"detail-label",children:[s.replace(/_/g," "),":"]}),e.jsxs("span",{className:(a>1e3||a>500,"code"),style:{color:a>1e3?"var(--danger-color)":a>500?"var(--warning-color)":"var(--success-color)"},children:[a,"ms"]})]},s))})]}),e.jsxs("div",{className:"plugin-item",children:[e.jsx("h4",{className:"plugin-name",children:"System Health"}),e.jsxs("div",{className:"plugin-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Conductor Status:"}),e.jsx("span",{className:"code",style:{color:m?"var(--success-color)":"var(--danger-color)"},children:m?"Connected":"Disconnected"})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Manifests Loaded:"}),e.jsxs("span",{className:"code",style:{color:"var(--success-color)"},children:[[j?.loaded,T?.loaded].filter(Boolean).length,"/2"]})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Active Logs:"}),e.jsx("span",{className:"code",children:p.length})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Error Rate:"}),e.jsxs("span",{className:"code",style:{color:p.filter(s=>s.level==="error").length>0?"var(--danger-color)":"var(--success-color)"},children:[p.length>0?Math.round(p.filter(s=>s.level==="error").length/p.length*100):0,"%"]})]})]})]}),e.jsxs("div",{className:"plugin-item",children:[e.jsx("h4",{className:"plugin-name",children:"Memory & Resources"}),e.jsxs("div",{className:"plugin-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Components in Memory:"}),e.jsx("span",{className:"code",children:$.length})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Expanded UI Items:"}),e.jsx("span",{className:"code",children:R.size})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Search Active:"}),e.jsx("span",{className:"code",style:{color:l?"var(--warning-color)":"var(--text-muted)"},children:l?"Yes":"No"})]})]})]})]})]})]}),e.jsxs("div",{className:"logs-panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsx("h3",{className:"panel-title",children:"System Logs"}),e.jsx("span",{className:"panel-badge",children:p.length})]}),e.jsxs("div",{className:"logs-content",children:[p.map((s,a)=>e.jsxs("div",{className:"log-entry",children:[e.jsxs("span",{className:"log-timestamp",children:["[",s.timestamp,"]"]})," ",e.jsx("span",{className:`log-level-${s.level}`,children:s.level.toUpperCase()})," ",s.message,s.data&&e.jsx("div",{style:{marginLeft:"1rem",color:"#569cd6"},children:typeof s.data=="string"?s.data:JSON.stringify(s.data)})]},a)),p.length===0&&e.jsx("div",{style:{color:"var(--text-muted)"},children:"No logs yet..."})]})]})]})]})},G=document.getElementById("test-root");G?ye.createRoot(G).render(e.jsx($e,{})):console.error("Container element not found");const Q="rx.test",Re="1.0.0";function P(m){return!!m&&m.channel===Q&&typeof m.type=="string"}let K=1;function M(m,d,n){return new Promise((r,c)=>{const g=setTimeout(()=>c(new Error(`Timeout waiting for ${n} after ${d}ms`)),d);m.then(u=>{clearTimeout(g),r(u)},u=>{clearTimeout(g),c(u)})})}class ke{constructor(){this.iframe=null,this.targetOrigin="*",this.logs=[],this.readyPhases=new Set,this.driverVersion=null,this.capabilities=[],window.addEventListener("message",d=>{const n=d.data;if(P(n)&&!(this.iframe&&d.source!==this.iframe.contentWindow)&&(this.log("driver",n.type,n.payload),n.type==="driver:readyPhase")){const r=(n.payload&&n.payload.phase)??null;typeof r=="number"&&this.readyPhases.add(r)}})}post(d,n){const r={channel:Q,version:Re,type:d,payload:n};this.log("host",d,n),this.iframe?.contentWindow?.postMessage(r,this.targetOrigin)}log(d,n,r){this.logs.push({t:Date.now(),dir:d,type:n,payload:r}),this.logs.length>1e3&&this.logs.splice(0,this.logs.length-1e3)}async load(d,n){this.iframe&&await this.teardown(),this.readyPhases.clear();const r=document.createElement("iframe");r.src=d,r.style.width="100%",r.style.height="800px",r.style.border="1px solid var(--border-color, #ccc)",document.body.appendChild(r),this.iframe=r,this.targetOrigin="*",await new Promise(c=>{if(r.contentWindow)return c();r.addEventListener("load",()=>c())}),this.post("host:init",{scenarioId:n.id,env:n.env??{},flags:n.flags??{}}),await M(new Promise(c=>{const g=u=>{const x=u.data;P(x)&&x.type==="driver:ack"&&(this.driverVersion=x.payload?.driverVersion??null,this.capabilities=Array.isArray(x.payload?.capabilities)?x.payload.capabilities:[],window.removeEventListener("message",g),c())};window.addEventListener("message",g)}),5e3,"driver ack")}async waitForReadyPhases(d,n=1e4){const r=Date.now();for(const c of d){const g=Math.max(1,n-(Date.now()-r));await M(new Promise(u=>{if(this.readyPhases.has(c))return u();const x=p=>{const w=p.data;P(w)&&w.type==="driver:readyPhase"&&w.payload?.phase===c&&(window.removeEventListener("message",x),u())};window.addEventListener("message",x)}),g,`ready phase ${c}`)}}async runSteps(d,n=8e3){const r=[];for(const c of d||[]){const g=K++,u=await M(new Promise(x=>{const p=w=>{const j=w.data;P(j)&&j.type==="driver:stepResult"&&j.payload?.id===g&&(window.removeEventListener("message",p),x(j.payload))};window.addEventListener("message",p),this.post("host:step",{id:g,type:c.type,payload:c.payload})}),n,`step ${c.type}`);r.push(u)}return r}async runAsserts(d,n=8e3){const r=[];for(const c of d||[]){const g=K++,u=await M(new Promise(x=>{const p=w=>{const j=w.data;P(j)&&j.type==="driver:assertResult"&&j.payload?.id===g&&(window.removeEventListener("message",p),x(j.payload))};window.addEventListener("message",p),this.post("host:assert",{id:g,type:c.type,payload:c})}),n,`assert ${c.type}`);r.push(u)}return r}async getSnapshot(){return await M(new Promise(d=>{const n=r=>{const c=r.data;P(c)&&c.type==="driver:snapshot"&&(window.removeEventListener("message",n),d(c.payload?.state??null))};window.addEventListener("message",n),this.post("host:snapshot")}),4e3,"snapshot")}getLogs(){return[...this.logs]}getCapabilities(){return[...this.capabilities]}getDriverInfo(){return{driverVersion:this.driverVersion,capabilities:[...this.capabilities]}}async teardown(){if(this.iframe){try{await M(new Promise(d=>{const n=r=>{const c=r.data;P(c)&&c.type==="driver:teardownResult"&&(window.removeEventListener("message",n),d())};window.addEventListener("message",n),this.post("host:teardown")}),3e3,"teardown")}catch{}this.iframe.remove(),this.iframe=null,this.readyPhases.clear()}}}(function(){const d=new ke;globalThis.TestHarness=d;try{const n=new URLSearchParams(globalThis.location.search),r=n.get("driver"),c=n.get("scenario"),g=n.get("phases"),u=parseInt(n.get("timeout")||"8000",10);r&&c&&d.load(r,{id:c}).then(async()=>{const x=g?g.split(",").map(p=>parseInt(p,10)).filter(p=>!isNaN(p)):[0,1,2];await d.waitForReadyPhases(x,u)})}catch{}})();
