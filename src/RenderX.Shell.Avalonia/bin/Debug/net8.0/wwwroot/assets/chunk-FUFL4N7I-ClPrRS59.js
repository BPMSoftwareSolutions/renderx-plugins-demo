var g=class l{static schemaCache=new Map;static inflight=new Map;config;componentSchemas=new Map;constructor(t){this.config=t}registerComponentSchema(t,e){this.componentSchemas.set(t,e)}async loadComponentSchemas(t){const e=t.map(async i=>{try{const r=l.schemaCache.get(i);if(r){this.registerComponentSchema(i,r);return}const n=l.inflight.get(i);if(n){const a=await n;a&&(l.schemaCache.set(i,a),this.registerComponentSchema(i,a));return}const o=(async()=>{try{const a=await fetch(`/json-components/${i}.json`);if(a.ok){const s=await a.json();return l.schemaCache.set(i,s),s}return}catch{return}})();l.inflight.set(i,o);const h=await o;l.inflight.delete(i),h&&this.registerComponentSchema(i,h)}catch{}});await Promise.all(e)}generatePropertyFields(t){const e=t.header.type,i=this.componentSchemas.get(e),r=[];if(i?.integration?.properties?.schema){const a=i.integration.properties.schema;Object.entries(a).forEach(([s,c])=>{const p=c.ui||{},f=this.mapSchemaTypeToFieldType(c.type,c.enum,s),u={key:s,label:this.formatLabel(s),type:p.control==="code"?"code":f,path:this.inferPropertyPath(s,t),section:this.inferSection(s),required:c.required||!1,description:c.description,defaultValue:c.default,placeholder:this.generatePlaceholder(s,c.type),options:c.enum?c.enum.map(d=>({value:d,label:this.formatLabel(d.toString())})):void 0,rendererProps:p&&Object.keys(p).length?{...p}:void 0};c.validation&&(u.validation=c.validation),e==="html"&&s==="markup"&&(u.type="code",u.rendererProps={rows:8,...u.rendererProps||{}}),r.push(u)})}e==="svg"&&(r.push({key:"structure",label:"Structure",type:"svgTree",path:"content.svgMarkup",section:"content",description:"Explore children and click to highlight on canvas"}),r.push({key:"nodeInspector",label:"SVG Node Inspector",type:"svgNodeInspector",path:"content.svgMarkup",section:"content",description:"Edit attributes (fill, stroke, size, position) of the selected SVG sub-node"}));const n=this.generateUniversalLayoutFields(t);r.push(...n);const o=this.generateUniversalStylingFields(t);r.push(...o);const h=this.generateAdditionalFields(t,r);if(r.push(...h),e==="html"){const a=r.find(s=>s.key==="markup"&&typeof s.path=="string"&&s.path.startsWith("content."));a&&(a.type="code",a.rendererProps={...a.rendererProps,rows:8})}return this.sortFieldsBySection(r)}generateSections(t){const e=this.config.componentTypeOverrides[t],i=[...this.config.defaultSections];if(!e)return i;const r=i.map(n=>{const o=e.sections[n.id];return o?{...n,title:o.title||n.title,order:o.order||n.order}:n});return Object.entries(e.sections).forEach(([n,o])=>{r.find(h=>h.id===n)||r.push({id:n,title:o.title||this.formatLabel(n),icon:"ðŸ“‹",order:o.order||999,collapsible:!0,defaultExpanded:!1})}),r.sort((n,o)=>n.order-o.order)}validateField(t,e){const i=[];if(t.required&&(e==null||e==="")&&i.push(`${t.label} is required`),e!=null&&e!=="")switch(t.type){case"number":isNaN(Number(e))&&i.push(`${t.label} must be a number`);break;case"color":/^#[0-9A-F]{6}$/i.test(e)||i.push(`${t.label} must be a valid hex color`);break}return t.validation&&t.validation.forEach(r=>{const n=this.applyValidationRule(r,e,t.label);n.isValid||i.push(...n.errors)}),{isValid:i.length===0,errors:i}}generateUniversalLayoutFields(t){return[{key:"x",label:"X Position",type:"number",path:"layout.x",section:"layout",description:"Horizontal position in pixels"},{key:"y",label:"Y Position",type:"number",path:"layout.y",section:"layout",description:"Vertical position in pixels"},{key:"width",label:"Width",type:"number",path:"layout.width",section:"layout",description:"Width in pixels"},{key:"height",label:"Height",type:"number",path:"layout.height",section:"layout",description:"Height in pixels"}]}generateUniversalStylingFields(t){return[{key:"bg-color",label:"Background Color",type:"color",path:"styling.bg-color",section:"styling",placeholder:"#007acc",description:"Background color in hex format"},{key:"text-color",label:"Text Color",type:"color",path:"styling.text-color",section:"styling",placeholder:"#ffffff",description:"Text color in hex format"},{key:"border-radius",label:"Border Radius",type:"text",path:"styling.border-radius",section:"styling",placeholder:"4px",description:"Border radius (e.g., 4px, 50%)"},{key:"font-size",label:"Font Size",type:"text",path:"styling.font-size",section:"styling",placeholder:"14px",description:"Font size (e.g., 14px, 1.2em)"}]}generateAdditionalFields(t,e){const i=[],r=new Set(e.map(n=>n.key));return t.content&&Object.keys(t.content).forEach(n=>{r.has(n)||i.push({key:n,label:this.formatLabel(n),type:this.inferFieldType(t.content[n]),path:`content.${n}`,section:"content"})}),t.styling&&Object.keys(t.styling).forEach(n=>{r.has(n)||i.push({key:n,label:this.formatLabel(n),type:n.includes("color")?"color":"text",path:`styling.${n}`,section:"styling"})}),i}generateFallbackFields(t){const e=[];return t.content&&Object.keys(t.content).forEach(i=>{e.push({key:i,label:this.formatLabel(i),type:this.inferFieldType(t.content[i]),path:`content.${i}`,section:"content"})}),e.push(...this.generateUniversalLayoutFields(t)),e.push(...this.generateUniversalStylingFields(t)),e}mapSchemaTypeToFieldType(t,e,i){if(e)return"select";if(i&&i.includes("color"))return"color";switch(t){case"string":return"text";case"number":return"number";case"boolean":return"checkbox";default:return"text"}}inferPropertyPath(t,e){return e.content&&t in e.content?`content.${t}`:e.layout&&t in e.layout?`layout.${t}`:e.styling&&t in e.styling?`styling.${t}`:["x","y","width","height"].includes(t)?`layout.${t}`:t.includes("color")||t.includes("font")||t.includes("border")?`styling.${t}`:`content.${t}`}inferSection(t){return["x","y","width","height","position"].includes(t)?"layout":t.includes("color")||t.includes("font")||t.includes("border")||t.includes("shadow")?"styling":t.includes("click")||t.includes("hover")||t.includes("event")?"behavior":"content"}inferFieldType(t){return typeof t=="boolean"?"checkbox":typeof t=="number"?"number":"text"}formatLabel(t){return t.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase()).replace(/-/g," ").replace(/_/g," ")}generatePlaceholder(t,e){return e==="number"?"0":t.includes("color")?"#007acc":t.includes("size")||t.includes("radius")?"4px":`Enter ${t}...`}sortFieldsBySection(t){const e=this.config.defaultSections.reduce((i,r,n)=>(i[r.id]=n,i),{});return t.sort((i,r)=>{const n=e[i.section]??999,o=e[r.section]??999;return n-o})}applyValidationRule(t,e,i){const r=[];switch(t.type){case"min":typeof e=="number"&&e<t.value&&r.push(`${i} must be at least ${t.value}`);break;case"max":typeof e=="number"&&e>t.value&&r.push(`${i} must be at most ${t.value}`);break;case"pattern":typeof e=="string"&&!new RegExp(t.value).test(e)&&r.push(t.message||`${i} format is invalid`);break}return{isValid:r.length===0,errors:r}}};export{g as S};
