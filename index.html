<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RenderX Plugins Demo</title>
    <script>
      (function () {
        try {
          var d = document.documentElement;
          var stored = null;
          try {
            stored = localStorage.getItem("theme");
          } catch (e) {}
          var t = stored === "dark" || stored === "light" ? stored : "dark";
          d.setAttribute("data-theme", t);
        } catch (e) {}
      })();
    </script>
    <script type="importmap">
      {
        "imports": {
          "@renderx-plugins/control-panel": "/assets/vendor-control-panel.js"
        }
      }
    </script>

    <!-- Vite dev client and React Refresh preamble (explicit, guarded, synchronous via TLA) -->
    <script type="module">
      try {
        if (import.meta.env && import.meta.env.DEV) {
          // Ensure Vite client is loaded (HMR, env, etc.) before app modules execute
          await import('/@vite/client');
          // Install React Refresh preamble exactly once BEFORE React modules run
          if (!window.__vite_plugin_react_preamble_installed__) {
            const { default: RefreshRuntime } = await import('/@react-refresh');
            RefreshRuntime.injectIntoGlobalHook(window);
            window.$RefreshReg$ = () => {};
            window.$RefreshSig$ = () => (type) => type;
            window.__vite_plugin_react_preamble_installed__ = true;
          }
        }
      } catch {}
    </script>


    <!-- In Vite dev, ensure Control Panel CSS is injected even when using the vendor mapping -->
    <script type="module">
      // Vite replaces import.meta.env in dev
      try {
        if (import.meta.env && import.meta.env.DEV) {
          // Load the package stylesheet so Vite injects it as <style> at runtime.
          await import('@renderx-plugins/control-panel/index.css');
        }
      } catch {}
    </script>

  </head>
  <body>
    <div id="root"></div>
    <script type="module">
      // Ensure React Refresh preamble is installed BEFORE loading the app entry
      if (import.meta.env && import.meta.env.DEV) {
        await import('/@vite/client');
        if (!window.__vite_plugin_react_preamble_installed__) {
          const { default: RefreshRuntime } = await import('/@react-refresh');
          RefreshRuntime.injectIntoGlobalHook(window);
          window.$RefreshReg$ = () => {};
          window.$RefreshSig$ = () => (type) => type;
          window.__vite_plugin_react_preamble_installed__ = true;
        }
      }
      // Now load the app entry after preamble is present
      await import('/src/index.tsx');
    </script>
  </body>
</html>
