{
  "version": "1.0.0",
  "generatedAt": "2025-11-24T22:00:00Z",
  "documentType": "Governance Framework Reference",
  "scope": "REPOSITORY-WIDE ENFORCEMENT RULES AND MECHANISMS",

  "framework_overview": {
    "principle": "JSON-driven automation across entire renderx-plugins-demo monorepo",
    "mechanism": "JSON authorities define what should be, generators create what is, verification ensures consistency",
    "layers": 5,
    "cascade_model": "Repository policy → Package policy → Directory policy"
  },

  "enforcement_layers": [
    {
      "layer": 1,
      "name": "Filename Convention Enforcement",
      "trigger": "File creation",
      "when": "Developer creates or modifies file",
      "rule": "Files with .generated* or .generated/* patterns MUST have generator metadata",
      "check": "Filename matches auto-generation pattern → must have generator header",
      "action_pass": "Allow file creation",
      "action_fail": "BLOCK with message: 'Files matching .generated* patterns must be auto-generated. Use generator scripts.'",
      "enforcement_point": "IDE plugin / pre-commit hook",
      "bypass": "NONE"
    },
    {
      "layer": 2,
      "name": "Pre-Commit Hook Governance",
      "trigger": "Before git commit",
      "when": "Developer runs 'git commit'",
      "rule": "No manual .generated files in staged changes",
      "checks": [
        "Scan staged files for .generated* patterns",
        "Verify each has generator header with valid checksum",
        "Check checksums are current (not stale)"
      ],
      "action_pass": "Allow commit to proceed",
      "action_fail": "BLOCK commit with violations report. Run: npm run verify:markdown-governance:fix",
      "enforcement_point": ".git/hooks/pre-commit",
      "bypass": "DANGEROUS - Requires force flag (not recommended)"
    },
    {
      "layer": 3,
      "name": "Build-Time Validation",
      "trigger": "npm run build",
      "when": "Developer builds package or repository",
      "rule": "All .generated files must match freshly generated versions",
      "process": [
        "1. Regenerate all .generated files from JSON sources",
        "2. Compare checksums with current files",
        "3. If any mismatch → file is stale or manual",
        "4. Fail build if violations found"
      ],
      "action_pass": "Build succeeds, all .generated files current",
      "action_fail": "BUILD FAILS with violation details. Must fix before proceeding.",
      "enforcement_point": "package.json scripts: build task calls verify:governance before compilation",
      "bypass": "NONE - build cannot succeed without compliance"
    },
    {
      "layer": 4,
      "name": "CI/CD Pipeline Enforcement",
      "trigger": "Before PR merge",
      "when": "Pull request submitted for merge",
      "rule": "Repository-wide governance audit must pass",
      "process": [
        "1. Checkout PR branch",
        "2. Run full governance audit (npm run audit:governance)",
        "3. Generate compliance report",
        "4. Verify 100% compliance or BLOCK"
      ],
      "action_pass": "PR can be merged",
      "action_fail": "MERGE BLOCKED until violations fixed. PR status shows 'governance' check failed.",
      "enforcement_point": "GitHub Actions / CI pipeline (ci/verify-governance.yml)",
      "bypass": "NONE - merge cannot proceed without governance approval"
    },
    {
      "layer": 5,
      "name": "Continuous Audit and Reporting",
      "trigger": "Scheduled (daily) or on-demand",
      "when": "Daily audit job runs OR developer runs audit command",
      "rule": "Repository-wide governance compliance must be tracked and reported",
      "process": [
        "1. Scan entire repository for .generated files",
        "2. Verify each has valid generator header",
        "3. Check all checksums are current",
        "4. Generate compliance dashboard",
        "5. Report to governance dashboard"
      ],
      "action_pass": "Compliance report shows 100%, no violations",
      "action_fail": "Compliance report shows violations. Team notified. Future builds blocked if not fixed.",
      "enforcement_point": "GitHub Actions (scheduled) or npm run audit:governance",
      "command": "npm run audit:governance (repository root)",
      "bypass": "NONE - violations must be resolved"
    }
  ],

  "file_governance_matrix": {
    "description": "Which files auto-generated, which manual, enforcement level",
    "matrix": [
      {
        "pattern": ".generated/*.md",
        "type": "Markdown Documentation",
        "auto_generated": true,
        "source_json": "*-project-plan.json",
        "generator": "generate-context-tree.js, generate-summary.js",
        "enforcement": "5 LAYERS - CRITICAL",
        "manual_allowed": false,
        "exceptions": "NONE"
      },
      {
        "pattern": ".generated/*.json",
        "type": "Generated Configuration",
        "auto_generated": true,
        "source_json": "*-governance.json, *-project-plan.json",
        "generator": "generate-configs.js",
        "enforcement": "5 LAYERS - CRITICAL",
        "manual_allowed": false,
        "exceptions": "NONE"
      },
      {
        "pattern": "__tests__/**/*.generated.spec.ts",
        "type": "Generated Test Files",
        "auto_generated": true,
        "source_json": "*-specifications.json",
        "generator": "generate-bdd-tests.js",
        "enforcement": "5 LAYERS - CRITICAL",
        "manual_allowed": false,
        "exceptions": "NONE"
      },
      {
        "pattern": "src/**/*.stub.ts",
        "type": "Implementation Stubs",
        "auto_generated": true,
        "source_json": "*-specifications.json",
        "generator": "generate-implementation-stubs.js",
        "enforcement": "5 LAYERS - CRITICAL",
        "manual_allowed": false,
        "exceptions": "NONE"
      },
      {
        "pattern": "README.md",
        "type": "Project README (Entry Point)",
        "auto_generated": false,
        "source_json": "N/A",
        "generator": "N/A",
        "enforcement": "NONE - Manual allowed",
        "manual_allowed": true,
        "exceptions": "Explicitly authorized manual file"
      },
      {
        "pattern": "*-project-plan.json",
        "type": "Project Authority",
        "auto_generated": false,
        "source_json": "AUTHORITY - Not generated",
        "generator": "N/A",
        "enforcement": "LOCKED - Pre-commit prevents modification",
        "manual_allowed": false,
        "exceptions": "Update via formal governance process"
      },
      {
        "pattern": "*-specifications.json",
        "type": "Specification Authority",
        "auto_generated": false,
        "source_json": "AUTHORITY - Not generated",
        "generator": "N/A",
        "enforcement": "LOCKED - Pre-commit prevents modification",
        "manual_allowed": false,
        "exceptions": "Update via formal governance process"
      },
      {
        "pattern": "*-governance.json",
        "type": "Governance Authority",
        "auto_generated": false,
        "source_json": "AUTHORITY - Not generated",
        "generator": "N/A",
        "enforcement": "LOCKED - Pre-commit prevents modification",
        "manual_allowed": false,
        "exceptions": "Update via formal governance process"
      }
    ]
  },

  "generator_specifications": {
    "all_generators_must_implement": {
      "interface": {
        "function_signature": "generateX(sourceJson, options) → { content, metadata }",
        "required_metadata": {
          "generatedAt": "ISO timestamp",
          "generatedFrom": "Source JSON file path",
          "checksum": "SHA256 hash of content",
          "generator": "Generator function name",
          "version": "Generator version"
        },
        "required_header": "All generated files must include generator metadata as comment at top"
      }
    },
    "generator_1_context_tree": {
      "name": "generate-context-tree.js",
      "inputs": ["*-project-plan.json", "*-specifications.json"],
      "outputs": ["CONTEXT_TREE_AUDIT_SESSION.md"],
      "function": "generateContextTreeAudit(projectPlan, specifications)",
      "transforms": "Project structure → Hierarchical audit markdown"
    },
    "generator_2_summary": {
      "name": "generate-summary.js",
      "inputs": ["*-project-plan.json"],
      "outputs": ["SESSION_SUMMARY.md"],
      "function": "generateSessionSummary(projectPlan)",
      "transforms": "Project state → Executive summary"
    },
    "generator_3_handoff": {
      "name": "generate-handoff.js",
      "inputs": ["*-project-plan.json", "*-governance.json"],
      "outputs": ["NEXT_SESSION_HANDOFF.md"],
      "function": "generateNextSessionHandoff(projectPlan, governance)",
      "transforms": "Current state → Continuation guide"
    },
    "generator_4_tests": {
      "name": "generate-bdd-tests.js",
      "inputs": ["*-specifications.json"],
      "outputs": ["__tests__/**/*.generated.spec.ts"],
      "function": "generateBDDTests(specifications)",
      "transforms": "BDD specs → Executable test code"
    },
    "generator_5_stubs": {
      "name": "generate-implementation-stubs.js",
      "inputs": ["*-specifications.json"],
      "outputs": ["src/**/*.stub.ts"],
      "function": "generateImplementationStubs(specifications)",
      "transforms": "Specifications → Implementation structure"
    }
  },

  "cascade_inheritance_model": {
    "level_1_repository": {
      "authority": "MASTER_GOVERNANCE_AUTHORITY.json (renderx-plugins-demo/)",
      "scope": "Entire repository",
      "defines": [
        "Core policy (JSON-driven automation)",
        "Repository-wide rules",
        "Default enforcement layers"
      ],
      "can_be_overridden": false,
      "by_whom": "Repository governance board only"
    },
    "level_2_package": {
      "authority": "PACKAGE_GOVERNANCE_AUTHORITY.json (packages/*/)",
      "scope": "Individual package",
      "inherits_from": "MASTER_GOVERNANCE_AUTHORITY.json",
      "defines": [
        "Package-specific rules",
        "Package-specific generators",
        "Package-specific exceptions (if allowed)"
      ],
      "can_override": [
        "file_placement_rules (e.g., .generated/ vs .generated_files/)",
        "generation_frequency (e.g., on-build vs on-demand)",
        "allowed_manual_files (e.g., docs/README.md)"
      ],
      "cannot_override": [
        "core_policy (JSON authority principle)",
        "enforcement_layers (all 5 must be active)"
      ]
    },
    "level_3_directory": {
      "authority": "GOVERNANCE.json (docs/, src/, etc.)",
      "scope": "Individual directory",
      "inherits_from": "PACKAGE_GOVERNANCE_AUTHORITY.json",
      "defines": [
        "Directory-specific rules",
        "Directory-specific generators"
      ],
      "override_rules": "Same as package level"
    },
    "conflict_resolution": {
      "rule": "Most specific authority wins",
      "example": "If repository says 'ALL .generated files forbidden' but package says 'allowed', package rule is ignored (cannot override core policy)"
    }
  },

  "verification_checklist": {
    "repository_audit": [
      {
        "check": "All packages discovered",
        "validation": "knowledge-index.json lists all packages",
        "pass": "Repository scan found all packages"
      },
      {
        "check": "All packages have governance",
        "validation": "Each package has PACKAGE_GOVERNANCE_AUTHORITY.json",
        "pass": "No packages missing governance file"
      },
      {
        "check": "All .generated files have headers",
        "validation": "Scan finds no headerless .generated files",
        "pass": "All auto-generated files properly marked"
      },
      {
        "check": "All checksums valid",
        "validation": "Regenerate all files and compare checksums",
        "pass": "All checksums match, no stale files"
      },
      {
        "check": "No manual violations",
        "validation": "Scan for .generated files without generator header",
        "pass": "Zero manual files in auto-generation patterns"
      },
      {
        "check": "All generators functioning",
        "validation": "Run all generators and verify output",
        "pass": "All generators produce expected output"
      },
      {
        "check": "All enforcement layers active",
        "validation": "Verify pre-commit, build, CI/CD, audit all working",
        "pass": "All 5 enforcement layers operational"
      }
    ]
  },

  "compliance_metrics": {
    "current_state": {
      "repository_compliance": "INCOMPLETE - Audit in progress",
      "packages_audited": 1,
      "packages_compliant": 0,
      "packages_with_violations": 1,
      "total_violations": 5,
      "generators_implemented": 5,
      "enforcement_layers_active": 1
    },
    "target_state": {
      "repository_compliance": "100%",
      "packages_audited": "ALL",
      "packages_compliant": "ALL",
      "packages_with_violations": 0,
      "total_violations": 0,
      "generators_implemented": "ALL NEEDED",
      "enforcement_layers_active": 5
    }
  },

  "governance_tooling": {
    "repository_level_tools": {
      "generate_all_documentation_js": {
        "location": "scripts/generate-all-documentation.js",
        "purpose": "Master orchestrator for repository-wide generation",
        "usage": "npm run generate:all (from repo root)",
        "features": [
          "Auto-discovers all packages",
          "Orchestrates all generators",
          "Creates repository-wide index",
          "Reports generation status"
        ],
        "todo": "TO BE CREATED"
      },
      "verify_governance_js": {
        "location": "scripts/verify-governance.js",
        "purpose": "Repository-wide verification and enforcement",
        "usage": "npm run verify:governance (from repo root)",
        "features": [
          "Audits entire repository",
          "Reports violations by package",
          "Generates compliance dashboard",
          "Can auto-fix with --fix flag"
        ],
        "todo": "TO BE CREATED"
      },
      "audit_governance_js": {
        "location": "scripts/audit-governance.js",
        "purpose": "Continuous monitoring and reporting",
        "usage": "npm run audit:governance (from repo root) or scheduled job",
        "features": [
          "Detailed compliance report",
          "Historical tracking",
          "Trend analysis"
        ],
        "todo": "TO BE CREATED"
      }
    },
    "pre_commit_hook": {
      "location": ".git/hooks/pre-commit",
      "purpose": "Prevent commits with governance violations",
      "features": [
        "Scans staged files",
        "Checks for manual .generated files",
        "Reports violations",
        "Blocks commit if needed"
      ],
      "todo": "TO BE CREATED"
    },
    "ci_cd_workflow": {
      "location": ".github/workflows/verify-governance.yml",
      "purpose": "CI/CD enforcement before merge",
      "features": [
        "Runs full repository audit",
        "Blocks PR merge on violations",
        "Reports to PR status",
        "Tracks compliance over time"
      ],
      "todo": "TO BE CREATED"
    }
  },

  "next_steps": {
    "immediate": [
      "✅ CREATED: MASTER_GOVERNANCE_AUTHORITY.json",
      "✅ CREATED: GOVERNANCE_FRAMEWORK.json (this file)",
      "⏳ TODO: Create repository-level generators and verification scripts",
      "⏳ TODO: Create pre-commit hooks",
      "⏳ TODO: Create CI/CD workflow"
    ],
    "per_package": [
      "⏳ TODO: Audit each package for auto-generated files",
      "⏳ TODO: Create PACKAGE_GOVERNANCE_AUTHORITY.json for each",
      "⏳ TODO: Create package-level generators (if needed)",
      "⏳ TODO: Fix violations in each package"
    ],
    "repository_wide": [
      "⏳ TODO: Create knowledge-index.json catalog",
      "⏳ TODO: Activate all 5 enforcement layers",
      "⏳ TODO: Achieve 100% compliance",
      "⏳ TODO: Document for all agents"
    ]
  },

  "policy_final_statement": "This governance framework establishes JSON-driven automation as the authoritative mechanism for managing documentation and generated artifacts across the renderx-plugins-demo repository. All files matching auto-generation patterns MUST be generated from JSON authorities using specified generators. Manual creation of such files is PROHIBITED and will be detected and blocked by multi-layer enforcement. This framework applies repository-wide with cascade inheritance from repository → package → directory levels."
}
