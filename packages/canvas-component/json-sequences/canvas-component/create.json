{
  "pluginId": "CanvasComponentPlugin",
  "id": "canvas-component-create-symphony",
  "name": "Canvas Component Create",
  "movements": [
    {
      "id": "create",
      "name": "Create",
      "beats": [
        {
          "beat": 1,
          "event": "canvas:component:resolve-template",
          "title": "Resolve Template",
          "dynamics": "mf",
          "handler": "resolveTemplate",
          "timing": "immediate",
          "kind": "pure",
          "scenario": "resolve Template",
          "userStory": "As a platform reliability engineer, I need `resolveTemplate` to deterministically resolve component schemas and bindings within 1s P95 (99.9% success), deduping remote fetches and emitting telemetry so downstream renderers can build pages without retries.",
          "testCase": "dedupes schema fetches across multiple calls and instances",
          "testFile": "node_modules\\@renderx-plugins\\control-panel\\__tests__\\schema-resolver.memo.spec.ts",
          "acceptanceCriteriaStructured": [
            {
              "given": [
                "valid component data with template is provided"
              ],
              "when": [
                "resolveTemplate processes the input"
              ],
              "then": [
                "template is extracted and stored in context.payload.template",
                "a unique node ID is generated or override ID is used",
                "React rendering strategy is detected when render.strategy === 'react'"
              ],
              "and": [
                "operation completes within 1s P95",
                "schema fetches are deduped across calls and instances",
                "telemetry includes latency metrics"
              ]
            },
            {
              "given": [
                "component data is missing template"
              ],
              "when": [
                "resolveTemplate processes invalid input"
              ],
              "then": [
                "error is thrown with message 'Missing component template.'"
              ],
              "and": [
                "error context is logged",
                "system remains stable"
              ]
            },
            {
              "given": [
                "import scenario with _overrideNodeId provided"
              ],
              "when": [
                "resolveTemplate processes import data"
              ],
              "then": [
                "override ID is used instead of generating new ID",
                "template resolution proceeds normally"
              ],
              "and": [
                "imported nodes have stable, predictable IDs"
              ]
            }
          ]
        },
        {
          "beat": 2,
          "event": "canvas:component:register-instance",
          "title": "Register Instance",
          "dynamics": "mf",
          "handler": "registerInstance",
          "timing": "immediate",
          "kind": "io",
          "scenario": "register Instance",
          "userStory": "As a frontend platform integrator, I need `registerInstance` to assign stable IDs and semantic classes to imported components within 1s P95 and persist registration events so style hooks and analytics can target instances consistently across sessions.",
          "testCase": "adds rx-comp-<tag>-<id> class for imported components",
          "testFile": "node_modules\\@renderx-plugins\\canvas-component\\__tests__\\import.instance-class.spec.ts",
          "acceptanceCriteriaStructured": [
            {
              "given": [
                "valid nodeId and template exist in context.payload"
              ],
              "when": [
                "registerInstance executes"
              ],
              "then": [
                "instance metadata is persisted to KV store with stable ID",
                "semantic class rx-comp-<tag>-<id> is assigned for imported components",
                "registration includes type, classes, style, content, and createdAt timestamp"
              ],
              "and": [
                "operation completes within 1s P95",
                "registration event is emitted for analytics",
                "style hooks and analytics can target instance consistently"
              ]
            },
            {
              "given": [
                "nodeId or template is missing from payload"
              ],
              "when": [
                "registerInstance executes with invalid state"
              ],
              "then": [
                "error is thrown with message 'Missing nodeId/template in payload for IO registration'"
              ],
              "and": [
                "error is logged with context",
                "system remains stable"
              ]
            },
            {
              "given": [
                "template includes content properties"
              ],
              "when": [
                "registerInstance persists metadata"
              ],
              "then": [
                "content properties are included in KV data"
              ],
              "and": [
                "instance can be rehydrated with full state"
              ]
            }
          ]
        },
        {
          "beat": 3,
          "event": "canvas:component:create",
          "title": "Create Node",
          "dynamics": "mf",
          "handler": "createNode",
          "timing": "immediate",
          "kind": "stage-crew",
          "scenario": "Generate or Create create Node",
          "userStory": "As a page composition service, I need `createNode` to assemble a canvas node from resolved templates within 2s P95 without directly rendering React, forwarding to the drop symphony and validating schema to keep the composition pipeline decoupled and safe.",
          "testCase": "forwards to drop symphony and does not render React nodes directly",
          "testFile": "node_modules\\@renderx-plugins\\canvas\\__tests__\\create-page.dom.spec.ts",
          "acceptanceCriteriaStructured": [
            {
              "given": [
                "valid template and nodeId exist in context.payload"
              ],
              "when": [
                "createNode executes"
              ],
              "then": [
                "DOM element is created with specified tag and ID",
                "CSS styles and variables are injected and applied",
                "element is appended to canvas or target container",
                "interactions (selection, drag) are attached",
                "created node metadata is stored in context.payload.createdNode"
              ],
              "and": [
                "operation completes within 2s P95",
                "React rendering is NOT performed directly (deferred to renderReact beat)",
                "schema is validated before applying"
              ]
            },
            {
              "given": [
                "template specifies SVG with rx-line class"
              ],
              "when": [
                "createNode processes SVG line component"
              ],
              "then": [
                "SVG element is created with viewBox and preserveAspectRatio",
                "child <line> element with segment class is appended",
                "line attributes (x1, y1, x2, y2) are set"
              ],
              "and": [
                "vector-effect='non-scaling-stroke' is applied"
              ]
            },
            {
              "given": [
                "template includes data-role='container'"
              ],
              "when": [
                "createNode processes container element"
              ],
              "then": [
                "data-role attribute is set to 'container'",
                "position: relative is applied"
              ],
              "and": [
                "element can host child components"
              ]
            },
            {
              "given": [
                "import scenario with containerId specified"
              ],
              "when": [
                "createNode appends element"
              ],
              "then": [
                "element is appended to specified container instead of canvas"
              ],
              "and": [
                "nested component structure is preserved"
              ]
            }
          ]
        },
        {
          "beat": 4,
          "event": "canvas:component:render-react",
          "title": "Render React Component",
          "dynamics": "mf",
          "handler": "renderReact",
          "timing": "immediate",
          "kind": "stage-crew",
          "scenario": "Render or Display render React",
          "userStory": "As a UI runtime engineer, I need `renderReact` to instantiate React components from composed nodes in <200ms P95, with memoized props and keyed lists, emitting perf telemetry so UI remains responsive on median devices.",
          "testCase": "creates a React component through the complete create sequence",
          "testFile": "node_modules\\@renderx-plugins\\canvas-component\\__tests__\\create.react.integration.spec.ts",
          "acceptanceCriteriaStructured": [
            {
              "given": [
                "context.payload.kind is 'react' with valid reactCode"
              ],
              "when": [
                "renderReact executes"
              ],
              "then": [
                "React code is validated before compilation",
                "JSX is transformed to JavaScript using Babel",
                "React component is compiled and mounted using createRoot",
                "rendering uses startTransition for non-blocking UI",
                "react.component.mounted event is published"
              ],
              "and": [
                "operation completes within 200ms P95",
                "validation, compile, and render metrics are emitted",
                "context.payload.reactRendered is set to true"
              ]
            },
            {
              "given": [
                "React code validation fails"
              ],
              "when": [
                "renderReact validates code"
              ],
              "then": [
                "error message lists validation failures",
                "react.component.error event is published",
                "error is displayed in container with user-friendly styling"
              ],
              "and": [
                "context.payload.reactError contains error message",
                "system remains stable"
              ]
            },
            {
              "given": [
                "JSX compilation fails"
              ],
              "when": [
                "Babel transforms code"
              ],
              "then": [
                "compilation error is captured",
                "ErrorComponent is rendered showing error details",
                "react.component.error event is published"
              ],
              "and": [
                "HTML is escaped to prevent XSS",
                "diagnostics emitter records error"
              ]
            },
            {
              "given": [
                "existing React root exists for nodeId"
              ],
              "when": [
                "renderReact is called again"
              ],
              "then": [
                "existing root is unmounted before creating new root"
              ],
              "and": [
                "memory leaks are prevented"
              ]
            },
            {
              "given": [
                "context.payload.kind is not 'react'"
              ],
              "when": [
                "renderReact is invoked"
              ],
              "then": [
                "handler returns early without processing"
              ],
              "and": [
                "non-React components are not affected"
              ]
            }
          ]
        },
        {
          "beat": 5,
          "event": "canvas:component:notify-ui",
          "title": "Notify UI",
          "dynamics": "mf",
          "handler": "notifyUi",
          "timing": "immediate",
          "kind": "pure",
          "scenario": "Publish UI State Change Notifications to Event System",
          "userStory": "As an event-driven UI orchestrator, I need UI class/state changes published with <20ms end-to-end delivery, ordered FIFO with backpressure, so subscribers (controls, analytics, accessibility) react consistently without missed transitions.",
          "testCase": "exports CanvasPage and register()",
          "testFile": "node_modules\\@renderx-plugins\\canvas\\__tests__\\ui.export.spec.ts",
          "acceptanceCriteriaStructured": [
            {
              "given": [
                "component has been created with id and correlationId"
              ],
              "when": [
                "notifyUi executes"
              ],
              "then": [
                "canvas.component.created event is published via EventRouter",
                "event includes id and correlationId",
                "legacy onComponentCreated callback is invoked if provided"
              ],
              "and": [
                "delivery completes within 20ms end-to-end",
                "events are ordered FIFO",
                "subscribers receive notifications consistently"
              ]
            },
            {
              "given": [
                "id or correlationId is missing"
              ],
              "when": [
                "notifyUi executes"
              ],
              "then": [
                "event publication is skipped",
                "callback is still invoked if provided"
              ],
              "and": [
                "system remains stable"
              ]
            },
            {
              "given": [
                "multiple components are created rapidly"
              ],
              "when": [
                "notifyUi handles concurrent notifications"
              ],
              "then": [
                "events are delivered in order without missed transitions"
              ],
              "and": [
                "backpressure mechanisms prevent queue overflow"
              ]
            }
          ]
        },
        {
          "beat": 6,
          "event": "canvas:component:augment:line",
          "title": "Enhance Line (Advanced)",
          "dynamics": "mf",
          "handler": "enhanceLine",
          "timing": "immediate",
          "kind": "stage-crew",
          "scenario": "enhance Line",
          "userStory": "As a design systems engineer, I need `enhanceLine` to apply advanced line augmentation (measurements, anchors, hit areas) within 1s P95, validating geometry and emitting change events so tooling and interactions remain precise.",
          "testCase": "should enhance-line",
          "testFile": "node_modules\\@renderx-plugins\\canvas-component\\__tests__\\advanced-line.augment.spec.ts",
          "acceptanceCriteriaStructured": [
            {
              "given": [
                "lineAdvanced feature flag is enabled and SVG element with rx-line class exists"
              ],
              "when": [
                "enhanceLine executes"
              ],
              "then": [
                "SVG base attributes are set (width, height, viewBox, preserveAspectRatio)",
                "line markers defs are created with rx-arrow-end marker",
                "marker includes arrow path with currentColor fill",
                "augmentation is idempotent (safe to call multiple times)"
              ],
              "and": [
                "operation completes within 1s P95",
                "geometry is validated",
                "markers enable precise line anchors and hit areas"
              ]
            },
            {
              "given": [
                "lineAdvanced feature flag is disabled"
              ],
              "when": [
                "enhanceLine executes"
              ],
              "then": [
                "handler returns early without processing"
              ],
              "and": [
                "feature flag controls advanced line features"
              ]
            },
            {
              "given": [
                "element is not SVG or does not have rx-line class"
              ],
              "when": [
                "enhanceLine validates element"
              ],
              "then": [
                "handler returns early without augmentation"
              ],
              "and": [
                "non-line elements are not affected"
              ]
            },
            {
              "given": [
                "markers already exist in SVG defs"
              ],
              "when": [
                "enhanceLine runs"
              ],
              "then": [
                "existing markers are preserved",
                "no duplicate markers are created"
              ],
              "and": [
                "operation is idempotent"
              ]
            }
          ]
        }
      ],
      "userStory": "As a platform reliability engineer, I need the create symphony to produce a fully composed, registered, and render-ready canvas component sequence with P95 latencies per beat (resolveTemplate ≤1s, registerInstance ≤1s, createNode ≤2s, renderReact ≤200ms, notifyUi ≤20ms, enhanceLine ≤1s) and 99.9% success, so downstream experiences render predictably.",
      "persona": "System Operator",
      "businessValue": "Enables reliable operations with measurable KPIs; ensures consistent service delivery with SLA compliance (target: 99.9%)"
    }
  ],
  "beats": 6,
  "userStory": "As a product owner, I need the canvas component create flow to reliably transform templates into interactive UI with clear telemetry, strict schemas, and beat-specific SLAs (≤1s/≤2s/≤200ms/≤20ms as defined), achieving 99.9% success so we meet customer performance commitments.",
  "persona": "Product Owner",
  "businessValue": "Enables reliable operations with measurable KPIs; ensures consistent service delivery with SLA compliance (target: 99.9%)",
  "domainId": "renderx-web-orchestration"
}
