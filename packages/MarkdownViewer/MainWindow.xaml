<Window x:Class="MarkdownViewer.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
        mc:Ignorable="d"
        Title="Markdown Viewer"
        Height="800"
        Width="1400"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource MaterialDesignPaper}"
        FontFamily="{DynamicResource MaterialDesignFont}">

    <materialDesign:DialogHost Identifier="RootDialog">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Menu Bar -->
            <Menu Grid.Row="0" Background="{DynamicResource MaterialDesignPaper}">
                <MenuItem Header="_File">
                    <MenuItem x:Name="MenuOpenFile"
                            Header="_Open File..."
                            Click="MenuOpenFile_Click">
                        <MenuItem.Icon>
                            <materialDesign:PackIcon Kind="FileDocument"/>
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem x:Name="MenuOpenFolder"
                            Header="Open _Folder..."
                            Click="MenuOpenFolder_Click">
                        <MenuItem.Icon>
                            <materialDesign:PackIcon Kind="FolderOpen"/>
                        </MenuItem.Icon>
                    </MenuItem>
                    <Separator/>
                    <MenuItem x:Name="MenuRecentFiles"
                            Header="Recent _Files">
                        <MenuItem.Icon>
                            <materialDesign:PackIcon Kind="History"/>
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem x:Name="MenuRecentFolders"
                            Header="Recent F_olders">
                        <MenuItem.Icon>
                            <materialDesign:PackIcon Kind="FolderClockOutline"/>
                        </MenuItem.Icon>
                    </MenuItem>
                    <Separator/>
                    <MenuItem x:Name="MenuEditSequence"
                            Header="_Edit Sequence..."
                            Click="MenuEditSequence_Click"
                            ToolTip="Edit a sequence JSON file">
                        <MenuItem.Icon>
                            <materialDesign:PackIcon Kind="FileEditOutline"/>
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem x:Name="MenuConvertSequence"
                            Header="_Convert Sequence..."
                            Click="MenuConvertSequence_Click"
                            ToolTip="Convert a sequence JSON file to markdown documentation">
                        <MenuItem.Icon>
                            <materialDesign:PackIcon Kind="FileSwapOutline"/>
                        </MenuItem.Icon>
                    </MenuItem>
                    <Separator/>
                    <MenuItem x:Name="MenuExit"
                            Header="E_xit"
                            Click="MenuExit_Click">
                        <MenuItem.Icon>
                            <materialDesign:PackIcon Kind="ExitToApp"/>
                        </MenuItem.Icon>
                    </MenuItem>
                </MenuItem>
            </Menu>

            <!-- Top Menu Bar -->
            <materialDesign:ColorZone Grid.Row="1"
                                     Mode="PrimaryMid"
                                     Padding="16"
                                     materialDesign:ElevationAssist.Elevation="Dp4">
                <DockPanel>
                    <StackPanel Orientation="Horizontal" DockPanel.Dock="Left">
                        <materialDesign:PackIcon Kind="FileDocument"
                                               Width="32"
                                               Height="32"
                                               VerticalAlignment="Center"
                                               Margin="0,0,16,0"/>
                        <TextBlock Text="Markdown Viewer"
                                 VerticalAlignment="Center"
                                 FontSize="22"
                                 FontWeight="Medium"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal"
                              DockPanel.Dock="Right"
                              HorizontalAlignment="Right">
                        <Button x:Name="BtnToggleTheme"
                              Style="{StaticResource MaterialDesignRaisedButton}"
                              ToolTip="Toggle Dark/Light Theme"
                              Click="BtnToggleTheme_Click"
                              Margin="8,0"
                              Height="36"
                              Padding="12,8">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="ThemeLightDark"
                                                       Width="20"
                                                       Height="20"
                                                       VerticalAlignment="Center"
                                                       Margin="0,0,8,0"/>
                                <TextBlock x:Name="TxtThemeLabel"
                                         Text="DARK MODE"
                                         VerticalAlignment="Center"
                                         FontWeight="Medium"/>
                            </StackPanel>
                        </Button>

                        <Button x:Name="BtnEditSequence"
                              Style="{StaticResource MaterialDesignRaisedButton}"
                              ToolTip="Edit JSON Sequence"
                              Click="BtnEditSequence_Click"
                              Margin="8,0"
                              Height="36"
                              Padding="12,8">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="FileEditOutline"
                                                       Width="20"
                                                       Height="20"
                                                       VerticalAlignment="Center"
                                                       Margin="0,0,8,0"/>
                                <TextBlock Text="EDIT SEQUENCE"
                                         VerticalAlignment="Center"
                                         FontWeight="Medium"/>
                            </StackPanel>
                        </Button>

                        <Button x:Name="BtnRefresh"
                              Style="{StaticResource MaterialDesignIconButton}"
                              ToolTip="Refresh Current File"
                              Click="BtnRefresh_Click"
                              Margin="8,0">
                            <materialDesign:PackIcon Kind="Refresh" Width="24" Height="24"/>
                        </Button>

                        <Button x:Name="BtnHelp"
                              Style="{StaticResource MaterialDesignIconButton}"
                              ToolTip="Help"
                              Click="BtnHelp_Click"
                              Margin="8,0">
                            <materialDesign:PackIcon Kind="HelpCircle" Width="24" Height="24"/>
                        </Button>
                    </StackPanel>
                </DockPanel>
            </materialDesign:ColorZone>

            <!-- Main Content Area -->
            <Grid Grid.Row="2">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="350" MinWidth="250"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*" MinWidth="400"/>
                </Grid.ColumnDefinitions>

                <!-- Left Panel - File Browser -->
                <materialDesign:Card Grid.Column="0"
                                   Margin="8"
                                   materialDesign:ElevationAssist.Elevation="Dp2">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Search Box -->
                        <materialDesign:Card Grid.Row="0"
                                           Margin="16,16,16,8"
                                           materialDesign:ElevationAssist.Elevation="Dp1">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <TextBox x:Name="TxtSearch"
                                       Grid.Column="0"
                                       materialDesign:HintAssist.Hint="Search files..."
                                       Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                       Margin="8"
                                       TextChanged="TxtSearch_TextChanged"/>

                                <Button x:Name="BtnClearSearch"
                                      Grid.Column="1"
                                      Style="{StaticResource MaterialDesignIconButton}"
                                      Click="BtnClearSearch_Click"
                                      Margin="0,0,8,0">
                                    <materialDesign:PackIcon Kind="Close"/>
                                </Button>
                            </Grid>
                        </materialDesign:Card>

                        <!-- Current Path and Browse Button -->
                        <Grid Grid.Row="1" Margin="16,8,16,8">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Browse Buttons -->
                            <Grid Grid.Row="0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <Button Grid.Column="0"
                                      x:Name="BtnBrowseFolder"
                                      Style="{StaticResource MaterialDesignRaisedButton}"
                                      Click="BtnOpenFolder_Click"
                                      Margin="0,0,4,12"
                                      Height="40"
                                      Background="{DynamicResource PrimaryHueMidBrush}">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="FolderOpen"
                                                               VerticalAlignment="Center"
                                                               Margin="0,0,8,0"/>
                                        <TextBlock Text="OPEN FOLDER" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Button>

                                <Button Grid.Column="1"
                                      x:Name="BtnOpenFile"
                                      Style="{StaticResource MaterialDesignRaisedButton}"
                                      Click="BtnOpenFile_Click"
                                      Margin="4,0,0,12"
                                      Height="40"
                                      Background="{DynamicResource PrimaryHueMidBrush}">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="FileDocument"
                                                               VerticalAlignment="Center"
                                                               Margin="0,0,8,0"/>
                                        <TextBlock Text="OPEN FILE" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Button>
                            </Grid>

                            <!-- Current Path Display -->
                            <StackPanel Grid.Row="1" Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Folder"
                                                       VerticalAlignment="Center"
                                                       Margin="0,0,8,0"
                                                       Opacity="0.7"/>
                                <TextBlock x:Name="TxtCurrentPath"
                                         Text="No folder selected"
                                         FontSize="11"
                                         Opacity="0.7"
                                         TextTrimming="CharacterEllipsis"
                                         ToolTip="{Binding Text, RelativeSource={RelativeSource Self}}"/>
                            </StackPanel>
                        </Grid>

                        <!-- File List -->
                        <ListView x:Name="FileListView"
                                Grid.Row="2"
                                Margin="8"
                                SelectionChanged="FileListView_SelectionChanged"
                                ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                            <ListView.ItemTemplate>
                                <DataTemplate>
                                    <Grid Margin="8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <materialDesign:PackIcon Grid.Column="0"
                                                               Kind="FileDocument"
                                                               Width="24"
                                                               Height="24"
                                                               VerticalAlignment="Center"
                                                               Margin="0,0,12,0"
                                                               Foreground="{DynamicResource PrimaryHueMidBrush}"/>

                                        <StackPanel Grid.Column="1">
                                            <TextBlock Text="{Binding Name}"
                                                     FontWeight="Medium"
                                                     TextTrimming="CharacterEllipsis"/>
                                            <TextBlock Text="{Binding RelativePath}"
                                                     FontSize="10"
                                                     Opacity="0.6"
                                                     TextTrimming="CharacterEllipsis"/>
                                            <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                                <TextBlock Text="{Binding SizeText}"
                                                         FontSize="10"
                                                         Opacity="0.5"
                                                         Margin="0,0,16,0"/>
                                                <TextBlock Text="{Binding ModifiedText}"
                                                         FontSize="10"
                                                         Opacity="0.5"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </Grid>
                </materialDesign:Card>

                <!-- Splitter -->
                <GridSplitter Grid.Column="1"
                            Width="4"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Stretch"
                            Background="{DynamicResource MaterialDesignDivider}"/>

                <!-- Right Panel - Markdown Viewer -->
                <materialDesign:Card Grid.Column="2"
                                   Margin="8"
                                   materialDesign:ElevationAssist.Elevation="Dp2">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- File Info Header -->
                        <Border Grid.Row="0"
                              Background="{DynamicResource MaterialDesignChipBackground}"
                              Padding="16,12">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0">
                                    <TextBlock x:Name="TxtFileName"
                                             Text="Select a markdown file to view"
                                             FontSize="16"
                                             FontWeight="SemiBold"/>
                                    <TextBlock x:Name="TxtFileInfo"
                                             Text=""
                                             FontSize="11"
                                             Opacity="0.7"
                                             Margin="0,4,0,0"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1"
                                          Orientation="Horizontal"
                                          VerticalAlignment="Center">
                                    <Button x:Name="BtnExport"
                                          Style="{StaticResource MaterialDesignIconButton}"
                                          ToolTip="Export to HTML"
                                          Click="BtnExport_Click"
                                          Margin="4,0">
                                        <materialDesign:PackIcon Kind="FileExport"/>
                                    </Button>

                                    <Button x:Name="BtnPrint"
                                          Style="{StaticResource MaterialDesignIconButton}"
                                          ToolTip="Print"
                                          Click="BtnPrint_Click"
                                          Margin="4,0">
                                        <materialDesign:PackIcon Kind="Printer"/>
                                    </Button>

                                    <Button x:Name="BtnToggleToc"
                                          Style="{StaticResource MaterialDesignIconButton}"
                                          ToolTip="Toggle Table of Contents"
                                          Click="BtnToggleToc_Click"
                                          Margin="4,0">
                                        <materialDesign:PackIcon Kind="FormatListBulleted"/>
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Markdown Content with TOC -->
                        <Grid Grid.Row="1">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Table of Contents (Collapsible) -->
                            <materialDesign:Card x:Name="TocPanel"
                                               Grid.Column="0"
                                               Width="250"
                                               Margin="8"
                                               Visibility="Collapsed"
                                               materialDesign:ElevationAssist.Elevation="Dp1">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>

                                    <TextBlock Grid.Row="0"
                                             Text="TABLE OF CONTENTS"
                                             FontSize="12"
                                             FontWeight="Bold"
                                             Margin="16,12"
                                             Opacity="0.7"/>

                                    <TreeView x:Name="TocTreeView"
                                            Grid.Row="1"
                                            Margin="8"
                                            SelectedItemChanged="TocTreeView_SelectedItemChanged">
                                        <TreeView.ItemTemplate>
                                            <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                                                <TextBlock Text="{Binding Title}"
                                                         TextWrapping="Wrap"
                                                         Margin="4,2"/>
                                            </HierarchicalDataTemplate>
                                        </TreeView.ItemTemplate>
                                    </TreeView>
                                </Grid>
                            </materialDesign:Card>

                            <!-- Markdown Content Area -->
                            <Grid Grid.Column="1">
                                <!-- WebView2 for rendering markdown as HTML -->
                                <wv2:WebView2 x:Name="MarkdownWebView"
                                            Margin="8"/>

                                <!-- Loading Indicator -->
                                <ProgressBar x:Name="LoadingProgress"
                                           Style="{StaticResource MaterialDesignCircularProgressBar}"
                                           Value="0"
                                           IsIndeterminate="True"
                                           Width="50"
                                           Height="50"
                                           Visibility="Collapsed"/>

                                <!-- Welcome Message -->
                                <StackPanel x:Name="WelcomePanel"
                                          HorizontalAlignment="Center"
                                          VerticalAlignment="Center">
                                    <materialDesign:PackIcon Kind="FileDocumentOutline"
                                                           Width="120"
                                                           Height="120"
                                                           Foreground="{DynamicResource PrimaryHueMidBrush}"
                                                           Opacity="0.3"
                                                           HorizontalAlignment="Center"/>
                                    <TextBlock Text="Select a markdown file from the list"
                                             FontSize="18"
                                             Opacity="0.5"
                                             TextAlignment="Center"
                                             Margin="0,24,0,8"/>
                                    <TextBlock Text="or open a folder to get started"
                                             FontSize="14"
                                             Opacity="0.4"
                                             TextAlignment="Center"/>
                                </StackPanel>
                            </Grid>
                        </Grid>
                    </Grid>
                </materialDesign:Card>
            </Grid>

            <!-- Status Bar -->
            <materialDesign:ColorZone Grid.Row="3"
                                     Mode="PrimaryLight"
                                     Padding="16,8"
                                     materialDesign:ElevationAssist.Elevation="Dp2">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="CheckCircle"
                                               VerticalAlignment="Center"
                                               Margin="0,0,8,0"
                                               Foreground="Green"/>
                        <TextBlock x:Name="TxtStatus"
                                 Text="Ready"
                                 VerticalAlignment="Center"
                                 FontSize="12"/>
                    </StackPanel>

                    <TextBlock Grid.Column="2"
                             x:Name="TxtFileCount"
                             Text="0 files"
                             VerticalAlignment="Center"
                             FontSize="12"
                             Opacity="0.7"/>
                </Grid>
            </materialDesign:ColorZone>
        </Grid>
    </materialDesign:DialogHost>
</Window>