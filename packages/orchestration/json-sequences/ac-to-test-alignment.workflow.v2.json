{
  "id": "renderx-web-ac-alignment-workflow-v2",
  "sequenceId": "renderx-web-ac-alignment-workflow-v2",
  "name": "RenderX Web AC-to-Test Alignment Workflow (v2)",
  "packageName": "orchestration",
  "title": "AC-to-Test Alignment â€” Implementation Orchestration (v2)",
  "description": "Fractal workflow to implement and operationalize alignment between structured acceptance criteria (GWT) and automated tests for the renderx-web-orchestration domain.",
  "purpose": "Increase Average AC coverage from 0% to >= 70% by generating an AC registry, tagging tests, parsing results, computing alignment, reporting, and gating CI.",
  "trigger": "Engineering initiative kickoff or CI pipeline task",
  "kind": "governance-workflow",
  "status": "active",
  "tempo": 108,
  "key": "D Major",
  "timeSignature": "4/4",
  "category": "orchestration",
  "movements": [
    {
      "number": 1,
      "name": "AC Registry",
      "description": "Generate normalized AC registry from acceptanceCriteriaStructured across beats and sequences.",
      "beats": [
        {
          "name": "generate-ac-registry",
          "number": 1,
          "handler": { "name": "ac-alignment/generate-registry#generate", "scope": "orchestration", "kind": "orchestration" },
          "event": "renderx-web:ac-alignment:registry-generated",
          "scenario": "Generate canonical AC registry",
          "acceptanceCriteriaStructured": [
            {
              "given": ["ACs are present as acceptanceCriteriaStructured in sequence JSON"],
              "when": ["the generator runs over renderx-web-orchestration"],
              "then": [
                "It emits .generated/acs/renderx-web-orchestration.registry.json",
                "Each AC entry has stable AC ID and normalized GWT",
                "Beat and sequence IDs are preserved"
              ]
            }
          ]
        }
      ]
    },
    {
      "number": 2,
      "name": "Tagging Enablement",
      "description": "Introduce lightweight test tags to correlate tests with ACs and beats.",
      "beats": [
        {
          "name": "publish-tagging-guide",
          "number": 1,
          "handler": { "name": "ac-alignment/tagging#publishGuide", "scope": "orchestration", "kind": "orchestration" },
          "event": "renderx-web:ac-alignment:tagging-guide-published",
          "scenario": "Publish test tagging guide and helpers",
          "acceptanceCriteriaStructured": [
            {
              "given": ["Developers write or maintain tests"],
              "when": ["they follow the tagging guide"],
              "then": [
                "Tags like [AC:renderx-web-orchestration:create:1.1:1] are supported",
                "Beat tags like [BEAT:renderx-web-orchestration:create:1.1] are supported",
                "Examples exist for Cypress and Vitest/Jest"
              ]
            }
          ]
        },
        {
          "name": "suggest-tags",
          "number": 2,
          "handler": { "name": "ac-alignment/tagging#suggest", "scope": "orchestration", "kind": "orchestration" },
          "event": "renderx-web:ac-alignment:tag-suggestions-generated",
          "scenario": "Generate AC/BEAT tag suggestions for all tests",
          "acceptanceCriteriaStructured": [
            {
              "given": ["AC registry exists at .generated/acs/renderx-web-orchestration.registry.json"],
              "when": ["the suggester runs with optional --roots overrides"],
              "then": [
                "Suggestions written to .generated/ac-alignment/suggestions.json",
                "Each file entry includes best scoring AC tag and score"
              ]
            }
          ]
        },
        {
          "name": "apply-tags",
          "number": 3,
          "handler": { "name": "ac-alignment/tagging#apply", "scope": "orchestration", "kind": "orchestration" },
          "event": "renderx-web:ac-alignment:tags-applied",
          "scenario": "Apply tags via dry-run patches or in-place writes",
          "acceptanceCriteriaStructured": [
            {
              "given": ["Tag suggestions exist"],
              "when": ["the applier runs in dry-run mode"],
              "then": [
                "Unified diffs written to .generated/ac-alignment/patches",
                "No source files modified in dry-run"
              ]
            },
            {
              "given": ["Dry-run patches reviewed"],
              "when": ["the applier runs with --write"],
              "then": [
                "Test titles updated to include [AC:...] or [BEAT:...]",
                "Commit prepared updating all affected tests"
              ]
            }
          ]
        }
      ]
    },
    {
      "number": 3,
      "name": "Result Collection",
      "description": "Collect test results and extract tags for mapping.",
      "beats": [
        {
          "name": "collect-vitest-jest",
          "number": 1,
          "handler": { "name": "ac-alignment/results#collectUnit", "scope": "orchestration", "kind": "orchestration" },
          "event": "renderx-web:ac-alignment:unit-results-collected",
          "scenario": "Collect unit/integration test results",
          "acceptanceCriteriaStructured": [
            {
              "given": ["Unit/Integration tests run with JSON reporter"],
              "when": ["collector parses titles"],
              "then": [
                "AC and BEAT tags are extracted",
                "Artifacts stored under .generated/ac-alignment/results/unit.json"
              ]
            }
          ]
        },
        {
          "name": "collect-cypress",
          "number": 2,
          "handler": { "name": "ac-alignment/results#collectE2E", "scope": "orchestration", "kind": "orchestration" },
          "event": "renderx-web:ac-alignment:e2e-results-collected",
          "scenario": "Collect Cypress E2E test results",
          "acceptanceCriteriaStructured": [
            {
              "given": ["Cypress runs with Mocha JSON or custom reporter"],
              "when": ["collector processes spec outputs"],
              "then": [
                "AC and BEAT tags are extracted",
                "Artifacts stored under .generated/ac-alignment/results/e2e.json"
              ]
            }
          ]
        }
      ]
    },
    {
      "number": 4,
      "name": "Alignment Computation",
      "description": "Compute presence and basic THEN-assertion alignment metrics.",
      "beats": [
        {
          "name": "compute-presence-coverage",
          "number": 1,
          "handler": { "name": "ac-alignment/compute#presence", "scope": "orchestration", "kind": "orchestration" },
          "event": "renderx-web:ac-alignment:presence-coverage-computed",
          "scenario": "Compute presence-based AC coverage",
          "acceptanceCriteriaStructured": [
            {
              "given": ["AC registry and extracted tags"],
              "when": ["the presence engine runs"],
              "then": [
                "Per-AC mapping exists when any matching tag is found",
                "Coverage summary JSON written under .generated/ac-alignment/coverage.presence.json"
              ]
            }
          ]
        },
        {
          "name": "compute-then-heuristics",
          "number": 2,
          "handler": { "name": "ac-alignment/compute#thenHeuristics", "scope": "orchestration", "kind": "orchestration" },
          "event": "renderx-web:ac-alignment:then-coverage-computed",
          "scenario": "Heuristic THEN-to-assertion mapping",
          "acceptanceCriteriaStructured": [
            {
              "given": ["THEN clauses and optional ASSERT markers"],
              "when": ["heuristics evaluate assertion types"],
              "then": [
                "THEN coverage computed per AC",
                "Scores and confidence recorded in .generated/ac-alignment/coverage.then.json"
              ]
            }
          ]
        }
      ]
    },
    {
      "number": 5,
      "name": "Reporting",
      "description": "Emit alignment sections in analysis artifacts and Markdown report.",
      "beats": [
        {
          "name": "emit-artifacts",
          "number": 1,
          "handler": { "name": "ac-alignment/report#emitArtifacts", "scope": "orchestration", "kind": "orchestration" },
          "event": "renderx-web:ac-alignment:artifacts-emitted",
          "scenario": "Write JSON and Markdown summary",
          "acceptanceCriteriaStructured": [
            {
              "given": ["Computed presence and THEN coverage"],
              "when": ["reporter runs"],
              "then": [
                "Artifacts saved under .generated/analysis/renderx-web-orchestration/*ac-alignment*",
                "Markdown report at docs/generated/renderx-web-orchestration/ac-alignment-report.md"
              ]
            }
          ]
        }
      ]
    },
    {
      "number": 6,
      "name": "CI Gate & Rollout",
      "description": "Apply thresholds and integrate into CI with progressive rollout.",
      "beats": [
        {
          "name": "enforce-thresholds",
          "number": 1,
          "handler": { "name": "ac-alignment/ci#enforceThresholds", "scope": "orchestration", "kind": "orchestration" },
          "event": "renderx-web:ac-alignment:thresholds-enforced",
          "scenario": "Warn/Fail based on coverage thresholds",
          "acceptanceCriteriaStructured": [
            {
              "given": ["Coverage metrics exist"],
              "when": ["CI job evaluates thresholds"],
              "then": [
                "Warn when Average AC coverage < 70%",
                "Fail critical beats when coverage < 50%",
                "Exit codes reflect gating policy"
              ]
            }
          ]
        },
        {
          "name": "rollout",
          "number": 2,
          "handler": { "name": "ac-alignment/ci#rollout", "scope": "orchestration", "kind": "orchestration" },
          "event": "renderx-web:ac-alignment:rolled-out",
          "scenario": "Progressive rollout and stabilization",
          "acceptanceCriteriaStructured": [
            {
              "given": ["Initial adoption across key symphonies"],
              "when": ["rollout expands to full domain"],
              "then": [
                "Average AC coverage >= 70% is sustained",
                "Documentation and helpers remain up-to-date",
                "Regression alerts fire on drops"
              ]
            }
          ]
        }
      ]
    }
  ],
  "events": [
    "renderx-web:ac-alignment:registry-generated",
    "renderx-web:ac-alignment:tagging-guide-published",
    "renderx-web:ac-alignment:tag-suggestions-generated",
    "renderx-web:ac-alignment:tags-applied",
    "renderx-web:ac-alignment:unit-results-collected",
    "renderx-web:ac-alignment:e2e-results-collected",
    "renderx-web:ac-alignment:presence-coverage-computed",
    "renderx-web:ac-alignment:then-coverage-computed",
    "renderx-web:ac-alignment:artifacts-emitted",
    "renderx-web:ac-alignment:thresholds-enforced",
    "renderx-web:ac-alignment:rolled-out"
  ],
  "metadata": {
    "version": "1.0.0",
    "created": "2025-12-01",
    "author": "Architecture & QA",
    "lastModified": "2025-12-01",
    "production": false,
    "tags": ["governance", "quality", "testing", "renderx", "ac-alignment"]
  }
}
