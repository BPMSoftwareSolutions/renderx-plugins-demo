<?xml version="1.0" encoding="UTF-8"?>
<svg viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg">
  <!-- Scene 3: First subscriber stop and replay cache with animations -->
  <!-- Background sky -->
  <rect x="0" y="0" width="800" height="250" fill="#87CEEB"/>
  <!-- Clouds -->
  <g fill="#FFFFFF" opacity="0.8">
  <circle cx="100" cy="45" r="16"/>
  <circle cx="118" cy="45" r="11"/>
  <circle cx="88" cy="50" r="9"/>
  <circle cx="600" cy="65" r="20"/>
  <circle cx="622" cy="65" r="14"/>
  <circle cx="585" cy="70" r="11"/>
  <circle cx="350" cy="35" r="13"/>
  <circle cx="365" cy="35" r="9"/>
  <circle cx="340" cy="40" r="7"/>
</g>
  <!-- Ground -->
  <rect x="0" y="250" width="800" height="150" fill="#4A6B3A"/>
  <!-- Road -->
  <rect x="0" y="280" width="800" height="60" fill="#404040"/>
  <rect x="0" y="278" width="800" height="2" fill="#606060"/>
  <rect x="0" y="340" width="800" height="2" fill="#606060"/>
  <!-- Guardrails -->
  <rect x="0" y="265" width="800" height="8" fill="#E0E0E0" stroke="#C0C0C0" stroke-width="1"/>
  <rect x="0" y="345" width="800" height="8" fill="#E0E0E0" stroke="#C0C0C0" stroke-width="1"/>
  <!-- Dashed center line -->
  <g fill="#FFFF00">
  <rect x="50" y="308" width="40" height="4"/>
  <rect x="120" y="308" width="40" height="4"/>
  <rect x="190" y="308" width="40" height="4"/>
  <rect x="260" y="308" width="40" height="4"/>
  <rect x="330" y="308" width="40" height="4"/>
  <rect x="400" y="308" width="40" height="4"/>
  <rect x="470" y="308" width="40" height="4"/>
  <rect x="540" y="308" width="40" height="4"/>
  <rect x="610" y="308" width="40" height="4"/>
  <rect x="680" y="308" width="40" height="4"/>
</g>
  <!-- School bus with pickup animation -->
  <g id="school-bus" transform="translate(350, 250)">
  <!-- Bus movement: approach stop, pause for pickup, continue -->
  <animateTransform attributeName="transform" type="translate"
values="100,250; 450,250; 450,250; 900,250"
dur="15s"
repeatCount="indefinite"/>
  <rect x="0" y="0" width="100" height="35" rx="4" ry="4" fill="#FFD700" stroke="#E6C200" stroke-width="2"/>
  <rect x="95" y="3" width="10" height="29" rx="5" ry="5" fill="#FFD700" stroke="#E6C200" stroke-width="2"/>
  <rect x="-2" y="-3" width="104" height="5" rx="2.5" ry="2.5" fill="#FFA500"/>
  <!-- Windows -->
  <rect x="90" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
  <rect x="82" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
  <rect x="74" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
  <rect x="66" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
  <rect x="58" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
  <rect x="50" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
  <rect x="42" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
  <rect x="34" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
  <rect x="26" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
  <rect x="18" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
  <rect x="97" y="6" width="6" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
  <rect x="12" y="8" width="5" height="6" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
  <!-- Door with opening animation -->
  <rect x="80" y="20" width="10" height="13" rx="1" ry="1" fill="#E6C200" stroke="#D4AF37" stroke-width="1">
  <animate attributeName="width" values="10;2;10" dur="15s" repeatCount="indefinite"/>
</rect>
  <text x="50" y="24" text-anchor="middle" font-family="Arial, sans-serif" font-size="6" font-weight="bold" fill="#000">SCHOOL BUS</text>
  <rect x="0" y="18" width="100" height="3" fill="#FFA500"/>
  <circle cx="101" cy="12" r="2.5" fill="#FFFF00">
  <animate attributeName="opacity" values="0.8;1;0.8" dur="2s" repeatCount="indefinite"/>
</circle>
  <!-- Wheels with spinning animation -->
  <g id="front-wheel">
  <circle cx="20" cy="37" r="6" fill="#333" stroke="#222" stroke-width="1"/>
  <circle cx="20" cy="37" r="3" fill="#666"/>
  <g transform-origin="20 37">
  <line x1="20" y1="32" x2="20" y2="42" stroke="#AAA" stroke-width="1"/>
  <line x1="15" y1="37" x2="25" y2="37" stroke="#AAA" stroke-width="1"/>
  <animateTransform attributeName="transform" type="rotate" values="0;360" dur="1s" repeatCount="indefinite"/>
</g>
</g>
  <g id="rear-wheel">
  <circle cx="80" cy="37" r="6" fill="#333" stroke="#222" stroke-width="1"/>
  <circle cx="80" cy="37" r="3" fill="#666"/>
  <g transform-origin="80 37">
  <line x1="80" y1="32" x2="80" y2="42" stroke="#AAA" stroke-width="1"/>
  <line x1="75" y1="37" x2="85" y2="37" stroke="#AAA" stroke-width="1"/>
  <animateTransform attributeName="transform" type="rotate" values="0;360" dur="1s" repeatCount="indefinite"/>
</g>
</g>
</g>
  <!-- Bus stop shelter -->
  <g id="bus-stop-shelter" transform="translate(550, 180)">
  <!-- Shelter roof -->
  <rect x="0" y="0" width="120" height="8" fill="#4682B4" stroke="#2F4F4F" stroke-width="2" rx="4"/>
  <!-- Shelter supports -->
  <rect x="5" y="8" width="4" height="60" fill="#708090"/>
  <rect x="111" y="8" width="4" height="60" fill="#708090"/>
  <!-- Shelter back wall -->
  <rect x="5" y="15" width="110" height="53" fill="#E0E7FF" stroke="#3B82F6" stroke-width="1" opacity="0.8"/>
  <!-- Shelter floor -->
  <rect x="0" y="65" width="120" height="5" fill="#C0C0C0"/>
  <!-- Live Subscriber bench -->
  <rect x="15" y="45" width="40" height="15" fill="#3B82F6" stroke="#1E3A8A" stroke-width="1" rx="2"/>
  <rect x="15" y="40" width="40" height="8" fill="#60A5FA" stroke="#3B82F6" stroke-width="1" rx="1"/>
  <!-- Late Subscriber bench -->
  <rect x="65" y="45" width="40" height="15" fill="#EF4444" stroke="#DC2626" stroke-width="1" rx="2"/>
  <rect x="65" y="40" width="40" height="8" fill="#F87171" stroke="#EF4444" stroke-width="1" rx="1"/>
  <!-- Bench labels -->
  <text x="35" y="38" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" font-weight="bold" fill="#1E3A8A">Live Subscriber</text>
  <text x="85" y="38" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" font-weight="bold" fill="#DC2626">Late Subscriber</text>
  <!-- Live subscriber with boarding animation -->
  <g id="live-subscriber" transform="translate(25, 25)">
  <circle cx="5" cy="5" r="3" fill="#FBBF24"/>
  <rect x="2" y="8" width="6" height="10" fill="#3B82F6" rx="1"/>
  <rect x="1" y="12" width="2" height="6" fill="#1E3A8A"/>
  <rect x="7" y="12" width="2" height="6" fill="#1E3A8A"/>
  <!-- Animation: subscriber moves toward bus during pickup -->
  <animateTransform attributeName="transform" type="translate"
values="25,25; 25,25; -100,50; -100,50"
dur="15s"
repeatCount="indefinite"/>
  <!-- Opacity animation: subscriber disappears when boarding bus -->
  <animate attributeName="opacity"
values="1;1;0;0"
dur="15s"
repeatCount="indefinite"/>
</g>
  <!-- Late subscriber with waiting animation -->
  <g id="late-subscriber" transform="translate(75, 25)">
  <circle cx="5" cy="5" r="3" fill="#F87171"/>
  <rect x="2" y="8" width="6" height="10" fill="#EF4444" rx="1"/>
  <rect x="1" y="12" width="2" height="6" fill="#DC2626"/>
  <rect x="7" y="12" width="2" height="6" fill="#DC2626"/>
  <!-- Animation: late subscriber stays and fades (missed the bus) -->
  <animate attributeName="opacity" values="1;1;1;0.3;0.3" dur="15s" repeatCount="indefinite"/>
</g>
</g>
  <!-- Replay Cache kiosk -->
  <g id="replay-cache-kiosk" transform="translate(680, 200)">
  <!-- Kiosk structure -->
  <rect x="0" y="0" width="60" height="70" fill="#6B7280" stroke="#374151" stroke-width="2" rx="4"/>
  <rect x="3" y="3" width="54" height="64" fill="#9CA3AF" stroke="#6B7280" stroke-width="1" rx="3"/>
  <!-- Kiosk screen/window -->
  <rect x="8" y="15" width="44" height="30" fill="#1F2937" stroke="#111827" stroke-width="1" rx="2"/>
  <rect x="10" y="17" width="40" height="26" fill="#374151" stroke="#1F2937" stroke-width="1" rx="1"/>
  <!-- Cache content display -->
  <text x="30" y="27" text-anchor="middle" font-family="Courier, monospace" font-size="6" fill="#10B981">REPLAY CACHE</text>
  <text x="30" y="35" text-anchor="middle" font-family="Courier, monospace" font-size="5" fill="#FFFFFF">Last Message:</text>
  <text x="30" y="41" text-anchor="middle" font-family="Courier, monospace" font-size="4" fill="#FBBF24">{payload: "..."}</text>
  <!-- Kiosk label -->
  <rect x="5" y="50" width="50" height="12" fill="#FFFFFF" stroke="#333" stroke-width="1" rx="2"/>
  <text x="30" y="58" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" font-weight="bold" fill="#333">REPLAY CACHE</text>
  <!-- Activity indicator with enhanced animation -->
  <circle cx="52" cy="10" r="3" fill="#10B981">
  <animate attributeName="opacity" values="0.5;1;0.5" dur="1.5s" repeatCount="indefinite"/>
</circle>
  <!-- Data flow animation to late subscriber -->
  <g id="cache-data-flow">
  <circle cx="30" cy="30" r="2" fill="#FBBF24">
  <animate attributeName="opacity" values="0;1;0" dur="3s" repeatCount="indefinite"/>
  <animateTransform attributeName="transform" type="translate"
values="0,0; -50,-20; -100,-40"
dur="3s"
repeatCount="indefinite"/>
</circle>
</g>
</g>
  <!-- Flow arrows -->
  <g stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)">
  <!-- Bus to live subscriber -->
  <path d="M 420,280 Q 480,260 570,220" stroke="#3B82F6"/>
  <!-- Replay cache to late subscriber -->
  <path d="M 680,235 Q 650,225 620,220" stroke="#EF4444"/>
</g>
  <!-- Arrow marker definition -->
  <defs>
  <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
  <polygon points="0 0, 10 3.5, 0 7" fill="#333"/>
</marker>
</defs>
  <!-- Sky Text -->
  <g id="sky-text" transform="translate(400, 40)">
  <!-- Bold headline -->
  <text x="0" y="0" text-anchor="middle" font-family="Arial, sans-serif" font-size="40" font-weight="bold" fill="#1E3A56" stroke="#FFFFFF" stroke-width="2" stroke-opacity="0.8" style="filter: drop-shadow(0px 2px 3px rgba(255,255,255,0.6))">No one misses the bus.</text>
  <!-- Supporting description -->
  <text x="0" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" fill="#3C556E" style="filter: drop-shadow(0px 1px 2px rgba(255,255,255,0.5))">Live and late subscribers both get the message, thanks to the Replay Cache.</text>
</g>
  <!-- Caption -->
  <g id="caption" transform="translate(400, 370)">
  <rect x="-200" y="-10" width="400" height="25" fill="#FFFFFF" fill-opacity="0.9" stroke="#333" stroke-width="1" rx="5"/>
  <text x="0" y="8" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#333">First stop: live &amp; late subscribers; Replay Cache hydrates latecomers</text>
</g>
</svg>
