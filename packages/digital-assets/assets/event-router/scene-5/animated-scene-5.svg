<svg viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg">
  <!-- Scene 5: Rules, boundaries, and street signs with traffic light animation -->
  
  <!-- Background sky -->
  <rect x="0" y="0" width="800" height="250" fill="#87CEEB"/>
  
  <!-- Clouds -->
  <g fill="#FFFFFF" opacity="0.8">
    <circle cx="80" cy="35" r="14"/>
    <circle cx="95" cy="35" r="9"/>
    <circle cx="70" cy="40" r="7"/>
    
    <circle cx="600" cy="55" r="16"/>
    <circle cx="618" cy="55" r="11"/>
    <circle cx="588" cy="60" r="9"/>
    
    <circle cx="250" cy="25" r="11"/>
    <circle cx="262" cy="25" r="7"/>
    <circle cx="242" cy="30" r="5"/>
  </g>
  
  <!-- Ground -->
  <rect x="0" y="250" width="800" height="150" fill="#4A6B3A"/>
  
  <!-- Road -->
  <rect x="0" y="280" width="800" height="60" fill="#404040"/>
  <rect x="0" y="278" width="800" height="2" fill="#606060"/>
  <rect x="0" y="340" width="800" height="2" fill="#606060"/>
  
  <!-- Enhanced guardrails -->
  <rect x="0" y="265" width="800" height="10" fill="#E0E0E0" stroke="#C0C0C0" stroke-width="1"/>
  <rect x="0" y="345" width="800" height="10" fill="#E0E0E0" stroke="#C0C0C0" stroke-width="1"/>
  
  <!-- Guardrail posts -->
  <g fill="#C0C0C0">
    <rect x="50" y="260" width="4" height="20"/>
    <rect x="150" y="260" width="4" height="20"/>
    <rect x="250" y="260" width="4" height="20"/>
    <rect x="350" y="260" width="4" height="20"/>
    <rect x="450" y="260" width="4" height="20"/>
    <rect x="550" y="260" width="4" height="20"/>
    <rect x="650" y="260" width="4" height="20"/>
    <rect x="750" y="260" width="4" height="20"/>
    
    <rect x="50" y="345" width="4" height="20"/>
    <rect x="150" y="345" width="4" height="20"/>
    <rect x="250" y="345" width="4" height="20"/>
    <rect x="350" y="345" width="4" height="20"/>
    <rect x="450" y="345" width="4" height="20"/>
    <rect x="550" y="345" width="4" height="20"/>
    <rect x="650" y="345" width="4" height="20"/>
    <rect x="750" y="345" width="4" height="20"/>
  </g>
  
  <!-- Lane markings for performance controls -->
  <!-- Debounce lane (left) - funnel with single pulse -->
  <g transform="translate(200, 290)">
    <!-- Funnel shape -->
    <polygon points="0,10 20,5 20,15 0,20" fill="#FFFF00" opacity="0.7"/>
    <polygon points="25,7 35,8 35,12 25,13" fill="#FFFF00" opacity="0.7"/>
    <!-- Single pulse after funnel -->
    <rect x="40" y="8" width="8" height="4" fill="#FFFF00" rx="2"/>
  </g>
  
  <!-- Throttle lane (right) - evenly spaced ticks -->
  <g transform="translate(500, 295)" fill="#FFFF00" opacity="0.7">
    <rect x="0" y="0" width="3" height="10" rx="1"/>
    <rect x="10" y="0" width="3" height="10" rx="1"/>
    <rect x="20" y="0" width="3" height="10" rx="1"/>
    <rect x="30" y="0" width="3" height="10" rx="1"/>
    <rect x="40" y="0" width="3" height="10" rx="1"/>
    <rect x="50" y="0" width="3" height="10" rx="1"/>
  </g>
  
  <!-- Regular dashed center line -->
  <g fill="#FFFF00">
    <rect x="50" y="308" width="30" height="4"/>
    <rect x="120" y="308" width="30" height="4"/>
    <rect x="300" y="308" width="30" height="4"/>
    <rect x="370" y="308" width="30" height="4"/>
    <rect x="600" y="308" width="30" height="4"/>
    <rect x="680" y="308" width="30" height="4"/>
    <rect x="750" y="308" width="30" height="4"/>
  </g>
  
  <!-- School bus with traffic light stop-and-go animation -->
  <g id="school-bus" transform="translate(350, 250)">
    <!-- Bus movement: approach traffic light, stop at red, proceed on green -->
    <animateTransform attributeName="transform" type="translate" 
                      values="100,250; 600,250; 600,250; 900,250" 
                      dur="16s" 
                      repeatCount="indefinite"/>
    
    <rect x="0" y="0" width="100" height="35" rx="4" ry="4" fill="#FFD700" stroke="#E6C200" stroke-width="2"/>
    <rect x="95" y="3" width="10" height="29" rx="5" ry="5" fill="#FFD700" stroke="#E6C200" stroke-width="2"/>
    <rect x="-2" y="-3" width="104" height="5" rx="2.5" ry="2.5" fill="#FFA500"/>
    
    <!-- Windows -->
    <rect x="90" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
    <rect x="82" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
    <rect x="74" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
    <rect x="66" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
    <rect x="58" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
    <rect x="50" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
    <rect x="42" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
    <rect x="34" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
    <rect x="26" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
    <rect x="18" y="6" width="7" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
    
    <rect x="97" y="6" width="6" height="10" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
    <rect x="12" y="8" width="5" height="6" rx="1" ry="1" fill="#2F4F4F" opacity="0.8"/>
    
    <rect x="80" y="20" width="10" height="13" rx="1" ry="1" fill="#E6C200" stroke="#D4AF37" stroke-width="1"/>
    <text x="50" y="24" text-anchor="middle" font-family="Arial, sans-serif" font-size="6" font-weight="bold" fill="#000">SCHOOL BUS</text>
    <rect x="0" y="18" width="100" height="3" fill="#FFA500"/>
    
    <circle cx="101" cy="12" r="2.5" fill="#FFFF00">
      <animate attributeName="opacity" values="0.8;1;0.8" dur="2s" repeatCount="indefinite"/>
    </circle>
    
    <!-- Wheels with spinning animation -->
    <g id="front-wheel">
      <circle cx="20" cy="37" r="6" fill="#333" stroke="#222" stroke-width="1"/>
      <circle cx="20" cy="37" r="3" fill="#666"/>
      <g transform-origin="20 37">
        <line x1="20" y1="32" x2="20" y2="42" stroke="#AAA" stroke-width="1"/>
        <line x1="15" y1="37" x2="25" y2="37" stroke="#AAA" stroke-width="1"/>
        <animateTransform attributeName="transform" type="rotate" values="0;360" dur="1s" repeatCount="indefinite"/>
      </g>
    </g>
    
    <g id="rear-wheel">
      <circle cx="80" cy="37" r="6" fill="#333" stroke="#222" stroke-width="1"/>
      <circle cx="80" cy="37" r="3" fill="#666"/>
      <g transform-origin="80 37">
        <line x1="80" y1="32" x2="80" y2="42" stroke="#AAA" stroke-width="1"/>
        <line x1="75" y1="37" x2="85" y2="37" stroke="#AAA" stroke-width="1"/>
        <animateTransform attributeName="transform" type="rotate" values="0;360" dur="1s" repeatCount="indefinite"/>
      </g>
    </g>
  </g>
  
  <!-- Street signs for rules and boundaries -->
  <!-- Loop Prevention sign -->
  <g id="loop-prevention-sign" transform="translate(100, 180)">
    <rect x="18" y="40" width="4" height="50" fill="#666"/>
    <polygon points="0,0 40,0 35,35 5,35" fill="#FFD700" stroke="#E6C200" stroke-width="2"/>
    <polygon points="2,2 38,2 33,33 7,33" fill="#FFF8DC"/>
    
    <!-- Loop symbol crossed out -->
    <circle cx="20" cy="18" r="8" fill="none" stroke="#DC143C" stroke-width="2"/>
    <path d="M 15,13 Q 20,8 25,13 Q 20,18 15,13" fill="none" stroke="#DC143C" stroke-width="2"/>
    <line x1="12" y1="12" x2="28" y2="24" stroke="#DC143C" stroke-width="3"/>
    
    <text x="20" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="6" font-weight="bold" fill="#DC143C">LOOP</text>
    <text x="20" y="36" text-anchor="middle" font-family="Arial, sans-serif" font-size="6" font-weight="bold" fill="#DC143C">PREVENTION</text>
  </g>
  
  <!-- Handler Isolation sign -->
  <g id="handler-isolation-sign" transform="translate(300, 170)">
    <rect x="18" y="50" width="4" height="60" fill="#666"/>
    <rect x="0" y="0" width="40" height="35" fill="#228B22" stroke="#006400" stroke-width="2" rx="3"/>
    <rect x="2" y="2" width="36" height="31" fill="#32CD32" rx="2"/>
    
    <!-- Lab flask icon -->
    <g transform="translate(20, 18)">
      <rect x="-3" y="-8" width="6" height="4" fill="#FFFFFF" rx="1"/>
      <polygon points="-5,0 5,0 3,8 -3,8" fill="#FFFFFF"/>
      <circle cx="0" cy="4" r="2" fill="#00BFFF"/>
      <rect x="-1" y="-6" width="2" height="2" fill="#FFFFFF"/>
    </g>
    
    <text x="20" y="28" text-anchor="middle" font-family="Arial, sans-serif" font-size="5" font-weight="bold" fill="#FFFFFF">HANDLER</text>
    <text x="20" y="33" text-anchor="middle" font-family="Arial, sans-serif" font-size="5" font-weight="bold" fill="#FFFFFF">ISOLATION</text>
  </g>
  
  <!-- Feature Flags sign -->
  <g id="feature-flags-sign" transform="translate(600, 175)">
    <rect x="18" y="45" width="4" height="55" fill="#666"/>
    <rect x="0" y="0" width="40" height="30" fill="#4169E1" stroke="#191970" stroke-width="2" rx="3"/>
    <rect x="2" y="2" width="36" height="26" fill="#6495ED" rx="2"/>
    
    <!-- Toggle switch -->
    <rect x="10" y="8" width="20" height="8" fill="#FFFFFF" stroke="#333" stroke-width="1" rx="4"/>
    <circle cx="25" cy="12" r="3" fill="#32CD32" stroke="#228B22" stroke-width="1"/>
    <text x="8" y="14" font-family="Arial, sans-serif" font-size="4" fill="#333">OFF</text>
    <text x="28" y="14" font-family="Arial, sans-serif" font-size="4" fill="#333">ON</text>
    
    <text x="20" y="24" text-anchor="middle" font-family="Arial, sans-serif" font-size="5" font-weight="bold" fill="#FFFFFF">FEATURE</text>
    <text x="20" y="29" text-anchor="middle" font-family="Arial, sans-serif" font-size="5" font-weight="bold" fill="#FFFFFF">FLAGS</text>
  </g>
  
  <!-- Traffic light with synchronized sequence -->
  <g id="traffic-light" transform="translate(720, 190)">
    <rect x="18" y="50" width="3" height="40" fill="#666"/>
    <rect x="10" y="10" width="20" height="45" rx="3" ry="3" fill="#333"/>
    
    <!-- Red light (active during bus stop period) -->
    <circle cx="20" cy="20" r="4" fill="#FF0000">
      <animate attributeName="fill" values="#800000;#FF0000;#800000;#800000" dur="16s" repeatCount="indefinite"/>
    </circle>
    
    <!-- Yellow light (brief transition) -->
    <circle cx="20" cy="30" r="4" fill="#806000">
      <animate attributeName="fill" values="#806000;#806000;#FFFF00;#806000" dur="16s" repeatCount="indefinite"/>
    </circle>
    
    <!-- Green light (active during bus movement) -->
    <circle cx="20" cy="40" r="4" fill="#008000">
      <animate attributeName="fill" values="#008000;#008000;#008000;#00FF00" dur="16s" repeatCount="indefinite"/>
    </circle>
  </g>
  
  <!-- Caption -->
  <g id="caption" transform="translate(400, 370)">
    <rect x="-250" y="-10" width="500" height="25" fill="#FFFFFF" fill-opacity="0.9" stroke="#333" stroke-width="1" rx="5"/>
    <text x="0" y="8" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#333">Street rules: enforced boundaries, flags, throttle &amp; debounce lanes</text>
  </g>
</svg>
