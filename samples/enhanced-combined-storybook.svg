<?xml version="1.0" encoding="UTF-8"?>
<svg width="1750" height="1500" viewBox="0 0 1750 1500"
     xmlns="http://www.w3.org/2000/svg" role="img" aria-label="EventRouter Journey: Enhanced Combined Storybook">

  <defs>
    
    <g id="unified-bus-sprite">
      <!-- Bus body -->
      <rect x="0" y="0" width="60" height="30" rx="4" ry="4" fill="#FFD700" stroke="#E6C200" stroke-width="1"/>
      <!-- Bus front -->
      <rect x="55" y="3" width="8" height="24" rx="4" ry="4" fill="#FFD700" stroke="#E6C200" stroke-width="1"/>
      <!-- Bus roof -->
      <rect x="-1" y="-2" width="62" height="4" rx="2" ry="2" fill="#FFA500"/>
      <!-- Front bumper -->
      <rect x="61" y="26" width="4" height="3" rx="1" ry="1" fill="#C0C0C0"/>
      <!-- Wheels -->
      <circle id="front-wheel" cx="50" cy="32" r="4" fill="#333">
        <animateTransform attributeName="transform" type="rotate" values="0;360" dur="1s" repeatCount="indefinite"/>
      </circle>
      <circle id="rear-wheel" cx="15" cy="32" r="4" fill="#333">
        <animateTransform attributeName="transform" type="rotate" values="0;360" dur="1s" repeatCount="indefinite"/>
      </circle>
      <!-- Headlights -->
      <circle cx="63" cy="8" r="2" fill="#FFFFCC" opacity="0.8">
        <animate attributeName="opacity" values="0.8;1;0.8" dur="2s" repeatCount="indefinite"/>
      </circle>
      <circle cx="63" cy="22" r="2" fill="#FFFFCC" opacity="0.8">
        <animate attributeName="opacity" values="0.8;1;0.8" dur="2s" repeatCount="indefinite"/>
      </circle>
      <!-- Windows -->
      <rect x="8" y="5" width="12" height="8" rx="1" fill="#87CEEB" opacity="0.7"/>
      <rect x="22" y="5" width="12" height="8" rx="1" fill="#87CEEB" opacity="0.7"/>
      <rect x="36" y="5" width="12" height="8" rx="1" fill="#87CEEB" opacity="0.7"/>
    </g>
  

    <!-- Glow filter for scene highlighting -->
    <filter id="scene-glow" x="-20%" y="-20%" width="140%" height="140%">
      <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
      <feMerge>
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>

    <!-- Progress bar gradient -->
    <linearGradient id="progress-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#8b5cf6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#3b82f6;stop-opacity:1" />
    </linearGradient>
  </defs>

  <style>
    
      .scene-1 {
        transition: all 0.5s ease-in-out;
      }

      .scene-1.active {
        opacity: 1;
        border: 3px solid #8b5cf6;
        box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
      }

      .scene-1.dimmed {
        opacity: 0.7;
        border: 2px solid #e0e0e0;
      }

      .scene-1.inactive {
        opacity: 0.5;
        border: 1px solid #e0e0e0;
      }
    

      .scene-2 {
        transition: all 0.5s ease-in-out;
      }

      .scene-2.active {
        opacity: 1;
        border: 3px solid #8b5cf6;
        box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
      }

      .scene-2.dimmed {
        opacity: 0.7;
        border: 2px solid #e0e0e0;
      }

      .scene-2.inactive {
        opacity: 0.5;
        border: 1px solid #e0e0e0;
      }
    

      .scene-3 {
        transition: all 0.5s ease-in-out;
      }

      .scene-3.active {
        opacity: 1;
        border: 3px solid #8b5cf6;
        box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
      }

      .scene-3.dimmed {
        opacity: 0.7;
        border: 2px solid #e0e0e0;
      }

      .scene-3.inactive {
        opacity: 0.5;
        border: 1px solid #e0e0e0;
      }
    

      .scene-4 {
        transition: all 0.5s ease-in-out;
      }

      .scene-4.active {
        opacity: 1;
        border: 3px solid #8b5cf6;
        box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
      }

      .scene-4.dimmed {
        opacity: 0.7;
        border: 2px solid #e0e0e0;
      }

      .scene-4.inactive {
        opacity: 0.5;
        border: 1px solid #e0e0e0;
      }
    

      .scene-5 {
        transition: all 0.5s ease-in-out;
      }

      .scene-5.active {
        opacity: 1;
        border: 3px solid #8b5cf6;
        box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
      }

      .scene-5.dimmed {
        opacity: 0.7;
        border: 2px solid #e0e0e0;
      }

      .scene-5.inactive {
        opacity: 0.5;
        border: 1px solid #e0e0e0;
      }
    

      .scene-6 {
        transition: all 0.5s ease-in-out;
      }

      .scene-6.active {
        opacity: 1;
        border: 3px solid #8b5cf6;
        box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
      }

      .scene-6.dimmed {
        opacity: 0.7;
        border: 2px solid #e0e0e0;
      }

      .scene-6.inactive {
        opacity: 0.5;
        border: 1px solid #e0e0e0;
      }
    

    .progress-bar {
      fill: url(#progress-gradient);
      animation: progress-fill 60s linear infinite;
    }

    @keyframes progress-fill {
      from { width: 0; }
      to { width: 1650px; }
    }

    .connection-path {
      stroke: #8b5cf6;
      stroke-width: 2;
      stroke-dasharray: 5,5;
      fill: none;
      opacity: 0.6;
      animation: dash-flow 2s linear infinite;
    }

    @keyframes dash-flow {
      to { stroke-dashoffset: -10; }
    }
  </style>

  <!-- Background -->
  <rect x="0" y="0" width="100%" height="100%" fill="#F8F9FA"/>

  <!-- Title -->
  <text x="875" y="40" text-anchor="middle"
        font-family="Arial, sans-serif" font-size="28" font-weight="bold" fill="#1E3A56">
    EventRouter Journey: Enhanced Combined Storybook
  </text>
  <text x="875" y="70" text-anchor="middle"
        font-family="Arial, sans-serif" font-size="16" fill="#3C556E">
    Enhanced with Scene-by-Scene Animation Coordination
  </text>

  <!-- Progress bar -->
  <rect x="50" y="85" width="1650" height="4" fill="#E0E0E0" rx="2"/>
  <rect x="50" y="85" width="0" height="4" class="progress-bar" rx="2"/>

  <!-- Connection paths between scenes -->
  <path d="M 770,350 Q 845,300 920,350" class="connection-path"/>
  <path d="M 1620,350 Q 845,525 70,800" class="connection-path"/>
  <path d="M 770,800 Q 845,750 920,800" class="connection-path"/>
  <path d="M 1620,800 Q 845,975 70,1250" class="connection-path"/>
  <path d="M 770,1250 Q 845,1200 920,1250" class="connection-path"/>

  <!-- Scene 1: The bus leaving the depot with animations -->
  <g class="scene-1" transform="translate(50, 150)">
    <rect x="0" y="0" width="800" height="400"
          fill="#FFFFFF" stroke="#E0E0E0" stroke-width="2" rx="8" class="scene-border"/>

    <!-- Scene timing indicator -->
    <rect x="5" y="5" width="20" height="4" fill="#E0E0E0" rx="2"/>
    <rect x="5" y="5" width="0" height="4" fill="#8b5cf6" rx="2" class="scene-progress">
      <animate attributeName="width"
               values="0;20;20;0"
               dur="60s"
               begin="0s"
               repeatCount="indefinite"/>
    </rect>

    <clipPath id="scene-1-clip">
      <rect x="0" y="0" width="800" height="400" rx="8"/>
    </clipPath>
    <g clip-path="url(#scene-1-clip)">
      <svg x="0" y="0" width="800" height="400" viewBox="0 0 800 400">

  <defs><linearGradient id="roadGradient" x1="0" y1="0" x2="1" y2="0"><stop offset="0" stop-color="#404040"/><stop offset="0.5" stop-color="#505050"/><stop offset="1" stop-color="#404040"/></linearGradient><linearGradient id="busGradient" x1="0" y1="0" x2="1" y2="0"><stop offset="0" stop-color="#FFD700"/><stop offset="0.5" stop-color="#FFA500"/><stop offset="1" stop-color="#FFD700"/></linearGradient><filter id="sceneShadow" x="-20%" y="-20%" width="140%" height="140%"><feDropShadow dx="0" dy="4" stdDeviation="8" flood-color="#000" flood-opacity="0.25"/></filter><filter id="busGlow"><feGaussianBlur stdDeviation="2" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
</defs>
  
    <style>
      .active-glow rect { filter: url(#glow); stroke: #8b5cf6; }
      .connector { stroke-linecap: round; stroke-linejoin: round; }
      .boundary-title { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-weight: 600; }
      .flow-token { animation-fill-mode: forwards; }
      .boundary-contained { overflow: hidden; }
    </style>
  
  <rect x="0" y="0" width="100%" height="100%" fill="#87CEEB"/>
  <!-- Scene 1: The bus leaving the depot with animations -->
<!-- Background sky -->
<rect x="0" y="0" width="800" height="250" fill="#87CEEB"></rect>
<!-- Clouds -->
<g fill="#FFFFFF" opacity="0.8">
<!-- Cloud 1 -->
<circle cx="150" cy="60" r="20"></circle>
<circle cx="170" cy="60" r="15"></circle>
<circle cx="130" cy="65" r="12"></circle>
<circle cx="165" cy="50" r="10"></circle>
<!-- Cloud 2 -->
<circle cx="600" cy="80" r="25"></circle>
<circle cx="625" cy="80" r="18"></circle>
<circle cx="580" cy="85" r="15"></circle>
<circle cx="620" cy="65" r="12"></circle>
<!-- Cloud 3 -->
<circle cx="400" cy="50" r="18"></circle>
<circle cx="420" cy="50" r="12"></circle>
<circle cx="385" cy="55" r="10"></circle>
</g>
<!-- Ground/grass verges -->
<rect x="0" y="250" width="800" height="150" fill="#4A6B3A"></rect>
<!-- Road -->
<rect x="0" y="280" width="800" height="60" fill="#404040"></rect>
<!-- Road edges -->
<rect x="0" y="278" width="800" height="2" fill="#606060"></rect>
<rect x="0" y="340" width="800" height="2" fill="#606060"></rect>
<!-- Dashed center line -->
<g fill="#FFFF00">
<rect x="50" y="308" width="40" height="4"></rect>
<rect x="120" y="308" width="40" height="4"></rect>
<rect x="190" y="308" width="40" height="4"></rect>
<rect x="260" y="308" width="40" height="4"></rect>
<rect x="330" y="308" width="40" height="4"></rect>
<rect x="400" y="308" width="40" height="4"></rect>
<rect x="470" y="308" width="40" height="4"></rect>
<rect x="540" y="308" width="40" height="4"></rect>
<rect x="610" y="308" width="40" height="4"></rect>
<rect x="680" y="308" width="40" height="4"></rect>
<rect x="750" y="308" width="40" height="4"></rect>
</g>
<!-- Depot building -->
<g id="depot">
<!-- Main building structure -->
<rect x="50" y="150" width="200" height="130" fill="#8B7355" stroke="#6B5535" stroke-width="2"></rect>
<!-- Roof -->
<polygon points="40,150 150,110 260,110 260,150" fill="#654321" stroke="#543210" stroke-width="2"></polygon>
<!-- Front overhang -->
<polygon points="45,150 45,140 255,140 255,150" fill="#765432" stroke="#654321" stroke-width="1"></polygon>
<!-- Garage door -->
<rect x="80" y="200" width="60" height="80" fill="#666" stroke="#444" stroke-width="2" rx="3"></rect>
<rect x="160" y="200" width="60" height="80" fill="#666" stroke="#444" stroke-width="2" rx="3"></rect>
<!-- Garage door panels -->
<g stroke="#555" stroke-width="1" fill="none">
<line x1="80" y1="215" x2="140" y2="215"></line>
<line x1="80" y1="230" x2="140" y2="230"></line>
<line x1="80" y1="245" x2="140" y2="245"></line>
<line x1="80" y1="260" x2="140" y2="260"></line>
<line x1="160" y1="215" x2="220" y2="215"></line>
<line x1="160" y1="230" x2="220" y2="230"></line>
<line x1="160" y1="245" x2="220" y2="245"></line>
<line x1="160" y1="260" x2="220" y2="260"></line>
</g>
<!-- Depot sign -->
<rect x="100" y="160" width="100" height="20" fill="#FFFFFF" stroke="#333" stroke-width="1" rx="3"></rect>
<text x="150" y="173" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#333">SCHOOL BUS DEPOT</text>
</g>
<!-- Sky Text -->
<g id="sky-text" transform="translate(400, 40)">
<!-- Bold headline -->
<text x="0" y="0" text-anchor="middle" font-family="Arial, sans-serif" font-size="40" font-weight="bold" fill="#1E3A56" stroke="#FFFFFF" stroke-width="2" stroke-opacity="0.8" style="filter: drop-shadow(0px 2px 3px rgba(255,255,255,0.6))">Every journey starts with a <tspan fill="#FFD700">publish</tspan>.</text>
<!-- Supporting description -->
<text x="0" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" fill="#3C556E" style="filter: drop-shadow(0px 1px 2px rgba(255,255,255,0.5))">The depot launches the event onto the route.</text>
</g>
<!-- Caption -->
<g id="caption" transform="translate(400, 370)">
<rect x="-150" y="-10" width="300" height="25" fill="#FFFFFF" fill-opacity="0.9" stroke="#333" stroke-width="1" rx="5"></rect>
<text x="0" y="8" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#333">Bus leaves depot → publish(topic, payload)</text>
</g>

  
  
  

      </svg>
    </g>
    <text x="400" y="425" text-anchor="middle"
          font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#1E3A56">
      Scene 1: The bus leaving the depot with animations
    </text>
  </g>

  <!-- Scene 2: Bus encountering first rules of the road with animations -->
  <g class="scene-2" transform="translate(900, 150)">
    <rect x="0" y="0" width="800" height="400"
          fill="#FFFFFF" stroke="#E0E0E0" stroke-width="2" rx="8" class="scene-border"/>

    <!-- Scene timing indicator -->
    <rect x="5" y="5" width="20" height="4" fill="#E0E0E0" rx="2"/>
    <rect x="5" y="5" width="0" height="4" fill="#8b5cf6" rx="2" class="scene-progress">
      <animate attributeName="width"
               values="0;20;20;0"
               dur="60s"
               begin="10.333333333333334s"
               repeatCount="indefinite"/>
    </rect>

    <clipPath id="scene-2-clip">
      <rect x="0" y="0" width="800" height="400" rx="8"/>
    </clipPath>
    <g clip-path="url(#scene-2-clip)">
      <svg x="0" y="0" width="800" height="400" viewBox="0 0 800 400">

  <defs><linearGradient id="roadGradient" x1="0" y1="0" x2="1" y2="0"><stop offset="0" stop-color="#404040"/><stop offset="0.5" stop-color="#505050"/><stop offset="1" stop-color="#404040"/></linearGradient><linearGradient id="busGradient" x1="0" y1="0" x2="1" y2="0"><stop offset="0" stop-color="#FFD700"/><stop offset="0.5" stop-color="#FFA500"/><stop offset="1" stop-color="#FFD700"/></linearGradient><filter id="sceneShadow" x="-20%" y="-20%" width="140%" height="140%"><feDropShadow dx="0" dy="4" stdDeviation="8" flood-color="#000" flood-opacity="0.25"/></filter><filter id="busGlow"><feGaussianBlur stdDeviation="2" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
</defs>
  
    <style>
      .active-glow rect { filter: url(#glow); stroke: #8b5cf6; }
      .connector { stroke-linecap: round; stroke-linejoin: round; }
      .boundary-title { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-weight: 600; }
      .flow-token { animation-fill-mode: forwards; }
      .boundary-contained { overflow: hidden; }
    </style>
  
  <rect x="0" y="0" width="100%" height="100%" fill="#87CEEB"/>
  <!-- Scene 2: Bus encountering first rules of the road with animations -->
<!-- Background sky -->
<rect x="0" y="0" width="800" height="250" fill="#87CEEB"></rect>
<!-- Clouds -->
<g fill="#FFFFFF" opacity="0.8">
<circle cx="120" cy="50" r="18"></circle>
<circle cx="140" cy="50" r="12"></circle>
<circle cx="105" cy="55" r="10"></circle>
<circle cx="650" cy="70" r="22"></circle>
<circle cx="675" cy="70" r="16"></circle>
<circle cx="630" cy="75" r="12"></circle>
<circle cx="400" cy="40" r="15"></circle>
<circle cx="415" cy="40" r="10"></circle>
<circle cx="390" cy="45" r="8"></circle>
</g>
<!-- Ground -->
<rect x="0" y="250" width="800" height="150" fill="#4A6B3A"></rect>
<!-- Road -->
<rect x="0" y="280" width="800" height="60" fill="#404040"></rect>
<rect x="0" y="278" width="800" height="2" fill="#606060"></rect>
<rect x="0" y="340" width="800" height="2" fill="#606060"></rect>
<!-- Guardrails -->
<rect x="0" y="265" width="800" height="8" fill="#E0E0E0" stroke="#C0C0C0" stroke-width="1"></rect>
<rect x="0" y="345" width="800" height="8" fill="#E0E0E0" stroke="#C0C0C0" stroke-width="1"></rect>
<!-- Guardrail posts -->
<g fill="#C0C0C0">
<rect x="50" y="260" width="4" height="18"></rect>
<rect x="150" y="260" width="4" height="18"></rect>
<rect x="250" y="260" width="4" height="18"></rect>
<rect x="350" y="260" width="4" height="18"></rect>
<rect x="450" y="260" width="4" height="18"></rect>
<rect x="550" y="260" width="4" height="18"></rect>
<rect x="650" y="260" width="4" height="18"></rect>
<rect x="750" y="260" width="4" height="18"></rect>
<rect x="50" y="345" width="4" height="18"></rect>
<rect x="150" y="345" width="4" height="18"></rect>
<rect x="250" y="345" width="4" height="18"></rect>
<rect x="350" y="345" width="4" height="18"></rect>
<rect x="450" y="345" width="4" height="18"></rect>
<rect x="550" y="345" width="4" height="18"></rect>
<rect x="650" y="345" width="4" height="18"></rect>
<rect x="750" y="345" width="4" height="18"></rect>
</g>
<!-- Dashed center line -->
<g fill="#FFFF00">
<rect x="50" y="308" width="40" height="4"></rect>
<rect x="120" y="308" width="40" height="4"></rect>
<rect x="190" y="308" width="40" height="4"></rect>
<rect x="260" y="308" width="40" height="4"></rect>
<rect x="330" y="308" width="40" height="4"></rect>
<rect x="400" y="308" width="40" height="4"></rect>
<rect x="470" y="308" width="40" height="4"></rect>
<rect x="540" y="308" width="40" height="4"></rect>
<rect x="610" y="308" width="40" height="4"></rect>
<rect x="680" y="308" width="40" height="4"></rect>
</g>
<!-- Sky Text -->
<g id="sky-text" transform="translate(400, 40)">
<!-- Bold headline -->
<text x="0" y="0" text-anchor="middle" font-family="Arial, sans-serif" font-size="40" font-weight="bold" fill="#1E3A56" stroke="#FFFFFF" stroke-width="2" stroke-opacity="0.8" style="filter: drop-shadow(0px 2px 3px rgba(255,255,255,0.6))">Data drives the route.</text>
<!-- Supporting description -->
<text x="0" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" fill="#3C556E" style="filter: drop-shadow(0px 1px 2px rgba(255,255,255,0.5))">The <tspan fill="#4A90E2">manifest</tspan> maps the path, while <tspan fill="#FFD44D">debounce</tspan> slows bursts at the light.</text>
</g>
<!-- Caption -->
<g id="caption" transform="translate(400, 370)">
<rect x="-180" y="-10" width="360" height="25" fill="#FFFFFF" fill-opacity="0.9" stroke="#333" stroke-width="1" rx="5"></rect>
<text x="0" y="8" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#333">Manifest plans route; yellow light settles bursts (debounce)</text>
</g>

  
  
  

      </svg>
    </g>
    <text x="400" y="425" text-anchor="middle"
          font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#1E3A56">
      Scene 2: Bus encountering first rules of the road with animations
    </text>
  </g>

  <!-- Scene 3: First subscriber stop and replay cache with animations -->
  <g class="scene-3" transform="translate(50, 600)">
    <rect x="0" y="0" width="800" height="400"
          fill="#FFFFFF" stroke="#E0E0E0" stroke-width="2" rx="8" class="scene-border"/>

    <!-- Scene timing indicator -->
    <rect x="5" y="5" width="20" height="4" fill="#E0E0E0" rx="2"/>
    <rect x="5" y="5" width="0" height="4" fill="#8b5cf6" rx="2" class="scene-progress">
      <animate attributeName="width"
               values="0;20;20;0"
               dur="60s"
               begin="20.666666666666668s"
               repeatCount="indefinite"/>
    </rect>

    <clipPath id="scene-3-clip">
      <rect x="0" y="0" width="800" height="400" rx="8"/>
    </clipPath>
    <g clip-path="url(#scene-3-clip)">
      <svg x="0" y="0" width="800" height="400" viewBox="0 0 800 400">

  <defs><linearGradient id="roadGradient" x1="0" y1="0" x2="1" y2="0"><stop offset="0" stop-color="#404040"/><stop offset="0.5" stop-color="#505050"/><stop offset="1" stop-color="#404040"/></linearGradient><linearGradient id="busGradient" x1="0" y1="0" x2="1" y2="0"><stop offset="0" stop-color="#FFD700"/><stop offset="0.5" stop-color="#FFA500"/><stop offset="1" stop-color="#FFD700"/></linearGradient><filter id="sceneShadow" x="-20%" y="-20%" width="140%" height="140%"><feDropShadow dx="0" dy="4" stdDeviation="8" flood-color="#000" flood-opacity="0.25"/></filter><filter id="busGlow"><feGaussianBlur stdDeviation="2" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
</defs>
  
    <style>
      .active-glow rect { filter: url(#glow); stroke: #8b5cf6; }
      .connector { stroke-linecap: round; stroke-linejoin: round; }
      .boundary-title { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-weight: 600; }
      .flow-token { animation-fill-mode: forwards; }
      .boundary-contained { overflow: hidden; }
    </style>
  
  <rect x="0" y="0" width="100%" height="100%" fill="#87CEEB"/>
  <!-- Scene 3: First subscriber stop and replay cache with animations -->
<!-- Background sky -->
<rect x="0" y="0" width="800" height="250" fill="#87CEEB"/>
<!-- Clouds -->
<g fill="#FFFFFF" opacity="0.8">
<circle cx="100" cy="45" r="16"/>
<circle cx="118" cy="45" r="11"/>
<circle cx="88" cy="50" r="9"/>
<circle cx="600" cy="65" r="20"/>
<circle cx="622" cy="65" r="14"/>
<circle cx="585" cy="70" r="11"/>
<circle cx="350" cy="35" r="13"/>
<circle cx="365" cy="35" r="9"/>
<circle cx="340" cy="40" r="7"/>
</g>
<!-- Ground -->
<rect x="0" y="250" width="800" height="150" fill="#4A6B3A"/>
<!-- Road -->
<rect x="0" y="280" width="800" height="60" fill="#404040"/>
<rect x="0" y="278" width="800" height="2" fill="#606060"/>
<rect x="0" y="340" width="800" height="2" fill="#606060"/>
<!-- Guardrails -->
<rect x="0" y="265" width="800" height="8" fill="#E0E0E0" stroke="#C0C0C0" stroke-width="1"/>
<rect x="0" y="345" width="800" height="8" fill="#E0E0E0" stroke="#C0C0C0" stroke-width="1"/>
<!-- Dashed center line -->
<g fill="#FFFF00">
<rect x="50" y="308" width="40" height="4"/>
<rect x="120" y="308" width="40" height="4"/>
<rect x="190" y="308" width="40" height="4"/>
<rect x="260" y="308" width="40" height="4"/>
<rect x="330" y="308" width="40" height="4"/>
<rect x="400" y="308" width="40" height="4"/>
<rect x="470" y="308" width="40" height="4"/>
<rect x="540" y="308" width="40" height="4"/>
<rect x="610" y="308" width="40" height="4"/>
<rect x="680" y="308" width="40" height="4"/>
</g>
<!-- Sky Text -->
<g id="sky-text" transform="translate(400, 40)">
<!-- Bold headline -->
<text x="0" y="0" text-anchor="middle" font-family="Arial, sans-serif" font-size="40" font-weight="bold" fill="#1E3A56" stroke="#FFFFFF" stroke-width="2" stroke-opacity="0.8" style="filter: drop-shadow(0px 2px 3px rgba(255,255,255,0.6))">No one misses the bus.</text>
<!-- Supporting description -->
<text x="0" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" fill="#3C556E" style="filter: drop-shadow(0px 1px 2px rgba(255,255,255,0.5))">Live and late subscribers both get the message, thanks to the Replay Cache.</text>
</g>
<!-- Caption -->
<g id="caption" transform="translate(400, 370)">
<rect x="-200" y="-10" width="400" height="25" fill="#FFFFFF" fill-opacity="0.9" stroke="#333" stroke-width="1" rx="5"/>
<text x="0" y="8" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#333">First stop: live &amp; late subscribers; Replay Cache hydrates latecomers</text>
</g>

  
  
  

      </svg>
    </g>
    <text x="400" y="425" text-anchor="middle"
          font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#1E3A56">
      Scene 3: First subscriber stop and replay cache with animations
    </text>
  </g>

  <!-- Scene 4: Transfer hub and conductor with ramp animation -->
  <g class="scene-4" transform="translate(900, 600)">
    <rect x="0" y="0" width="800" height="400"
          fill="#FFFFFF" stroke="#E0E0E0" stroke-width="2" rx="8" class="scene-border"/>

    <!-- Scene timing indicator -->
    <rect x="5" y="5" width="20" height="4" fill="#E0E0E0" rx="2"/>
    <rect x="5" y="5" width="0" height="4" fill="#8b5cf6" rx="2" class="scene-progress">
      <animate attributeName="width"
               values="0;20;20;0"
               dur="60s"
               begin="31s"
               repeatCount="indefinite"/>
    </rect>

    <clipPath id="scene-4-clip">
      <rect x="0" y="0" width="800" height="400" rx="8"/>
    </clipPath>
    <g clip-path="url(#scene-4-clip)">
      <svg x="0" y="0" width="800" height="400" viewBox="0 0 800 400">

  <defs><linearGradient id="roadGradient" x1="0" y1="0" x2="1" y2="0"><stop offset="0" stop-color="#404040"/><stop offset="0.5" stop-color="#505050"/><stop offset="1" stop-color="#404040"/></linearGradient><linearGradient id="busGradient" x1="0" y1="0" x2="1" y2="0"><stop offset="0" stop-color="#FFD700"/><stop offset="0.5" stop-color="#FFA500"/><stop offset="1" stop-color="#FFD700"/></linearGradient><filter id="sceneShadow" x="-20%" y="-20%" width="140%" height="140%"><feDropShadow dx="0" dy="4" stdDeviation="8" flood-color="#000" flood-opacity="0.25"/></filter><filter id="busGlow"><feGaussianBlur stdDeviation="2" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
</defs>
  
    <style>
      .active-glow rect { filter: url(#glow); stroke: #8b5cf6; }
      .connector { stroke-linecap: round; stroke-linejoin: round; }
      .boundary-title { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-weight: 600; }
      .flow-token { animation-fill-mode: forwards; }
      .boundary-contained { overflow: hidden; }
    </style>
  
  <rect x="0" y="0" width="100%" height="100%" fill="#87CEEB"/>
  <!-- Scene 4: Transfer hub and conductor with ramp animation -->
<!-- Background sky -->
<rect x="0" y="0" width="800" height="250" fill="#87CEEB"/>
<!-- Clouds -->
<g fill="#FFFFFF" opacity="0.8">
<circle cx="90" cy="40" r="15"/>
<circle cx="106" cy="40" r="10"/>
<circle cx="80" cy="45" r="8"/>
<circle cx="650" cy="60" r="18"/>
<circle cx="670" cy="60" r="13"/>
<circle cx="635" cy="65" r="10"/>
<circle cx="300" cy="30" r="12"/>
<circle cx="313" cy="30" r="8"/>
<circle cx="290" cy="35" r="6"/>
</g>
<!-- Ground -->
<rect x="0" y="250" width="800" height="150" fill="#4A6B3A"/>
<!-- Main road -->
<rect x="0" y="280" width="800" height="60" fill="#404040"/>
<rect x="0" y="278" width="800" height="2" fill="#606060"/>
<rect x="0" y="340" width="800" height="2" fill="#606060"/>
<!-- Conductor ramp (curved path leading up to hub) -->
<g id="conductor-ramp">
<!-- Ramp surface -->
<path d="M 350,310 Q 400,280 450,260 Q 500,240 550,220 Q 600,200 650,180"
fill="none" stroke="#606060" stroke-width="40" stroke-linecap="round"/>
<path d="M 350,310 Q 400,280 450,260 Q 500,240 550,220 Q 600,200 650,180"
fill="none" stroke="#404040" stroke-width="36" stroke-linecap="round"/>
<!-- Ramp guardrails -->
<path d="M 350,290 Q 400,260 450,240 Q 500,220 550,200 Q 600,180 650,160"
fill="none" stroke="#E0E0E0" stroke-width="4" stroke-linecap="round"/>
<path d="M 350,330 Q 400,300 450,280 Q 500,260 550,240 Q 600,220 650,200"
fill="none" stroke="#E0E0E0" stroke-width="4" stroke-linecap="round"/>
<!-- Ramp center line -->
<g fill="#FFFF00">
<ellipse cx="370" cy="305" rx="8" ry="2" transform="rotate(-10 370 305)"/>
<ellipse cx="400" cy="290" rx="8" ry="2" transform="rotate(-15 400 290)"/>
<ellipse cx="430" cy="275" rx="8" ry="2" transform="rotate(-20 430 275)"/>
<ellipse cx="460" cy="258" rx="8" ry="2" transform="rotate(-25 460 258)"/>
<ellipse cx="490" cy="240" rx="8" ry="2" transform="rotate(-30 490 240)"/>
<ellipse cx="520" cy="222" rx="8" ry="2" transform="rotate(-35 520 222)"/>
<ellipse cx="550" cy="203" rx="8" ry="2" transform="rotate(-40 550 203)"/>
<ellipse cx="580" cy="185" rx="8" ry="2" transform="rotate(-45 580 185)"/>
</g>
</g>
<!-- Branching roads -->
<!-- Upper branch -->
<polygon points="450,280 550,200 570,210 460,290" fill="#404040"/>
<polygon points="450,278 550,198 570,208 460,288" fill="#606060"/>
<!-- Lower branch -->
<polygon points="450,340 550,380 570,370 460,330" fill="#404040"/>
<polygon points="450,342 550,382 570,372 460,332" fill="#606060"/>
<!-- Straight continuation -->
<rect x="500" y="280" width="300" height="60" fill="#404040"/>
<rect x="500" y="278" width="300" height="2" fill="#606060"/>
<rect x="500" y="340" width="300" height="2" fill="#606060"/>
<!-- Guardrails on main road -->
<rect x="0" y="265" width="350" height="8" fill="#E0E0E0" stroke="#C0C0C0" stroke-width="1"/>
<rect x="0" y="345" width="350" height="8" fill="#E0E0E0" stroke="#C0C0C0" stroke-width="1"/>
<!-- Guardrails on continuation -->
<rect x="500" y="265" width="300" height="8" fill="#E0E0E0" stroke="#C0C0C0" stroke-width="1"/>
<rect x="500" y="345" width="300" height="8" fill="#E0E0E0" stroke="#C0C0C0" stroke-width="1"/>
<!-- Dashed center lines -->
<g fill="#FFFF00">
<!-- Main road -->
<rect x="50" y="308" width="40" height="4"/>
<rect x="120" y="308" width="40" height="4"/>
<rect x="190" y="308" width="40" height="4"/>
<rect x="260" y="308" width="40" height="4"/>
<!-- Continuation -->
<rect x="520" y="308" width="40" height="4"/>
<rect x="590" y="308" width="40" height="4"/>
<rect x="660" y="308" width="40" height="4"/>
<rect x="730" y="308" width="40" height="4"/>
<!-- Branch roads -->
<rect x="480" y="240" width="20" height="3" transform="rotate(-25 490 241.5)"/>
<rect x="510" y="220" width="20" height="3" transform="rotate(-25 520 221.5)"/>
<rect x="480" y="360" width="20" height="3" transform="rotate(25 490 361.5)"/>
<rect x="510" y="380" width="20" height="3" transform="rotate(25 520 381.5)"/>
</g>
<!-- Transfer hub (circular) -->
<g id="transfer-hub" transform="translate(450, 310)">
<!-- Hub platform -->
<circle cx="0" cy="0" r="50" fill="#B0C4DE" stroke="#708090" stroke-width="3"/>
<circle cx="0" cy="0" r="47" fill="#D3D3D3" stroke="#A9A9A9" stroke-width="1"/>
<!-- Hub center -->
<circle cx="0" cy="0" r="25" fill="#4682B4" stroke="#2F4F4F" stroke-width="2"/>
<circle cx="0" cy="0" r="22" fill="#5F9EA0" stroke="#4682B4" stroke-width="1"/>
<!-- Conductor's baton and musical note -->
<g id="conductor-icon">
<!-- Baton -->
<line x1="-8" y1="8" x2="8" y2="-8" stroke="#FFFFFF" stroke-width="3" stroke-linecap="round"/>
<circle cx="8" cy="-8" r="2" fill="#FFFFFF"/>
<circle cx="-8" cy="8" r="1.5" fill="#FFFFFF"/>
<!-- Musical note -->
<circle cx="5" cy="5" r="3" fill="#FFD700" stroke="#FFA500" stroke-width="1"/>
<rect x="7.5" y="-5" width="1.5" height="10" fill="#FFD700"/>
<path d="M 9,0 Q 12,-2 12,2" stroke="#FFD700" stroke-width="1.5" fill="none"/>
</g>
<!-- Hub label -->
<text x="0" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#1E3A8A">Conductor: play()</text>
</g>
<!-- Sky Text -->
<g id="sky-text" transform="translate(400, 40)">
<!-- Bold headline -->
<text x="0" y="0" text-anchor="middle" font-family="Arial, sans-serif" font-size="40" font-weight="bold" fill="#1E3A56" stroke="#FFFFFF" stroke-width="2" stroke-opacity="0.8" style="filter: drop-shadow(0px 2px 3px rgba(255,255,255,0.6))">The <tspan fill="#6B4EFF">Conductor</tspan> orchestrates the flow.</text>
<!-- Supporting description -->
<text x="0" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" fill="#3C556E" style="filter: drop-shadow(0px 1px 2px rgba(255,255,255,0.5))">At the hub, events branch into sequences and plugins.</text>
</g>
<!-- Caption -->
<g id="caption" transform="translate(400, 370)">
<rect x="-220" y="-10" width="440" height="25" fill="#FFFFFF" fill-opacity="0.9" stroke="#333" stroke-width="1" rx="5"/>
<text x="0" y="8" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#333">Special hub: topics route into sequences via Conductor (plugins)</text>
</g>

  
  
  

      </svg>
    </g>
    <text x="400" y="425" text-anchor="middle"
          font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#1E3A56">
      Scene 4: Transfer hub and conductor with ramp animation
    </text>
  </g>

  <!-- Scene 5: Rules, boundaries, and street signs with traffic light animation -->
  <g class="scene-5" transform="translate(50, 1050)">
    <rect x="0" y="0" width="800" height="400"
          fill="#FFFFFF" stroke="#E0E0E0" stroke-width="2" rx="8" class="scene-border"/>

    <!-- Scene timing indicator -->
    <rect x="5" y="5" width="20" height="4" fill="#E0E0E0" rx="2"/>
    <rect x="5" y="5" width="0" height="4" fill="#8b5cf6" rx="2" class="scene-progress">
      <animate attributeName="width"
               values="0;20;20;0"
               dur="60s"
               begin="41.333333333333336s"
               repeatCount="indefinite"/>
    </rect>

    <clipPath id="scene-5-clip">
      <rect x="0" y="0" width="800" height="400" rx="8"/>
    </clipPath>
    <g clip-path="url(#scene-5-clip)">
      <svg x="0" y="0" width="800" height="400" viewBox="0 0 800 400">

  <defs><linearGradient id="roadGradient" x1="0" y1="0" x2="1" y2="0"><stop offset="0" stop-color="#404040"/><stop offset="0.5" stop-color="#505050"/><stop offset="1" stop-color="#404040"/></linearGradient><linearGradient id="busGradient" x1="0" y1="0" x2="1" y2="0"><stop offset="0" stop-color="#FFD700"/><stop offset="0.5" stop-color="#FFA500"/><stop offset="1" stop-color="#FFD700"/></linearGradient><filter id="sceneShadow" x="-20%" y="-20%" width="140%" height="140%"><feDropShadow dx="0" dy="4" stdDeviation="8" flood-color="#000" flood-opacity="0.25"/></filter><filter id="busGlow"><feGaussianBlur stdDeviation="2" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
</defs>
  
    <style>
      .active-glow rect { filter: url(#glow); stroke: #8b5cf6; }
      .connector { stroke-linecap: round; stroke-linejoin: round; }
      .boundary-title { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-weight: 600; }
      .flow-token { animation-fill-mode: forwards; }
      .boundary-contained { overflow: hidden; }
    </style>
  
  <rect x="0" y="0" width="100%" height="100%" fill="#87CEEB"/>
  <!-- Scene 5: Rules, boundaries, and street signs with traffic light animation -->
<!-- Background sky -->
<rect x="0" y="0" width="800" height="250" fill="#87CEEB"/>
<!-- Clouds -->
<g fill="#FFFFFF" opacity="0.8">
<circle cx="80" cy="35" r="14"/>
<circle cx="95" cy="35" r="9"/>
<circle cx="70" cy="40" r="7"/>
<circle cx="600" cy="55" r="16"/>
<circle cx="618" cy="55" r="11"/>
<circle cx="588" cy="60" r="9"/>
<circle cx="250" cy="25" r="11"/>
<circle cx="262" cy="25" r="7"/>
<circle cx="242" cy="30" r="5"/>
</g>
<!-- Ground -->
<rect x="0" y="250" width="800" height="150" fill="#4A6B3A"/>
<!-- Road -->
<rect x="0" y="280" width="800" height="60" fill="#404040"/>
<rect x="0" y="278" width="800" height="2" fill="#606060"/>
<rect x="0" y="340" width="800" height="2" fill="#606060"/>
<!-- Enhanced guardrails -->
<rect x="0" y="265" width="800" height="10" fill="#E0E0E0" stroke="#C0C0C0" stroke-width="1"/>
<rect x="0" y="345" width="800" height="10" fill="#E0E0E0" stroke="#C0C0C0" stroke-width="1"/>
<!-- Guardrail posts -->
<g fill="#C0C0C0">
<rect x="50" y="260" width="4" height="20"/>
<rect x="150" y="260" width="4" height="20"/>
<rect x="250" y="260" width="4" height="20"/>
<rect x="350" y="260" width="4" height="20"/>
<rect x="450" y="260" width="4" height="20"/>
<rect x="550" y="260" width="4" height="20"/>
<rect x="650" y="260" width="4" height="20"/>
<rect x="750" y="260" width="4" height="20"/>
<rect x="50" y="345" width="4" height="20"/>
<rect x="150" y="345" width="4" height="20"/>
<rect x="250" y="345" width="4" height="20"/>
<rect x="350" y="345" width="4" height="20"/>
<rect x="450" y="345" width="4" height="20"/>
<rect x="550" y="345" width="4" height="20"/>
<rect x="650" y="345" width="4" height="20"/>
<rect x="750" y="345" width="4" height="20"/>
</g>
<!-- Lane markings for performance controls -->
<!-- Debounce lane (left) - funnel with single pulse -->
<g transform="translate(200, 290)">
<!-- Funnel shape -->
<polygon points="0,10 20,5 20,15 0,20" fill="#FFFF00" opacity="0.7"/>
<polygon points="25,7 35,8 35,12 25,13" fill="#FFFF00" opacity="0.7"/>
<!-- Single pulse after funnel -->
<rect x="40" y="8" width="8" height="4" fill="#FFFF00" rx="2"/>
</g>
<!-- Throttle lane (right) - evenly spaced ticks -->
<g transform="translate(500, 295)" fill="#FFFF00" opacity="0.7">
<rect x="0" y="0" width="3" height="10" rx="1"/>
<rect x="10" y="0" width="3" height="10" rx="1"/>
<rect x="20" y="0" width="3" height="10" rx="1"/>
<rect x="30" y="0" width="3" height="10" rx="1"/>
<rect x="40" y="0" width="3" height="10" rx="1"/>
<rect x="50" y="0" width="3" height="10" rx="1"/>
</g>
<!-- Regular dashed center line -->
<g fill="#FFFF00">
<rect x="50" y="308" width="30" height="4"/>
<rect x="120" y="308" width="30" height="4"/>
<rect x="300" y="308" width="30" height="4"/>
<rect x="370" y="308" width="30" height="4"/>
<rect x="600" y="308" width="30" height="4"/>
<rect x="680" y="308" width="30" height="4"/>
<rect x="750" y="308" width="30" height="4"/>
</g>
<!-- Sky Text -->
<g id="sky-text" transform="translate(400, 40)">
<!-- Bold headline -->
<text x="0" y="0" text-anchor="middle" font-family="Arial, sans-serif" font-size="40" font-weight="bold" fill="#1E3A56" stroke="#FFFFFF" stroke-width="2" stroke-opacity="0.8" style="filter: drop-shadow(0px 2px 3px rgba(255,255,255,0.6))">Rules keep the ride safe.</text>
<!-- Supporting description -->
<text x="0" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" fill="#3C556E" style="filter: drop-shadow(0px 1px 2px rgba(255,255,255,0.5))">Guardrails, flags, <tspan fill="#228B22">throttle</tspan>, and <tspan fill="#FFD44D">debounce</tspan> enforce stability.</text>
</g>
<!-- Caption -->
<g id="caption" transform="translate(400, 370)">
<rect x="-250" y="-10" width="500" height="25" fill="#FFFFFF" fill-opacity="0.9" stroke="#333" stroke-width="1" rx="5"/>
<text x="0" y="8" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#333">Street rules: enforced boundaries, flags, throttle &amp; debounce lanes</text>
</g>

  
  
  

      </svg>
    </g>
    <text x="400" y="425" text-anchor="middle"
          font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#1E3A56">
      Scene 5: Rules, boundaries, and street signs with traffic light animation
    </text>
  </g>

  <!-- Scene 6: Destination reached. -->
  <g class="scene-6" transform="translate(900, 1050)">
    <rect x="0" y="0" width="800" height="400"
          fill="#FFFFFF" stroke="#E0E0E0" stroke-width="2" rx="8" class="scene-border"/>

    <!-- Scene timing indicator -->
    <rect x="5" y="5" width="20" height="4" fill="#E0E0E0" rx="2"/>
    <rect x="5" y="5" width="0" height="4" fill="#8b5cf6" rx="2" class="scene-progress">
      <animate attributeName="width"
               values="0;20;20;0"
               dur="60s"
               begin="51.66666666666667s"
               repeatCount="indefinite"/>
    </rect>

    <clipPath id="scene-6-clip">
      <rect x="0" y="0" width="800" height="400" rx="8"/>
    </clipPath>
    <g clip-path="url(#scene-6-clip)">
      <svg x="0" y="0" width="800" height="400" viewBox="0 0 800 400">

  <defs><linearGradient id="roadGradient" x1="0" y1="0" x2="1" y2="0"><stop offset="0" stop-color="#404040"/><stop offset="0.5" stop-color="#505050"/><stop offset="1" stop-color="#404040"/></linearGradient><linearGradient id="busGradient" x1="0" y1="0" x2="1" y2="0"><stop offset="0" stop-color="#FFD700"/><stop offset="0.5" stop-color="#FFA500"/><stop offset="1" stop-color="#FFD700"/></linearGradient><filter id="sceneShadow" x="-20%" y="-20%" width="140%" height="140%"><feDropShadow dx="0" dy="4" stdDeviation="8" flood-color="#000" flood-opacity="0.25"/></filter><filter id="busGlow"><feGaussianBlur stdDeviation="2" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
</defs>
  
    <style>
      .active-glow rect { filter: url(#glow); stroke: #8b5cf6; }
      .connector { stroke-linecap: round; stroke-linejoin: round; }
      .boundary-title { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-weight: 600; }
      .flow-token { animation-fill-mode: forwards; }
      .boundary-contained { overflow: hidden; }
    </style>
  
  <rect x="0" y="0" width="100%" height="100%" fill="#87CEEB"/>
  <!-- Scene 6: Final destination - the school with animated bus arrival and children jumping -->
<!-- Background sky -->
<rect x="0" y="0" width="800" height="250" fill="#87CEEB"/>
<!-- Clouds -->
<g fill="#FFFFFF" opacity="0.8">
<circle cx="70" cy="30" r="13"/>
<circle cx="84" cy="30" r="8"/>
<circle cx="60" cy="35" r="6"/>
<circle cx="650" cy="50" r="15"/>
<circle cx="667" cy="50" r="10"/>
<circle cx="638" cy="55" r="8"/>
<circle cx="200" cy="20" r="10"/>
<circle cx="211" cy="20" r="6"/>
<circle cx="192" cy="25" r="4"/>
</g>
<!-- Ground -->
<rect x="0" y="250" width="800" height="150" fill="#4A6B3A"/>
<!-- Road ending at school -->
<rect x="0" y="280" width="400" height="60" fill="#404040"/>
<rect x="0" y="278" width="400" height="2" fill="#606060"/>
<rect x="0" y="340" width="400" height="2" fill="#606060"/>
<!-- School courtyard/parking area -->
<rect x="400" y="280" width="400" height="60" fill="#C0C0C0"/>
<rect x="398" y="278" width="4" height="64" fill="#606060"/>
<!-- Guardrails ending -->
<rect x="0" y="265" width="400" height="8" fill="#E0E0E0" stroke="#C0C0C0" stroke-width="1"/>
<rect x="0" y="345" width="400" height="8" fill="#E0E0E0" stroke="#C0C0C0" stroke-width="1"/>
<!-- Dashed center line ending -->
<g fill="#FFFF00">
<rect x="50" y="308" width="30" height="4"/>
<rect x="120" y="308" width="30" height="4"/>
<rect x="190" y="308" width="30" height="4"/>
<rect x="260" y="308" width="30" height="4"/>
<rect x="330" y="308" width="30" height="4"/>
</g>
<!-- School building -->
<g id="school-building" transform="translate(500, 100)">
<!-- Main building -->
<rect x="0" y="50" width="200" height="120" fill="#CD853F" stroke="#8B4513" stroke-width="2"/>
<!-- Roof -->
<polygon points="-10,50 100,10 210,50" fill="#8B0000" stroke="#654321" stroke-width="2"/>
<!-- Roof ridge -->
<line x1="100" y1="10" x2="100" y2="50" stroke="#654321" stroke-width="1"/>
<!-- School entrance -->
<rect x="85" y="120" width="30" height="50" fill="#4682B4" stroke="#2F4F4F" stroke-width="2" rx="15" ry="0"/>
<rect x="87" y="122" width="26" height="25" fill="#87CEEB" stroke="#4682B4" stroke-width="1" rx="13" ry="0"/>
<!-- Door handle -->
<circle cx="110" cy="145" r="2" fill="#FFD700"/>
<!-- Windows -->
<rect x="20" y="70" width="20" height="20" fill="#87CEEB" stroke="#4682B4" stroke-width="1"/>
<rect x="50" y="70" width="20" height="20" fill="#87CEEB" stroke="#4682B4" stroke-width="1"/>
<rect x="130" y="70" width="20" height="20" fill="#87CEEB" stroke="#4682B4" stroke-width="1"/>
<rect x="160" y="70" width="20" height="20" fill="#87CEEB" stroke="#4682B4" stroke-width="1"/>
<rect x="20" y="100" width="20" height="20" fill="#87CEEB" stroke="#4682B4" stroke-width="1"/>
<rect x="50" y="100" width="20" height="20" fill="#87CEEB" stroke="#4682B4" stroke-width="1"/>
<rect x="130" y="100" width="20" height="20" fill="#87CEEB" stroke="#4682B4" stroke-width="1"/>
<rect x="160" y="100" width="20" height="20" fill="#87CEEB" stroke="#4682B4" stroke-width="1"/>
<!-- Window frames -->
<g stroke="#2F4F4F" stroke-width="0.5">
<line x1="30" y1="70" x2="30" y2="90"/>
<line x1="20" y1="80" x2="40" y2="80"/>
<line x1="60" y1="70" x2="60" y2="90"/>
<line x1="50" y1="80" x2="70" y2="80"/>
<line x1="140" y1="70" x2="140" y2="90"/>
<line x1="130" y1="80" x2="150" y2="80"/>
<line x1="170" y1="70" x2="170" y2="90"/>
<line x1="160" y1="80" x2="180" y2="80"/>
<line x1="30" y1="100" x2="30" y2="120"/>
<line x1="20" y1="110" x2="40" y2="110"/>
<line x1="60" y1="100" x2="60" y2="120"/>
<line x1="50" y1="110" x2="70" y2="110"/>
<line x1="140" y1="100" x2="140" y2="120"/>
<line x1="130" y1="110" x2="150" y2="110"/>
<line x1="170" y1="100" x2="170" y2="120"/>
<line x1="160" y1="110" x2="180" y2="110"/>
</g>
<!-- Flagpole -->
<rect x="98" y="0" width="4" height="60" fill="#8B4513"/>
<!-- Flag -->
<rect x="102" y="5" width="30" height="20" fill="#FF0000">
<animate attributeName="d" values="M102,5 L132,5 L132,25 L102,25 Z;M102,5 L132,7 L132,23 L102,25 Z;M102,5 L132,5 L132,25 L102,25 Z" dur="2s" repeatCount="indefinite"/>
</rect>
<polygon points="102,5 132,7 132,23 102,25" fill="#FF0000">
<animateTransform attributeName="transform" type="skewX" values="0;3;0" dur="2s" repeatCount="indefinite"/>
</polygon>
<!-- School sign -->
<rect x="60" y="130" width="80" height="15" fill="#FFFFFF" stroke="#333" stroke-width="1" rx="2"/>
<text x="100" y="140" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#333">ELEMENTARY SCHOOL</text>
</g>
<!-- Sky Text -->
<g id="sky-text" transform="translate(400, 40)">
<!-- Bold headline -->
<text x="0" y="0" text-anchor="middle" font-family="Arial, sans-serif" font-size="40" font-weight="bold" fill="#1E3A56" stroke="#FFFFFF" stroke-width="2" stroke-opacity="0.8" style="filter: drop-shadow(0px 2px 3px rgba(255,255,255,0.6))">Destination reached.</text>
<!-- Supporting description -->
<text x="0" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" fill="#3C556E" style="filter: drop-shadow(0px 1px 2px rgba(255,255,255,0.5))">Events arrive at the school — the application state is updated.</text>
</g>
<!-- Caption -->
<g id="caption" transform="translate(400, 370)">
<rect x="-220" y="-10" width="440" height="25" fill="#FFFFFF" fill-opacity="0.9" stroke="#333" stroke-width="1" rx="5"/>
<text x="0" y="8" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#333">Destination reached: application state updated (successful delivery)</text>
</g>

  
  
  

      </svg>
    </g>
    <text x="400" y="425" text-anchor="middle"
          font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#1E3A56">
      Scene 6: Destination reached.
    </text>
  </g>

  <!-- Progress Indicator -->
  <g id="progress-indicator" transform="translate(50, 50)">
    <rect x="0" y="0" width="200" height="20" fill="#E0E0E0" rx="10"/>
    <rect x="0" y="0" width="0" height="20" fill="#4CAF50" rx="10">
      <animate attributeName="width"
               values="0;200"
               dur="60s"
               repeatCount="indefinite"/>
    </rect>
    <text x="100" y="35" text-anchor="middle" font-family="Arial" font-size="12" fill="#333">
      Journey Progress
    </text>
  </g>

  <!-- Unified Bus with Coordinated Animation -->
  <g id="unified-coordinated-bus">
    <animateTransform
      attributeName="transform"
      type="translate"
      values="70,350;770,350;920,350;920,350;1620,350;70,800;70,800;770,800;920,800;920,800;1620,800;70,1250;70,1250;770,1250;920,1250;920,1250;1620,1250"
      dur="60s"
      repeatCount="indefinite"
    />
    <use href="#unified-bus-sprite"/>
  </g>

  <!-- Play/Pause Controls -->
  <g id="playback-controls" transform="translate(50, 1450)">
    <rect x="0" y="0" width="100" height="30" fill="#8b5cf6" rx="4" opacity="0.8"/>
    <text x="50" y="20" text-anchor="middle" fill="white" font-family="Arial" font-size="12">
      Click to Play/Pause
    </text>
  </g>

</svg>